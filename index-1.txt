<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PraiaVendas Pro | Gestão Inteligente para Vendedores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #FF6B35;
            --primary-gradient: linear-gradient(135deg, #FF6B35 0%, #FF8E53 100%);
            --primary-light: #FF8E53;
            --primary-dark: #E55A2B;
            --secondary: #4ECDC4;
            --secondary-light: #6FE7DF;
            --success: #00C851;
            --success-light: #5DFC7B;
            --success-dark: #00A843;
            --danger: #FF4444;
            --danger-light: #FF6B6B;
            --warning: #FFBB33;
            --warning-light: #FFD166;
            --info: #33B5E5;
            --dark: #2D3047;
            --light: #FFFFFF;
            --gray-50: #FAFAFA;
            --gray-100: #F5F5F5;
            --gray-200: #EEEEEE;
            --gray-300: #E0E0E0;
            --gray-400: #BDBDBD;
            --gray-500: #9E9E9E;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --card-shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius-lg: 24px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
            --border-radius-xs: 8px;
            --text-gradient: linear-gradient(135deg, #FF6B35 0%, #4ECDC4 100%);
        }

        [data-theme="dark"] {
            --primary: #FF8E53;
            --primary-gradient: linear-gradient(135deg, #FF8E53 0%, #FF6B35 100%);
            --primary-light: #FFA97C;
            --primary-dark: #E55A2B;
            --secondary: #6FE7DF;
            --secondary-light: #8BF3EC;
            --success: #5DFC7B;
            --success-light: #7EFF95;
            --danger: #FF6B6B;
            --danger-light: #FF8A8A;
            --warning: #FFD166;
            --warning-light: #FFDF8E;
            --info: #66D9FF;
            --dark: #FFFFFF;
            --light: #121212;
            --gray-50: #1E1E1E;
            --gray-100: #252525;
            --gray-200: #2D2D2D;
            --gray-300: #3D3D3D;
            --gray-400: #5D5D5D;
            --gray-500: #7D7D7D;
            --gray-600: #9D9D9D;
            --gray-700: #BDBDBD;
            --gray-800: #D0D0D0;
            --gray-900: #E8E8E8;
            --glass-bg: rgba(30, 30, 30, 0.2);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            --card-shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        [data-theme="dark"] body {
            background: #0A0A0A;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.9), rgba(78, 205, 196, 0.9)),
                        url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .login-box {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            padding: 3rem 2.5rem;
            width: 100%;
            max-width: 440px;
            box-shadow: var(--glass-shadow);
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .business-logo {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 2rem;
            display: block;
            border: 4px solid white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .business-name {
            text-align: center;
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #FFFFFF 0%, #FFE8D6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-input-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px 16px 52px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            color: white;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .login-input:focus {
            outline: none;
            border-color: white;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .login-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 0.5px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        /* Valor de compra fixo no topo */
        .purchase-value-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--primary-gradient);
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            z-index: 9998;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .purchase-value-overlay.show {
            transform: translateY(0);
        }

        /* Header Moderno */
        header {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem 1rem 0.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .business-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .business-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .business-info h1 {
            font-size: 1.4rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 4px;
        }

        .business-info span {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px) scale(1.05);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .header-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .tabs-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            padding: 6px;
            min-width: max-content;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            min-width: 90px;
            text-align: center;
            padding: 10px 12px;
            border-radius: 100px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.9);
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Main Container */
        .container {
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        /* Dashboard - Moderno */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 1.8rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .dashboard-card {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-shadow-hover);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0.5rem 0;
            background: var(--text-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-top: 0.5rem;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 100px;
            background: var(--success-light);
            color: var(--success-dark);
        }

        .card-trend.down {
            background: rgba(255, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .chart-card {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 1.8rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            height: 380px;
            display: flex;
            flex-direction: column;
        }

        [data-theme="dark"] .chart-card {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            flex: 1;
            position: relative;
            min-height: 300px;
        }

        /* Sales Section */
        .sale-form-card {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            border: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .sale-form-card {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.95rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            background: var(--light);
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            color: var(--dark);
            transition: var(--transition);
        }

        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-select {
            background: var(--gray-50);
            border-color: var(--gray-300);
            color: var(--dark);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .sale-products-container {
            margin: 30px 0;
        }

        .products-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius-sm);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: var(--light);
        }

        [data-theme="dark"] .products-list {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            transition: var(--transition);
            border-radius: var(--border-radius-xs);
        }

        .product-item:hover {
            background: var(--gray-50);
        }

        .product-info h4 {
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--gray-800);
        }

        .product-details {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .product-total {
            font-weight: 700;
            color: var(--success);
            font-size: 1.1rem;
            margin-right: 15px;
        }

        .remove-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-btn:hover {
            background: var(--danger-light);
            transform: scale(1.1);
        }

        /* Payment Methods */
        .mixed-payment-container {
            margin: 30px 0;
        }

        .payment-item {
            background: var(--gray-50);
            border-radius: var(--border-radius-sm);
            padding: 1.2rem;
            margin-bottom: 15px;
            border: 2px solid var(--gray-200);
            transition: var(--transition);
        }

        .payment-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .payment-select {
            flex: 1;
            max-width: 200px;
            padding: 10px 14px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-xs);
            background: var(--light);
            color: var(--dark);
            font-weight: 600;
        }

        .payment-amount {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .payment-amount input {
            width: 150px;
            padding: 10px 14px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-xs);
            font-size: 1rem;
            font-weight: 600;
        }

        .payment-summary {
            background: var(--success-light);
            border-radius: var(--border-radius-sm);
            padding: 1.5rem;
            margin-top: 25px;
            border: 2px solid var(--success);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .summary-total {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--success-dark);
            margin-top: 10px;
            padding-top: 15px;
            border-top: 3px double var(--success);
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 200, 81, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn-lg {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* History Section */
        .history-table-container {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            border: 1px solid var(--gray-200);
            overflow-x: auto;
        }

        [data-theme="dark"] .history-table-container {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th {
            background: var(--gray-50);
            padding: 16px 20px;
            text-align: left;
            font-weight: 700;
            color: var(--gray-700);
            border-bottom: 3px solid var(--gray-200);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        [data-theme="dark"] .data-table th {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .data-table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-700);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: white;
        }

        .action-btn.delete {
            background: var(--danger);
        }

        .action-btn.edit {
            background: var(--info);
        }

        .action-btn.download {
            background: var(--success);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .modal-content {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-close {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--gray-100);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray-600);
        }

        .modal-close:hover {
            background: var(--gray-200);
            transform: rotate(90deg);
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 1.2rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-left: 5px solid var(--success);
        }

        [data-theme="dark"] .notification {
            background: var(--gray-100);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left-color: var(--success);
        }

        .notification-error {
            border-left-color: var(--danger);
        }

        .notification-warning {
            border-left-color: var(--warning);
        }

        .notification-info {
            border-left-color: var(--info);
        }

        .notification-icon {
            font-size: 1.8rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--gray-800);
        }

        .notification-message {
            font-size: 0.95rem;
            color: var(--gray-600);
            line-height: 1.4;
        }

        /* Sale Animation */
        .sale-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 8rem;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s;
            filter: drop-shadow(0 0 20px rgba(255, 107, 53, 0.5));
        }

        .sale-animation.show {
            transform: translate(-50%, -50%) scale(1.5);
            opacity: 1;
        }

        /* Hide Values Toggle */
        .hide-values-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .hide-values-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hide-values-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 12px 35px rgba(255, 107, 53, 0.6);
        }

        /* Settings Links */
        .settings-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .link-card {
            background: var(--light);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid var(--gray-200);
            text-align: center;
            text-decoration: none;
            color: inherit;
        }

        [data-theme="dark"] .link-card {
            background: var(--gray-100);
            border-color: var(--gray-200);
        }

        .link-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-shadow-hover);
            border-color: var(--primary);
        }

        .link-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .link-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--gray-800);
        }

        .link-description {
            color: var(--gray-600);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .login-box {
                padding: 2rem 1.5rem;
            }
            
            .business-logo {
                width: 100px;
                height: 100px;
            }
            
            .business-name {
                font-size: 1.8rem;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
            }
            
            .business-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .tabs {
                padding: 4px;
            }
            
            .tab {
                min-width: 70px;
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            
            .dashboard-card {
                padding: 1.5rem;
            }
            
            .card-value {
                font-size: 1.8rem;
            }
            
            .modal-content {
                padding: 2rem 1.5rem;
            }
            
            .hide-values-container {
                bottom: 20px;
                right: 20px;
            }
            
            .hide-values-btn {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-amount {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .payment-amount input {
                width: 100%;
            }
            
            .table-actions {
                flex-direction: column;
            }
            
            .notification-container {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Utility Classes */
        .text-gradient {
            background: var(--text-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-300);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Discount Badge */
        .discount-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
            z-index: 1;
        }

        /* Print Styles */
        @media print {
            header, .hide-values-container, .tabs-container {
                display: none !important;
            }
            
            .container {
                padding: 0;
            }
            
            .section {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <img id="businessLogo" class="business-logo" src="" alt="Logo do Negócio">
            <h1 id="businessNameLogin" class="business-name">PraiaVendas Pro</h1>
            
            <div class="login-input-container">
                <i class="fas fa-user login-icon"></i>
                <input type="text" id="usernameInput" class="login-input" placeholder="Usuário" autocomplete="username">
            </div>
            
            <div class="login-input-container">
                <i class="fas fa-lock login-icon"></i>
                <input type="password" id="passwordInput" class="login-input" placeholder="Senha" autocomplete="current-password">
            </div>
            
            <button id="loginBtn" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
            </button>
        </div>
    </div>

    <!-- Valor de Compra Fixo -->
    <div id="purchaseValueOverlay" class="purchase-value-overlay">
        <i class="fas fa-shopping-cart"></i>
        <span id="currentPurchaseValue">Valor da compra: R$ 0,00</span>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <header>
            <div class="header-content">
                <div class="header-top">
                    <div class="business-header">
                        <img id="businessAvatar" class="business-avatar" src="" alt="Avatar">
                        <div class="business-info">
                            <h1 id="businessNameHeader">PraiaVendas Pro</h1>
                            <span id="businessSlogan">Sistema Inteligente de Vendas</span>
                        </div>
                    </div>
                    
                    <div class="header-actions">
                        <button class="header-btn" id="notificationToggle" title="Notificações">
                            <i class="fas fa-bell"></i>
                        </button>
                        <button class="header-btn" id="themeToggle" title="Alternar Tema">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="header-btn" id="hideValuesToggle" title="Ocultar Valores">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                        <button class="header-btn" id="logoutBtn" title="Sair">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="dashboard">
                            <i class="fas fa-home"></i> Dashboard
                        </div>
                        <div class="tab" data-tab="sales">
                            <i class="fas fa-cash-register"></i> Vendas
                        </div>
                        <div class="tab" data-tab="history">
                            <i class="fas fa-history"></i> Histórico
                        </div>
                        <div class="tab" data-tab="products">
                            <i class="fas fa-box"></i> Produtos
                        </div>
                        <div class="tab" data-tab="finance">
                            <i class="fas fa-chart-line"></i> Financeiro
                        </div>
                        <div class="tab" data-tab="settings">
                            <i class="fas fa-cog"></i> Configurações
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-money-bill-wave"></i>
                                Vendas Hoje
                            </h3>
                            <span class="card-trend up">+12%</span>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 2.850,00</div>
                        <p class="card-subtitle">15 vendas realizadas</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i>
                                Lucro Líquido
                            </h3>
                            <span class="card-trend up">+8%</span>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 1.420,50</div>
                        <p class="card-subtitle">Margem de 49.8%</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-bullseye"></i>
                                Meta Diária
                            </h3>
                            <span class="card-trend up">85%</span>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 1.700,00</div>
                        <p class="card-subtitle">Falta R$ 300,00</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-box-open"></i>
                                Estoque Baixo
                            </h3>
                            <span class="card-trend down">3 itens</span>
                        </div>
                        <div class="card-value">3</div>
                        <p class="card-subtitle">Necessita reposição</p>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-bar"></i>
                                Vendas por Período
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-pie"></i>
                                Distribuição de Vendas
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-wallet"></i>
                                Métodos de Pagamento
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-trending-up"></i>
                                Evolução Mensal
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Vendas -->
            <section id="sales" class="section">
                <div class="sale-form-card">
                    <h2 style="margin-bottom: 1.5rem; color: var(--gray-800);">
                        <i class="fas fa-cash-register"></i> Nova Venda
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Produto</label>
                            <select id="productSelect" class="form-select">
                                <option value="">Selecione um produto</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Quantidade</label>
                            <input type="number" id="quantityInput" class="form-input" min="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Preço Unitário (R$)</label>
                            <input type="number" id="priceInput" class="form-input" min="0.01" step="0.01" placeholder="0,00">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Desconto (R$)</label>
                            <input type="number" id="discountInput" class="form-input" min="0" step="0.01" placeholder="0,00" value="0">
                        </div>
                    </div>
                    
                    <button id="addProductBtn" class="btn btn-success" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Adicionar Produto
                    </button>
                </div>

                <div class="sale-form-card">
                    <div class="sale-products-container">
                        <h3 style="margin-bottom: 1.5rem; color: var(--gray-800);">
                            <i class="fas fa-shopping-cart"></i> Produtos na Venda
                        </h3>
                        
                        <div id="productsList" class="products-list">
                            <div class="empty-state">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Nenhum produto adicionado à venda</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mixed-payment-container">
                        <h3 style="margin-bottom: 1.5rem; color: var(--gray-800);">
                            <i class="fas fa-credit-card"></i> Pagamento
                        </h3>
                        
                        <div id="paymentMethodsContainer">
                            <div class="payment-item">
                                <div class="payment-header">
                                    <select class="payment-select" onchange="updatePaymentMethod(0, this.value)">
                                        <option value="cash">Dinheiro</option>
                                        <option value="pix">Pix</option>
                                        <option value="credit">Cartão Crédito</option>
                                        <option value="debit">Cartão Débito</option>
                                    </select>
                                    <button onclick="removePaymentMethod(0)" class="btn btn-danger btn-sm">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="payment-amount">
                                    <span>R$</span>
                                    <input type="number" min="0" step="0.01" placeholder="0,00" 
                                           onchange="updatePaymentAmount(0, this.value)"
                                           oninput="updatePaymentAmount(0, this.value)">
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addPaymentMethod()" class="btn btn-secondary" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Adicionar Forma de Pagamento
                        </button>
                    </div>
                    
                    <div class="payment-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotalValue" data-hide-value="true">R$ 0,00</span>
                        </div>
                        <div class="summary-row">
                            <span>Descontos:</span>
                            <span id="discountValue" data-hide-value="true">R$ 0,00</span>
                        </div>
                        <div class="summary-row">
                            <span>Total:</span>
                            <span id="totalValue" data-hide-value="true">R$ 0,00</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Pago:</span>
                            <span id="paidValue" data-hide-value="true">R$ 0,00</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Restante/Troco:</span>
                            <span id="remainingValue" data-hide-value="true">R$ 0,00</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button id="registerSaleBtn" class="btn btn-primary btn-lg" disabled>
                            <i class="fas fa-check"></i> Finalizar Venda
                        </button>
                        <button id="clearSaleBtn" class="btn btn-danger btn-lg">
                            <i class="fas fa-times"></i> Cancelar Venda
                        </button>
                    </div>
                </div>
            </section>

            <!-- Histórico -->
            <section id="history" class="section">
                <div class="sale-form-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--gray-800);">
                            <i class="fas fa-history"></i> Histórico de Vendas
                        </h2>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="exportHistoryPDF()" class="btn btn-success">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                            <button onclick="clearHistory()" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Limpar Histórico
                            </button>
                        </div>
                    </div>
                    
                    <div class="history-table-container">
                        <table class="data-table" id="historyTable">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Produtos</th>
                                    <th>Quantidade</th>
                                    <th>Total</th>
                                    <th>Pagamento</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <!-- Histórico será carregado aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Produtos -->
            <section id="products" class="section">
                <div class="sale-form-card">
                    <h2 style="margin-bottom: 1.5rem; color: var(--gray-800);">
                        <i class="fas fa-box"></i> Gerenciar Produtos
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nome do Produto</label>
                            <input type="text" id="productNameInput" class="form-input" placeholder="Ex: Água de Coco">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select id="productCategoryInput" class="form-select">
                                <option value="bebidas">Bebidas</option>
                                <option value="comidas">Comidas</option>
                                <option value="sobremesas">Sobremesas</option>
                                <option value="acessorios">Acessórios</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Preço de Venda (R$)</label>
                            <input type="number" id="productPriceInput" class="form-input" min="0.01" step="0.01" placeholder="0,00">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Custo (R$)</label>
                            <input type="number" id="productCostInput" class="form-input" min="0" step="0.01" placeholder="0,00">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Estoque</label>
                            <input type="number" id="productStockInput" class="form-input" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Estoque Mínimo</label>
                            <input type="number" id="productMinStockInput" class="form-input" min="0" value="5">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button id="saveProductBtn" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> Salvar Produto
                        </button>
                        <button id="clearProductBtn" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                
                <div class="sale-form-card" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 1.5rem; color: var(--gray-800);">
                        <i class="fas fa-boxes"></i> Lista de Produtos
                    </h3>
                    
                    <div class="history-table-container">
                        <table class="data-table" id="productsTable">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Preço</th>
                                    <th>Custo</th>
                                    <th>Estoque</th>
                                    <th>Lucro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Produtos serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Financeiro -->
            <section id="finance" class="section">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-money-bill"></i>
                                Faturamento Mensal
                            </h3>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 45.820,00</div>
                        <p class="card-subtitle">+15% vs mês anterior</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-coins"></i>
                                Lucro Mensal
                            </h3>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 22.910,00</div>
                        <p class="card-subtitle">Margem de 50%</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-pie"></i>
                                CMV Mensal
                            </h3>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 18.328,00</div>
                        <p class="card-subtitle">40% do faturamento</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-percentage"></i>
                                Taxas/Custos
                            </h3>
                        </div>
                        <div class="card-value" data-hide-value="true">R$ 4.582,00</div>
                        <p class="card-subtitle">10% do faturamento</p>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-line"></i>
                                Evolução Financeira
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-bar"></i>
                                Distribuição de Custos
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="costsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Configurações -->
            <section id="settings" class="section">
                <div class="sale-form-card">
                    <h2 style="margin-bottom: 2rem; color: var(--gray-800);">
                        <i class="fas fa-cog"></i> Configurações do Sistema
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nome do Negócio</label>
                            <input type="text" id="businessNameInput" class="form-input" placeholder="Nome do seu negócio">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Slogan/Descrição</label>
                            <input type="text" id="businessSloganInput" class="form-input" placeholder="Ex: As melhores águas de coco!">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Cor Primária</label>
                            <input type="color" id="primaryColorInput" class="form-input" style="height: 50px; padding: 5px;">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Cor Secundária</label>
                            <input type="color" id="secondaryColorInput" class="form-input" style="height: 50px; padding: 5px;">
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0; padding: 20px; background: var(--gray-50); border-radius: var(--border-radius-sm);">
                        <h3 style="margin-bottom: 1rem; color: var(--gray-800);">
                            <i class="fas fa-bell"></i> Notificações
                        </h3>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="notificationsToggle" checked style="width: 20px; height: 20px;">
                                <span>Notificações de venda</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="soundsToggle" checked style="width: 20px; height: 20px;">
                                <span>Sons de venda</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="stockAlertsToggle" checked style="width: 20px; height: 20px;">
                                <span>Alertas de estoque baixo</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-links">
                        <a href="https://seusite.com/criador" target="_blank" class="link-card">
                            <div class="link-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <h3 class="link-title">Criador do Software</h3>
                            <p class="link-description">Conheça o desenvolvedor e veja outros projetos</p>
                        </a>
                        
                        <a href="https://seusite.com/pagamento" target="_blank" class="link-card">
                            <div class="link-icon">
                                <i class="fas fa-donate"></i>
                            </div>
                            <h3 class="link-title">Apoie o Projeto</h3>
                            <p class="link-description">Faça uma doação para ajudar no desenvolvimento</p>
                        </a>
                        
                        <a href="javascript:void(0)" onclick="exportBackup()" class="link-card">
                            <div class="link-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <h3 class="link-title">Backup de Dados</h3>
                            <p class="link-description">Exporte todos os dados do sistema</p>
                        </a>
                        
                        <a href="javascript:void(0)" onclick="importBackup()" class="link-card">
                            <div class="link-icon">
                                <i class="fas fa-upload"></i>
                            </div>
                            <h3 class="link-title">Restaurar Dados</h3>
                            <p class="link-description">Importe dados de backup anterior</p>
                        </a>
                    </div>
                    
                    <button onclick="saveSettings()" class="btn btn-primary btn-lg" style="margin-top: 30px;">
                        <i class="fas fa-save"></i> Salvar Configurações
                    </button>
                </div>
            </section>
        </div>
        
        <!-- Botão para ocultar/mostrar valores -->
        <div class="hide-values-container">
            <button id="hideValuesBtn" class="hide-values-btn">
                <i class="fas fa-eye"></i>
            </button>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Confirmação
                </h3>
                <button class="modal-close" onclick="hideModal('confirmModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="margin: 2rem 0;">
                <p id="confirmMessage" style="font-size: 1.1rem; color: var(--gray-700);"></p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button onclick="hideModal('confirmModal')" class="btn btn-secondary">
                    Cancelar
                </button>
                <button onclick="confirmAction()" class="btn btn-danger" id="confirmActionBtn">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes da Venda -->
    <div id="saleDetailsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-receipt"></i>
                    Detalhes da Venda
                </h3>
                <button class="modal-close" onclick="hideModal('saleDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="margin: 2rem 0;">
                <div id="saleDetailsContent"></div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button onclick="printSaleDetails()" class="btn btn-secondary">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button onclick="hideModal('saleDetailsModal')" class="btn btn-primary">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Container de Notificações -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Animação de Venda -->
    <div class="sale-animation" id="saleAnimation">
        <i class="fas fa-check-circle"></i>
    </div>

<script>
// ============================================
// SISTEMA COMPLETO PRAIAVENDAS PRO
// ============================================

// Constantes do sistema
const APP_NAME = "PraiaVendas Pro";
const DATA_KEYS = {
    USERS: 'praiaVendasPro_users',
    BUSINESS_INFO: 'praiaVendasPro_businessInfo',
    PRODUCTS: 'praiaVendasPro_products',
    SALES: 'praiaVendasPro_sales',
    SETTINGS: 'praiaVendasPro_settings',
    SESSION: 'praiaVendasPro_session',
    LAST_BACKUP: 'praiaVendasPro_lastBackup'
};

// Estado principal do aplicativo
const appState = {
    currentUser: null,
    businessInfo: {
        name: "PraiaVendas Pro",
        slogan: "Sistema Inteligente de Vendas",
        logo: "",
        primaryColor: "#FF6B35",
        secondaryColor: "#4ECDC4"
    },
    products: [
        {
            id: 1,
            name: "Água de Coco",
            category: "bebidas",
            price: 8.00,
            cost: 2.50,
            stock: 50,
            minStock: 10,
            createdAt: new Date().toISOString()
        },
        {
            id: 2,
            name: "Sorvete",
            category: "sobremesas",
            price: 6.00,
            cost: 2.00,
            stock: 30,
            minStock: 5,
            createdAt: new Date().toISOString()
        },
        {
            id: 3,
            name: "Cerveja",
            category: "bebidas",
            price: 10.00,
            cost: 4.00,
            stock: 100,
            minStock: 20,
            createdAt: new Date().toISOString()
        },
        {
            id: 4,
            name: "Petisco",
            category: "comidas",
            price: 15.00,
            cost: 6.00,
            stock: 25,
            minStock: 5,
            createdAt: new Date().toISOString()
        }
    ],
    sales: [],
    settings: {
        darkMode: false,
        notifications: true,
        sounds: true,
        stockAlerts: true,
        hideValues: false,
        currentSection: 'dashboard'
    },
    currentSale: {
        products: [],
        subtotal: 0,
        discount: 0,
        total: 0,
        payments: [
            { method: 'cash', amount: 0 }
        ]
    },
    pendingAction: null
};

// Elementos DOM
const dom = {
    // Login
    loginScreen: document.getElementById('loginScreen'),
    mainApp: document.getElementById('mainApp'),
    businessLogo: document.getElementById('businessLogo'),
    businessNameLogin: document.getElementById('businessNameLogin'),
    usernameInput: document.getElementById('usernameInput'),
    passwordInput: document.getElementById('passwordInput'),
    loginBtn: document.getElementById('loginBtn'),
    
    // Header
    businessAvatar: document.getElementById('businessAvatar'),
    businessNameHeader: document.getElementById('businessNameHeader'),
    businessSlogan: document.getElementById('businessSlogan'),
    notificationToggle: document.getElementById('notificationToggle'),
    themeToggle: document.getElementById('themeToggle'),
    hideValuesToggle: document.getElementById('hideValuesToggle'),
    logoutBtn: document.getElementById('logoutBtn'),
    tabs: document.querySelectorAll('.tab'),
    
    // Dashboard
    purchaseValueOverlay: document.getElementById('purchaseValueOverlay'),
    currentPurchaseValue: document.getElementById('currentPurchaseValue'),
    
    // Sales
    productSelect: document.getElementById('productSelect'),
    quantityInput: document.getElementById('quantityInput'),
    priceInput: document.getElementById('priceInput'),
    discountInput: document.getElementById('discountInput'),
    addProductBtn: document.getElementById('addProductBtn'),
    productsList: document.getElementById('productsList'),
    paymentMethodsContainer: document.getElementById('paymentMethodsContainer'),
    subtotalValue: document.getElementById('subtotalValue'),
    discountValue: document.getElementById('discountValue'),
    totalValue: document.getElementById('totalValue'),
    paidValue: document.getElementById('paidValue'),
    remainingValue: document.getElementById('remainingValue'),
    registerSaleBtn: document.getElementById('registerSaleBtn'),
    clearSaleBtn: document.getElementById('clearSaleBtn'),
    
    // History
    historyTableBody: document.getElementById('historyTableBody'),
    
    // Products
    productNameInput: document.getElementById('productNameInput'),
    productCategoryInput: document.getElementById('productCategoryInput'),
    productPriceInput: document.getElementById('productPriceInput'),
    productCostInput: document.getElementById('productCostInput'),
    productStockInput: document.getElementById('productStockInput'),
    productMinStockInput: document.getElementById('productMinStockInput'),
    saveProductBtn: document.getElementById('saveProductBtn'),
    clearProductBtn: document.getElementById('clearProductBtn'),
    productsTableBody: document.getElementById('productsTableBody'),
    
    // Settings
    businessNameInput: document.getElementById('businessNameInput'),
    businessSloganInput: document.getElementById('businessSloganInput'),
    primaryColorInput: document.getElementById('primaryColorInput'),
    secondaryColorInput: document.getElementById('secondaryColorInput'),
    notificationsToggle: document.getElementById('notificationsToggle'),
    soundsToggle: document.getElementById('soundsToggle'),
    stockAlertsToggle: document.getElementById('stockAlertsToggle'),
    
    // Modals
    confirmModal: document.getElementById('confirmModal'),
    confirmMessage: document.getElementById('confirmMessage'),
    confirmActionBtn: document.getElementById('confirmActionBtn'),
    saleDetailsModal: document.getElementById('saleDetailsModal'),
    saleDetailsContent: document.getElementById('saleDetailsContent'),
    
    // Notifications
    notificationContainer: document.getElementById('notificationContainer'),
    
    // Animation
    saleAnimation: document.getElementById('saleAnimation'),
    
    // Hide Values
    hideValuesBtn: document.getElementById('hideValuesBtn')
};

// Gráficos
let charts = {
    salesChart: null,
    distributionChart: null,
    paymentChart: null,
    monthlyChart: null,
    financeChart: null,
    costsChart: null
};

// Inicialização do aplicativo
async function initApp() {
    loadAppData();
    setupEventListeners();
    setupCharts();
    
    // Verificar se já está logado
    const session = localStorage.getItem(DATA_KEYS.SESSION);
    if (session) {
        const sessionData = JSON.parse(session);
        if (sessionData.expires > Date.now()) {
            appState.currentUser = { username: 'admin', name: 'Administrador' };
            showMainApp();
            updateBusinessInfo();
            loadProducts();
            loadSalesHistory();
            updateCharts();
        } else {
            showLogin();
        }
    } else {
        showLogin();
    }
}

// Carregar dados do LocalStorage
function loadAppData() {
    const savedBusinessInfo = localStorage.getItem(DATA_KEYS.BUSINESS_INFO);
    if (savedBusinessInfo) {
        Object.assign(appState.businessInfo, JSON.parse(savedBusinessInfo));
    }
    
    const savedProducts = localStorage.getItem(DATA_KEYS.PRODUCTS);
    if (savedProducts) {
        appState.products = JSON.parse(savedProducts);
    }
    
    const savedSales = localStorage.getItem(DATA_KEYS.SALES);
    if (savedSales) {
        appState.sales = JSON.parse(savedSales);
    }
    
    const savedSettings = localStorage.getItem(DATA_KEYS.SETTINGS);
    if (savedSettings) {
        Object.assign(appState.settings, JSON.parse(savedSettings));
    }
}

// Salvar dados no LocalStorage
function saveAppData() {
    localStorage.setItem(DATA_KEYS.BUSINESS_INFO, JSON.stringify(appState.businessInfo));
    localStorage.setItem(DATA_KEYS.PRODUCTS, JSON.stringify(appState.products));
    localStorage.setItem(DATA_KEYS.SALES, JSON.stringify(appState.sales));
    localStorage.setItem(DATA_KEYS.SETTINGS, JSON.stringify(appState.settings));
}

// Configurar event listeners
function setupEventListeners() {
    // Login
    dom.loginBtn.addEventListener('click', handleLogin);
    dom.passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
    });
    
    // Logout
    dom.logoutBtn.addEventListener('click', handleLogout);
    
    // Tabs
    dom.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const sectionId = tab.dataset.tab;
            setActiveSection(sectionId);
        });
    });
    
    // Tema
    dom.themeToggle.addEventListener('click', toggleTheme);
    
    // Ocultar valores
    dom.hideValuesToggle.addEventListener('click', toggleHideValues);
    dom.hideValuesBtn.addEventListener('click', toggleHideValues);
    
    // Vendas
    dom.productSelect.addEventListener('change', updatePriceFromProduct);
    dom.addProductBtn.addEventListener('click', addProductToSale);
    dom.registerSaleBtn.addEventListener('click', registerSale);
    dom.clearSaleBtn.addEventListener('click', clearCurrentSale);
    
    // Produtos
    dom.saveProductBtn.addEventListener('click', saveProduct);
    dom.clearProductBtn.addEventListener('click', clearProductForm);
    
    // Configurações
    dom.primaryColorInput.addEventListener('change', updateThemeColors);
    dom.secondaryColorInput.addEventListener('change', updateThemeColors);
}

// Login
function handleLogin() {
    const username = dom.usernameInput.value.trim();
    const password = dom.passwordInput.value;
    
    // Sistema de login simples para demonstração
    if (username && password) {
        appState.currentUser = {
            username: username,
            name: username === 'admin' ? 'Administrador' : 'Vendedor',
            role: username === 'admin' ? 'admin' : 'seller'
        };
        
        // Salvar sessão
        const session = {
            username: username,
            expires: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 dias
        };
        localStorage.setItem(DATA_KEYS.SESSION, JSON.stringify(session));
        
        showMainApp();
        updateBusinessInfo();
        loadProducts();
        loadSalesHistory();
        updateCharts();
        
        showNotification('Login realizado com sucesso!', 'success');
    } else {
        showNotification('Preencha todos os campos', 'error');
    }
}

// Logout
function handleLogout() {
    showConfirm('Deseja realmente sair do sistema?', () => {
        appState.currentUser = null;
        localStorage.removeItem(DATA_KEYS.SESSION);
        showLogin();
        showNotification('Logout realizado com sucesso', 'info');
    });
}

// Mostrar tela de login
function showLogin() {
    dom.loginScreen.style.display = 'flex';
    dom.mainApp.style.display = 'none';
    
    // Resetar campos
    dom.usernameInput.value = '';
    dom.passwordInput.value = '';
    
    // Atualizar informações da empresa
    updateBusinessInfo();
}

// Mostrar aplicativo principal
function showMainApp() {
    dom.loginScreen.style.display = 'none';
    dom.mainApp.style.display = 'block';
    
    // Aplicar tema
    updateTheme();
    updateHideValues();
    
    // Atualizar botão de ocultar valores
    updateHideValuesButton();
}

// Atualizar informações da empresa
function updateBusinessInfo() {
    // Logo
    if (appState.businessInfo.logo) {
        dom.businessLogo.src = appState.businessInfo.logo;
        dom.businessAvatar.src = appState.businessInfo.logo;
    } else {
        const defaultIcon = "https://cdn-icons-png.flaticon.com/512/2917/2917633.png";
        dom.businessLogo.src = defaultIcon;
        dom.businessAvatar.src = defaultIcon;
    }
    
    // Nome e slogan
    dom.businessNameLogin.textContent = appState.businessInfo.name;
    dom.businessNameHeader.textContent = appState.businessInfo.name;
    dom.businessSlogan.textContent = appState.businessInfo.slogan;
    
    // Configurações
    dom.businessNameInput.value = appState.businessInfo.name;
    dom.businessSloganInput.value = appState.businessInfo.slogan;
    dom.primaryColorInput.value = appState.businessInfo.primaryColor;
    dom.secondaryColorInput.value = appState.businessInfo.secondaryColor;
    
    // Toggles
    dom.notificationsToggle.checked = appState.settings.notifications;
    dom.soundsToggle.checked = appState.settings.sounds;
    dom.stockAlertsToggle.checked = appState.settings.stockAlerts;
    
    // Aplicar cores
    applyThemeColors();
}

// Aplicar cores do tema
function applyThemeColors() {
    const root = document.documentElement;
    root.style.setProperty('--primary', appState.businessInfo.primaryColor);
    root.style.setProperty('--secondary', appState.businessInfo.secondaryColor);
    
    // Atualizar gradiente
    const primaryLight = lightenColor(appState.businessInfo.primaryColor, 20);
    const primaryDark = darkenColor(appState.businessInfo.primaryColor, 10);
    const secondaryLight = lightenColor(appState.businessInfo.secondaryColor, 20);
    
    root.style.setProperty('--primary-gradient', `linear-gradient(135deg, ${appState.businessInfo.primaryColor} 0%, ${primaryLight} 100%)`);
    root.style.setProperty('--primary-light', primaryLight);
    root.style.setProperty('--primary-dark', primaryDark);
    root.style.setProperty('--secondary-light', secondaryLight);
    root.style.setProperty('--text-gradient', `linear-gradient(135deg, ${appState.businessInfo.primaryColor} 0%, ${appState.businessInfo.secondaryColor} 100%)`);
}

// Atualizar cores do tema
function updateThemeColors() {
    appState.businessInfo.primaryColor = dom.primaryColorInput.value;
    appState.businessInfo.secondaryColor = dom.secondaryColorInput.value;
    applyThemeColors();
    saveAppData();
    showNotification('Cores do tema atualizadas', 'success');
}

// Alternar tema claro/escuro
function toggleTheme() {
    appState.settings.darkMode = !appState.settings.darkMode;
    saveAppData();
    updateTheme();
    showNotification(appState.settings.darkMode ? 'Modo escuro ativado' : 'Modo claro ativado', 'info');
}

// Aplicar tema
function updateTheme() {
    if (appState.settings.darkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        dom.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
        document.documentElement.removeAttribute('data-theme');
        dom.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
}

// Alternar ocultar valores
function toggleHideValues() {
    appState.settings.hideValues = !appState.settings.hideValues;
    saveAppData();
    updateHideValues();
    updateHideValuesButton();
    showNotification(appState.settings.hideValues ? 'Valores ocultos' : 'Valores visíveis', 'info');
}

// Atualizar estado dos valores ocultos
function updateHideValues() {
    const elements = document.querySelectorAll('[data-hide-value="true"]');
    elements.forEach(element => {
        if (appState.settings.hideValues) {
            element.dataset.originalValue = element.textContent;
            element.textContent = '•••••';
            element.style.filter = 'blur(5px)';
        } else {
            element.textContent = element.dataset.originalValue || element.textContent;
            element.style.filter = 'none';
        }
    });
    
    // Atualizar overlay de compra
    if (appState.currentSale.total > 0) {
        updatePurchaseOverlay();
    }
}

// Atualizar botão de ocultar valores
function updateHideValuesButton() {
    const icon = appState.settings.hideValues ? 'fa-eye' : 'fa-eye-slash';
    dom.hideValuesToggle.innerHTML = `<i class="fas ${icon}"></i>`;
    dom.hideValuesBtn.innerHTML = `<i class="fas ${icon}"></i>`;
}

// Atualizar overlay de valor da compra
function updatePurchaseOverlay() {
    if (appState.currentSale.total > 0) {
        dom.currentPurchaseValue.textContent = `Valor da compra: ${formatCurrency(appState.currentSale.total)}`;
        dom.purchaseValueOverlay.classList.add('show');
    } else {
        dom.purchaseValueOverlay.classList.remove('show');
    }
}

// Definir seção ativa
function setActiveSection(sectionId) {
    // Atualizar tabs
    dom.tabs.forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === sectionId);
    });
    
    // Atualizar seções
    document.querySelectorAll('.section').forEach(section => {
        section.classList.toggle('active', section.id === sectionId);
    });
    
    appState.settings.currentSection = sectionId;
    saveAppData();
    
    // Executar ações específicas da seção
    switch(sectionId) {
        case 'dashboard':
            updateDashboard();
            break;
        case 'sales':
            loadProducts();
            break;
        case 'history':
            loadSalesHistory();
            break;
        case 'products':
            loadProductsTable();
            break;
        case 'finance':
            updateFinanceCharts();
            break;
    }
}

// ============================================
// SISTEMA DE VENDAS
// ============================================

// Carregar produtos no select
function loadProducts() {
    dom.productSelect.innerHTML = '<option value="">Selecione um produto</option>';
    
    appState.products.forEach(product => {
        const option = document.createElement('option');
        option.value = product.id;
        option.textContent = `${product.name} - ${formatCurrency(product.price)} (Estoque: ${product.stock})`;
        dom.productSelect.appendChild(option);
    });
}

// Atualizar preço ao selecionar produto
function updatePriceFromProduct() {
    const productId = parseInt(dom.productSelect.value);
    if (!productId) return;
    
    const product = appState.products.find(p => p.id === productId);
    if (product) {
        dom.priceInput.value = product.price.toFixed(2);
    }
}

// Adicionar produto à venda
function addProductToSale() {
    const productId = parseInt(dom.productSelect.value);
    const quantity = parseInt(dom.quantityInput.value) || 1;
    const price = parseFloat(dom.priceInput.value) || 0;
    const discount = parseFloat(dom.discountInput.value) || 0;
    
    if (!productId) {
        showNotification('Selecione um produto', 'error');
        return;
    }
    
    if (quantity <= 0) {
        showNotification('Quantidade inválida', 'error');
        return;
    }
    
    if (price <= 0) {
        showNotification('Preço inválido', 'error');
        return;
    }
    
    const product = appState.products.find(p => p.id === productId);
    if (!product) {
        showNotification('Produto não encontrado', 'error');
        return;
    }
    
    // Verificar estoque
    if (product.stock < quantity) {
        showNotification(`Estoque insuficiente! Disponível: ${product.stock}`, 'error');
        return;
    }
    
    // Calcular valores
    const subtotal = price * quantity;
    const finalPrice = subtotal - discount;
    const cost = (product.cost || 0) * quantity;
    const profit = finalPrice - cost;
    
    // Adicionar à venda atual
    const saleProduct = {
        id: Date.now(),
        productId: productId,
        name: product.name,
        quantity: quantity,
        price: price,
        discount: discount,
        subtotal: subtotal,
        finalPrice: finalPrice,
        cost: cost,
        profit: profit
    };
    
    appState.currentSale.products.push(saleProduct);
    updateCurrentSale();
    updateSaleProductsDisplay();
    
    // Resetar campos
    dom.quantityInput.value = '1';
    dom.priceInput.value = '';
    dom.discountInput.value = '0';
    
    showNotification(`${product.name} adicionado à venda`, 'success');
}

// Atualizar venda atual
function updateCurrentSale() {
    // Calcular totais
    appState.currentSale.subtotal = appState.currentSale.products.reduce((sum, p) => sum + p.subtotal, 0);
    appState.currentSale.discount = appState.currentSale.products.reduce((sum, p) => sum + p.discount, 0);
    appState.currentSale.total = appState.currentSale.products.reduce((sum, p) => sum + p.finalPrice, 0);
    
    // Atualizar display
    dom.subtotalValue.textContent = formatCurrency(appState.currentSale.subtotal);
    dom.discountValue.textContent = formatCurrency(appState.currentSale.discount);
    dom.totalValue.textContent = formatCurrency(appState.currentSale.total);
    
    // Atualizar pagamentos
    updatePayments();
    
    // Atualizar overlay
    updatePurchaseOverlay();
    
    // Habilitar/desabilitar botão de finalizar
    dom.registerSaleBtn.disabled = appState.currentSale.products.length === 0;
}

// Atualizar display de produtos na venda
function updateSaleProductsDisplay() {
    const container = dom.productsList;
    
    if (appState.currentSale.products.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-shopping-cart"></i>
                <p>Nenhum produto adicionado à venda</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    appState.currentSale.products.forEach(product => {
        const item = document.createElement('div');
        item.className = 'product-item';
        item.innerHTML = `
            <div class="product-info">
                <h4>${product.name}</h4>
                <div class="product-details">
                    ${product.quantity} × ${formatCurrency(product.price)} = ${formatCurrency(product.subtotal)}
                    ${product.discount > 0 ? `<br><small>Desconto: -${formatCurrency(product.discount)}</small>` : ''}
                    <br><small>Total: ${formatCurrency(product.finalPrice)}</small>
                </div>
            </div>
            <div style="display: flex; align-items: center;">
                <span class="product-total">${formatCurrency(product.finalPrice)}</span>
                <button onclick="removeProductFromSale(${product.id})" class="remove-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        container.appendChild(item);
    });
}

// Remover produto da venda
function removeProductFromSale(productId) {
    appState.currentSale.products = appState.currentSale.products.filter(p => p.id !== productId);
    updateCurrentSale();
    updateSaleProductsDisplay();
    showNotification('Produto removido da venda', 'info');
}

// Sistema de pagamento múltiplo
let paymentMethodsCount = 1;

function addPaymentMethod() {
    paymentMethodsCount++;
    
    const paymentItem = document.createElement('div');
    paymentItem.className = 'payment-item';
    paymentItem.innerHTML = `
        <div class="payment-header">
            <select class="payment-select" onchange="updatePaymentMethod(${paymentMethodsCount - 1}, this.value)">
                <option value="cash">Dinheiro</option>
                <option value="pix">Pix</option>
                <option value="credit">Cartão Crédito</option>
                <option value="debit">Cartão Débito</option>
            </select>
            <button onclick="removePaymentMethod(${paymentMethodsCount - 1})" class="btn btn-danger btn-sm">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="payment-amount">
            <span>R$</span>
            <input type="number" min="0" step="0.01" placeholder="0,00" 
                   onchange="updatePaymentAmount(${paymentMethodsCount - 1}, this.value)"
                   oninput="updatePaymentAmount(${paymentMethodsCount - 1}, this.value)">
        </div>
    `;
    
    dom.paymentMethodsContainer.appendChild(paymentItem);
    
    // Adicionar ao estado
    appState.currentSale.payments.push({ method: 'cash', amount: 0 });
}

function removePaymentMethod(index) {
    if (appState.currentSale.payments.length <= 1) {
        showNotification('É necessário pelo menos uma forma de pagamento', 'warning');
        return;
    }
    
    // Remover do DOM
    const items = dom.paymentMethodsContainer.querySelectorAll('.payment-item');
    if (items[index]) {
        items[index].remove();
    }
    
    // Remover do estado
    appState.currentSale.payments.splice(index, 1);
    paymentMethodsCount--;
    
    // Reindexar
    updatePayments();
}

function updatePaymentMethod(index, method) {
    if (appState.currentSale.payments[index]) {
        appState.currentSale.payments[index].method = method;
        updatePayments();
    }
}

function updatePaymentAmount(index, amount) {
    if (appState.currentSale.payments[index]) {
        appState.currentSale.payments[index].amount = parseFloat(amount) || 0;
        updatePayments();
    }
}

function updatePayments() {
    const totalPaid = appState.currentSale.payments.reduce((sum, p) => sum + p.amount, 0);
    const remaining = appState.currentSale.total - totalPaid;
    
    dom.paidValue.textContent = formatCurrency(totalPaid);
    
    if (remaining > 0) {
        dom.remainingValue.textContent = `${formatCurrency(remaining)} (Falta)`;
        dom.remainingValue.style.color = 'var(--danger)';
    } else if (remaining < 0) {
        dom.remainingValue.textContent = `${formatCurrency(Math.abs(remaining))} (Troco)`;
        dom.remainingValue.style.color = 'var(--success)';
    } else {
        dom.remainingValue.textContent = formatCurrency(0);
        dom.remainingValue.style.color = 'var(--success)';
    }
    
    // Auto-distribuir valor se apenas um pagamento
    if (appState.currentSale.payments.length === 1 && appState.currentSale.total > 0) {
        const input = dom.paymentMethodsContainer.querySelector('.payment-amount input');
        if (input && parseFloat(input.value) === 0) {
            input.value = appState.currentSale.total.toFixed(2);
            appState.currentSale.payments[0].amount = appState.currentSale.total;
            updatePayments();
        }
    }
}

// Limpar venda atual
function clearCurrentSale() {
    if (appState.currentSale.products.length === 0) return;
    
    showConfirm('Deseja realmente cancelar esta venda?', () => {
        appState.currentSale = {
            products: [],
            subtotal: 0,
            discount: 0,
            total: 0,
            payments: [
                { method: 'cash', amount: 0 }
            ]
        };
        
        // Resetar DOM
        dom.productsList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-shopping-cart"></i>
                <p>Nenhum produto adicionado à venda</p>
            </div>
        `;
        
        dom.paymentMethodsContainer.innerHTML = `
            <div class="payment-item">
                <div class="payment-header">
                    <select class="payment-select" onchange="updatePaymentMethod(0, this.value)">
                        <option value="cash">Dinheiro</option>
                        <option value="pix">Pix</option>
                        <option value="credit">Cartão Crédito</option>
                        <option value="debit">Cartão Débito</option>
                    </select>
                    <button onclick="removePaymentMethod(0)" class="btn btn-danger btn-sm">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="payment-amount">
                    <span>R$</span>
                    <input type="number" min="0" step="0.01" placeholder="0,00" 
                           onchange="updatePaymentAmount(0, this.value)"
                           oninput="updatePaymentAmount(0, this.value)">
                </div>
            </div>
        `;
        
        paymentMethodsCount = 1;
        updateCurrentSale();
        showNotification('Venda cancelada', 'info');
    });
}

// Registrar venda
function registerSale() {
    if (appState.currentSale.products.length === 0) {
        showNotification('Adicione produtos à venda', 'error');
        return;
    }
    
    // Verificar pagamento
    const totalPaid = appState.currentSale.payments.reduce((sum, p) => sum + p.amount, 0);
    if (totalPaid < appState.currentSale.total) {
        showNotification(`Pagamento insuficiente! Falta ${formatCurrency(appState.currentSale.total - totalPaid)}`, 'error');
        return;
    }
    
    // Criar registro da venda
    const sale = {
        id: Date.now(),
        date: new Date().toISOString(),
        products: [...appState.currentSale.products],
        subtotal: appState.currentSale.subtotal,
        discount: appState.currentSale.discount,
        total: appState.currentSale.total,
        payments: [...appState.currentSale.payments],
        cost: appState.currentSale.products.reduce((sum, p) => sum + p.cost, 0),
        profit: appState.currentSale.products.reduce((sum, p) => sum + p.profit, 0)
    };
    
    // Atualizar estoque
    appState.currentSale.products.forEach(saleProduct => {
        const product = appState.products.find(p => p.id === saleProduct.productId);
        if (product) {
            product.stock -= saleProduct.quantity;
            
            // Verificar estoque baixo
            if (appState.settings.stockAlerts && product.stock <= product.minStock) {
                showNotification(`Estoque baixo: ${product.name} (${product.stock} unidades)`, 'warning');
            }
        }
    });
    
    // Adicionar ao histórico
    appState.sales.unshift(sale);
    
    // Limpar venda atual
    appState.currentSale = {
        products: [],
        subtotal: 0,
        discount: 0,
        total: 0,
        payments: [
            { method: 'cash', amount: 0 }
        ]
    };
    
    // Resetar DOM
    dom.productsList.innerHTML = `
        <div class="empty-state">
            <i class="fas fa-shopping-cart"></i>
            <p>Nenhum produto adicionado à venda</p>
        </div>
    `;
    
    paymentMethodsCount = 1;
    updateCurrentSale();
    
    // Salvar dados
    saveAppData();
    
    // Efeitos
    if (appState.settings.sounds) {
        playSaleSound();
    }
    
    if (appState.settings.notifications) {
        showSaleAnimation();
    }
    
    showNotification(`Venda registrada! Total: ${formatCurrency(sale.total)}`, 'success');
    
    // Atualizar dashboards
    updateDashboard();
    updateCharts();
    
    // Limpar automaticamente após sucesso
    setTimeout(() => {
        clearCurrentSale();
    }, 500);
}

// ============================================
// HISTÓRICO DE VENDAS
// ============================================

// Carregar histórico de vendas
function loadSalesHistory() {
    const tbody = dom.historyTableBody;
    tbody.innerHTML = '';
    
    if (appState.sales.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 3rem;">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>Nenhuma venda registrada</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    // Mostrar apenas as últimas 50 vendas para performance
    const recentSales = appState.sales.slice(0, 50);
    
    recentSales.forEach(sale => {
        const date = new Date(sale.date);
        const formattedDate = date.toLocaleDateString('pt-BR');
        const formattedTime = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        
        const productNames = sale.products.map(p => p.name).join(', ');
        const totalQuantity = sale.products.reduce((sum, p) => sum + p.quantity, 0);
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formattedDate} ${formattedTime}</td>
            <td>${productNames}</td>
            <td>${totalQuantity}</td>
            <td data-hide-value="true">${formatCurrency(sale.total)}</td>
            <td>${sale.payments.map(p => p.method).join(' + ')}</td>
            <td class="table-actions">
                <button onclick="viewSaleDetails(${sale.id})" class="action-btn edit" title="Ver Detalhes">
                    <i class="fas fa-eye"></i>
                </button>
                <button onclick="deleteSale(${sale.id})" class="action-btn delete" title="Excluir Venda">
                    <i class="fas fa-trash"></i>
                </button>
                <button onclick="downloadSaleReceipt(${sale.id})" class="action-btn download" title="Baixar Recibo">
                    <i class="fas fa-download"></i>
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
    
    // Atualizar valores ocultos
    updateHideValues();
}

// Ver detalhes da venda
function viewSaleDetails(saleId) {
    const sale = appState.sales.find(s => s.id === saleId);
    if (!sale) {
        showNotification('Venda não encontrada', 'error');
        return;
    }
    
    const date = new Date(sale.date);
    const formattedDate = date.toLocaleDateString('pt-BR');
    const formattedTime = date.toLocaleTimeString('pt-BR');
    
    let productsHtml = '';
    sale.products.forEach(product => {
        productsHtml += `
            <div style="padding: 10px; border-bottom: 1px solid var(--gray-200);">
                <div style="display: flex; justify-content: space-between;">
                    <strong>${product.name}</strong>
                    <span>${formatCurrency(product.finalPrice)}</span>
                </div>
                <div style="font-size: 0.9rem; color: var(--gray-600);">
                    ${product.quantity} × ${formatCurrency(product.price)} = ${formatCurrency(product.subtotal)}
                    ${product.discount > 0 ? ` - ${formatCurrency(product.discount)}` : ''}
                </div>
            </div>
        `;
    });
    
    let paymentsHtml = '';
    sale.payments.forEach(payment => {
        paymentsHtml += `
            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                <span>${getPaymentMethodName(payment.method)}</span>
                <span>${formatCurrency(payment.amount)}</span>
            </div>
        `;
    });
    
    dom.saleDetailsContent.innerHTML = `
        <div style="margin-bottom: 2rem;">
            <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Venda #${sale.id}</h4>
            <p><strong>Data:</strong> ${formattedDate} às ${formattedTime}</p>
            <p><strong>Vendedor:</strong> ${appState.currentUser?.name || 'Não informado'}</p>
        </div>
        
        <div style="margin-bottom: 2rem;">
            <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Produtos</h4>
            ${productsHtml}
        </div>
        
        <div style="margin-bottom: 2rem;">
            <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Pagamento</h4>
            ${paymentsHtml}
            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 2px solid var(--gray-300); margin-top: 10px;">
                <strong>Total</strong>
                <strong>${formatCurrency(sale.total)}</strong>
            </div>
        </div>
        
        <div style="background: var(--gray-50); padding: 1rem; border-radius: var(--border-radius-xs);">
            <p><strong>Subtotal:</strong> ${formatCurrency(sale.subtotal)}</p>
            <p><strong>Descontos:</strong> ${formatCurrency(sale.discount)}</p>
            <p><strong>Custo Total:</strong> ${formatCurrency(sale.cost)}</p>
            <p><strong>Lucro:</strong> ${formatCurrency(sale.profit)}</p>
        </div>
    `;
    
    showModal('saleDetailsModal');
}

// Excluir venda
function deleteSale(saleId) {
    showConfirm('Deseja realmente excluir esta venda? Esta ação não pode ser desfeita.', () => {
        const saleIndex = appState.sales.findIndex(s => s.id === saleId);
        if (saleIndex !== -1) {
            // Restaurar estoque dos produtos
            const sale = appState.sales[saleIndex];
            sale.products.forEach(saleProduct => {
                const product = appState.products.find(p => p.id === saleProduct.productId);
                if (product) {
                    product.stock += saleProduct.quantity;
                }
            });
            
            // Remover venda
            appState.sales.splice(saleIndex, 1);
            saveAppData();
            loadSalesHistory();
            updateDashboard();
            updateCharts();
            
            showNotification('Venda excluída com sucesso', 'success');
        }
    });
}

// Baixar recibo da venda
function downloadSaleReceipt(saleId) {
    const sale = appState.sales.find(s => s.id === saleId);
    if (!sale) {
        showNotification('Venda não encontrada', 'error');
        return;
    }
    
    const date = new Date(sale.date);
    const formattedDate = date.toLocaleDateString('pt-BR');
    const formattedTime = date.toLocaleTimeString('pt-BR');
    
    let receipt = `
        RECIBO DE VENDA
        ====================
        
        Empresa: ${appState.businessInfo.name}
        Data: ${formattedDate} ${formattedTime}
        Vendedor: ${appState.currentUser?.name || 'Não informado'}
        
        PRODUTOS:
        ${sale.products.map(p => `${p.quantity}x ${p.name} - ${formatCurrency(p.finalPrice)}`).join('\n')}
        
        RESUMO:
        Subtotal: ${formatCurrency(sale.subtotal)}
        Descontos: ${formatCurrency(sale.discount)}
        Total: ${formatCurrency(sale.total)}
        
        PAGAMENTO:
        ${sale.payments.map(p => `${getPaymentMethodName(p.method)}: ${formatCurrency(p.amount)}`).join('\n')}
        
        Obrigado pela preferência!
        ====================
    `;
    
    downloadTextFile(receipt, `recibo-venda-${saleId}.txt`);
    showNotification('Recibo baixado com sucesso', 'success');
}

// Exportar histórico em PDF
function exportHistoryPDF() {
    if (appState.sales.length === 0) {
        showNotification('Nenhuma venda para exportar', 'warning');
        return;
    }
    
    // Usar html2canvas e jsPDF para gerar PDF
    const table = document.getElementById('historyTable');
    html2canvas(table).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        const imgWidth = 190;
        const imgHeight = canvas.height * imgWidth / canvas.width;
        
        pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
        pdf.save(`historico-vendas-${new Date().toISOString().split('T')[0]}.pdf`);
        showNotification('PDF gerado com sucesso', 'success');
    }).catch(error => {
        console.error('Erro ao gerar PDF:', error);
        showNotification('Erro ao gerar PDF', 'error');
    });
}

// Limpar histórico
function clearHistory() {
    showConfirm('Deseja realmente limpar todo o histórico de vendas? Esta ação não pode ser desfeita.', () => {
        appState.sales = [];
        saveAppData();
        loadSalesHistory();
        updateDashboard();
        updateCharts();
        showNotification('Histórico limpo com sucesso', 'success');
    });
}

// ============================================
// GERENCIAMENTO DE PRODUTOS
// ============================================

// Carregar tabela de produtos
function loadProductsTable() {
    const tbody = dom.productsTableBody;
    tbody.innerHTML = '';
    
    if (appState.products.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 3rem;">
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <p>Nenhum produto cadastrado</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    appState.products.forEach(product => {
        const profit = product.price - (product.cost || 0);
        const profitMargin = product.price > 0 ? (profit / product.price) * 100 : 0;
        const stockStatus = product.stock <= product.minStock ? 'stock-low' : '';
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${product.name}</strong></td>
            <td>${getCategoryName(product.category)}</td>
            <td data-hide-value="true">${formatCurrency(product.price)}</td>
            <td data-hide-value="true">${formatCurrency(product.cost || 0)}</td>
            <td class="${stockStatus}">${product.stock}</td>
            <td data-hide-value="true">${formatCurrency(profit)} (${profitMargin.toFixed(1)}%)</td>
            <td class="table-actions">
                <button onclick="editProduct(${product.id})" class="action-btn edit" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button onclick="deleteProduct(${product.id})" class="action-btn delete" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
    
    updateHideValues();
}

// Salvar produto
function saveProduct() {
    const name = dom.productNameInput.value.trim();
    const category = dom.productCategoryInput.value;
    const price = parseFloat(dom.productPriceInput.value) || 0;
    const cost = parseFloat(dom.productCostInput.value) || 0;
    const stock = parseInt(dom.productStockInput.value) || 0;
    const minStock = parseInt(dom.productMinStockInput.value) || 5;
    
    if (!name) {
        showNotification('Digite o nome do produto', 'error');
        return;
    }
    
    if (price <= 0) {
        showNotification('Preço inválido', 'error');
        return;
    }
    
    if (cost < 0) {
        showNotification('Custo inválido', 'error');
        return;
    }
    
    if (stock < 0) {
        showNotification('Estoque inválido', 'error');
        return;
    }
    
    // Verificar se está editando
    const editId = dom.saveProductBtn.dataset.editId;
    
    if (editId) {
        // Editar produto existente
        const productIndex = appState.products.findIndex(p => p.id === parseInt(editId));
        if (productIndex !== -1) {
            appState.products[productIndex] = {
                ...appState.products[productIndex],
                name,
                category,
                price,
                cost,
                stock,
                minStock,
                updatedAt: new Date().toISOString()
            };
        }
        
        delete dom.saveProductBtn.dataset.editId;
        dom.saveProductBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Produto';
    } else {
        // Novo produto
        const newProduct = {
            id: Date.now(),
            name,
            category,
            price,
            cost,
            stock,
            minStock,
            createdAt: new Date().toISOString()
        };
        
        appState.products.push(newProduct);
    }
    
    saveAppData();
    loadProducts();
    loadProductsTable();
    clearProductForm();
    
    showNotification(editId ? 'Produto atualizado' : 'Produto cadastrado', 'success');
}

// Editar produto
function editProduct(productId) {
    const product = appState.products.find(p => p.id === productId);
    if (!product) return;
    
    dom.productNameInput.value = product.name;
    dom.productCategoryInput.value = product.category;
    dom.productPriceInput.value = product.price;
    dom.productCostInput.value = product.cost || 0;
    dom.productStockInput.value = product.stock;
    dom.productMinStockInput.value = product.minStock;
    
    dom.saveProductBtn.dataset.editId = productId;
    dom.saveProductBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Produto';
    
    // Scroll para o formulário
    document.getElementById('sales').scrollIntoView({ behavior: 'smooth' });
}

// Excluir produto
function deleteProduct(productId) {
    showConfirm('Deseja realmente excluir este produto?', () => {
        const productIndex = appState.products.findIndex(p => p.id === productId);
        if (productIndex !== -1) {
            // Verificar se o produto tem vendas
            const hasSales = appState.sales.some(sale => 
                sale.products.some(p => p.productId === productId)
            );
            
            if (hasSales) {
                showNotification('Este produto tem vendas registradas e não pode ser excluído', 'error');
                return;
            }
            
            appState.products.splice(productIndex, 1);
            saveAppData();
            loadProducts();
            loadProductsTable();
            showNotification('Produto excluído', 'success');
        }
    });
}

// Limpar formulário de produto
function clearProductForm() {
    dom.productNameInput.value = '';
    dom.productCategoryInput.value = 'bebidas';
    dom.productPriceInput.value = '';
    dom.productCostInput.value = '';
    dom.productStockInput.value = '0';
    dom.productMinStockInput.value = '5';
    
    delete dom.saveProductBtn.dataset.editId;
    dom.saveProductBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Produto';
}

// ============================================
// SISTEMA FINANCEIRO E GRÁFICOS
// ============================================

// Configurar gráficos
function setupCharts() {
    // Gráfico de vendas
    const salesCtx = document.getElementById('salesChart').getContext('2d');
    charts.salesChart = new Chart(salesCtx, {
        type: 'line',
        data: {
            labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
            datasets: [{
                label: 'Vendas (R$)',
                data: [850, 920, 1050, 980, 1200, 1450, 1300],
                borderColor: appState.businessInfo.primaryColor,
                backgroundColor: `${appState.businessInfo.primaryColor}20`,
                borderWidth: 3,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value;
                        }
                    }
                }
            }
        }
    });
    
    // Gráfico de distribuição
    const distributionCtx = document.getElementById('distributionChart').getContext('2d');
    charts.distributionChart = new Chart(distributionCtx, {
        type: 'doughnut',
        data: {
            labels: ['Bebidas', 'Comidas', 'Sobremesas', 'Acessórios'],
            datasets: [{
                data: [45, 30, 15, 10],
                backgroundColor: [
                    appState.businessInfo.primaryColor,
                    appState.businessInfo.secondaryColor,
                    lightenColor(appState.businessInfo.primaryColor, 30),
                    lightenColor(appState.businessInfo.secondaryColor, 30)
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right'
                }
            }
        }
    });
    
    // Gráfico de pagamentos
    const paymentCtx = document.getElementById('paymentChart').getContext('2d');
    charts.paymentChart = new Chart(paymentCtx, {
        type: 'bar',
        data: {
            labels: ['Dinheiro', 'Pix', 'Cartão'],
            datasets: [{
                label: 'Utilização',
                data: [40, 35, 25],
                backgroundColor: [
                    appState.businessInfo.primaryColor,
                    appState.businessInfo.secondaryColor,
                    lightenColor(appState.businessInfo.primaryColor, 20)
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}

// Atualizar gráficos
function updateCharts() {
    if (!charts.salesChart) return;
    
    // Atualizar dados reais
    const last7Days = getLast7DaysSales();
    charts.salesChart.data.datasets[0].data = last7Days;
    charts.salesChart.update();
    
    // Atualizar distribuição
    const distribution = getSalesDistribution();
    charts.distributionChart.data.datasets[0].data = distribution;
    charts.distributionChart.update();
    
    // Atualizar pagamentos
    const payments = getPaymentDistribution();
    charts.paymentChart.data.datasets[0].data = payments;
    charts.paymentChart.update();
}

// Atualizar dashboard
function updateDashboard() {
    // Calcular métricas
    const today = new Date().toISOString().split('T')[0];
    const todaySales = appState.sales.filter(sale => 
        sale.date.startsWith(today)
    );
    
    const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
    const todayProfit = todaySales.reduce((sum, sale) => sum + sale.profit, 0);
    
    // Atualizar cards (simplificado para exemplo)
    document.querySelectorAll('.card-value')[0].textContent = formatCurrency(todayTotal);
    document.querySelectorAll('.card-value')[1].textContent = formatCurrency(todayProfit);
    
    // Atualizar valores ocultos
    updateHideValues();
}

// Atualizar gráficos financeiros
function updateFinanceCharts() {
    // Criar gráfico financeiro se não existir
    if (!charts.financeChart) {
        const financeCtx = document.getElementById('financeChart').getContext('2d');
        charts.financeChart = new Chart(financeCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                datasets: [
                    {
                        label: 'Faturamento',
                        data: [25820, 28910, 31250, 29500, 32410, 35820],
                        borderColor: appState.businessInfo.primaryColor,
                        backgroundColor: `${appState.businessInfo.primaryColor}20`,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Lucro',
                        data: [12910, 14455, 15625, 14750, 16205, 17910],
                        borderColor: appState.businessInfo.secondaryColor,
                        backgroundColor: `${appState.businessInfo.secondaryColor}20`,
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value;
                            }
                        }
                    }
                }
            }
        });
    }
    
    if (!charts.costsChart) {
        const costsCtx = document.getElementById('costsChart').getContext('2d');
        charts.costsChart = new Chart(costsCtx, {
            type: 'bar',
            data: {
                labels: ['Produtos', 'Taxas', 'Transporte', 'Outros'],
                datasets: [{
                    label: 'Custos (R$)',
                    data: [18328, 4582, 2291, 4582],
                    backgroundColor: [
                        appState.businessInfo.primaryColor,
                        appState.businessInfo.secondaryColor,
                        lightenColor(appState.businessInfo.primaryColor, 30),
                        lightenColor(appState.businessInfo.secondaryColor, 30)
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value;
                            }
                        }
                    }
                }
            }
        });
    }
}

// ============================================
// FUNÇÕES UTILITÁRIAS
// ============================================

// Formatar moeda
function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
    }).format(value);
}

// Mostrar notificação
function showNotification(message, type = 'info') {
    if (!appState.settings.notifications) return;
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">${type.toUpperCase()}</div>
            <div class="notification-message">${message}</div>
        </div>
    `;
    
    dom.notificationContainer.appendChild(notification);
    
    // Mostrar
    setTimeout(() => notification.classList.add('show'), 10);
    
    // Remover após 5 segundos
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 400);
    }, 5000);
}

// Mostrar modal de confirmação
function showConfirm(message, callback) {
    dom.confirmMessage.textContent = message;
    appState.pendingAction = callback;
    showModal('confirmModal');
}

// Confirmar ação
function confirmAction() {
    if (appState.pendingAction) {
        appState.pendingAction();
        appState.pendingAction = null;
    }
    hideModal('confirmModal');
}

// Mostrar modal
function showModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// Ocultar modal
function hideModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.remove('active');
    document.body.style.overflow = '';
}

// Tocar som de venda
function playSaleSound() {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
    } catch (e) {
        // Audio não suportado
    }
}

// Mostrar animação de venda
function showSaleAnimation() {
    dom.saleAnimation.classList.add('show');
    setTimeout(() => {
        dom.saleAnimation.classList.remove('show');
    }, 1000);
}

// Obter nome do método de pagamento
function getPaymentMethodName(method) {
    const methods = {
        cash: 'Dinheiro',
        pix: 'Pix',
        credit: 'Cartão Crédito',
        debit: 'Cartão Débito'
    };
    return methods[method] || method;
}

// Obter nome da categoria
function getCategoryName(category) {
    const categories = {
        bebidas: 'Bebidas',
        comidas: 'Comidas',
        sobremesas: 'Sobremesas',
        acessorios: 'Acessórios',
        outros: 'Outros'
    };
    return categories[category] || category;
}

// Clariar cor
function lightenColor(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    
    return '#' + (
        0x1000000 +
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
}

// Escurecer cor
function darkenColor(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) - amt;
    const G = (num >> 8 & 0x00FF) - amt;
    const B = (num & 0x0000FF) - amt;
    
    return '#' + (
        0x1000000 +
        (R > 0 ? R : 0) * 0x10000 +
        (G > 0 ? G : 0) * 0x100 +
        (B > 0 ? B : 0)
    ).toString(16).slice(1);
}

// Baixar arquivo de texto
function downloadTextFile(content, filename) {
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Exportar backup
function exportBackup() {
    const backup = {
        appState: appState,
        exportDate: new Date().toISOString(),
        version: '1.0.0'
    };
    
    const backupStr = JSON.stringify(backup, null, 2);
    downloadTextFile(backupStr, `praiavendas-backup-${new Date().toISOString().split('T')[0]}.json`);
    showNotification('Backup exportado com sucesso', 'success');
}

// Importar backup
function importBackup() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const backup = JSON.parse(event.target.result);
                
                showConfirm('Deseja restaurar este backup? Todos os dados atuais serão substituídos.', () => {
                    Object.assign(appState, backup.appState);
                    saveAppData();
                    location.reload();
                });
            } catch (err) {
                showNotification('Erro ao ler arquivo de backup', 'error');
            }
        };
        reader.readAsText(file);
    };
    
    input.click();
}

// Salvar configurações
function saveSettings() {
    appState.businessInfo.name = dom.businessNameInput.value.trim() || appState.businessInfo.name;
    appState.businessInfo.slogan = dom.businessSloganInput.value.trim() || appState.businessInfo.slogan;
    
    appState.settings.notifications = dom.notificationsToggle.checked;
    appState.settings.sounds = dom.soundsToggle.checked;
    appState.settings.stockAlerts = dom.stockAlertsToggle.checked;
    
    saveAppData();
    updateBusinessInfo();
    showNotification('Configurações salvas com sucesso', 'success');
}

// Obter vendas dos últimos 7 dias
function getLast7DaysSales() {
    const salesByDay = [0, 0, 0, 0, 0, 0, 0];
    const today = new Date();
    
    for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        
        const daySales = appState.sales.filter(sale => 
            sale.date.startsWith(dateStr)
        );
        
        salesByDay[6 - i] = daySales.reduce((sum, sale) => sum + sale.total, 0);
    }
    
    return salesByDay;
}

// Obter distribuição de vendas
function getSalesDistribution() {
    const categories = {
        bebidas: 0,
        comidas: 0,
        sobremesas: 0,
        acessorios: 0,
        outros: 0
    };
    
    appState.sales.forEach(sale => {
        sale.products.forEach(productSale => {
            const product = appState.products.find(p => p.id === productSale.productId);
            if (product) {
                categories[product.category] = (categories[product.category] || 0) + productSale.finalPrice;
            }
        });
    });
    
    return [
        categories.bebidas || 0,
        categories.comidas || 0,
        categories.sobremesas || 0,
        categories.acessorios || 0
    ];
}

// Obter distribuição de pagamentos
function getPaymentDistribution() {
    const methods = {
        cash: 0,
        pix: 0,
        credit: 0,
        debit: 0
    };
    
    appState.sales.forEach(sale => {
        sale.payments.forEach(payment => {
            methods[payment.method] = (methods[payment.method] || 0) + payment.amount;
        });
    });
    
    const total = Object.values(methods).reduce((a, b) => a + b, 0);
    if (total === 0) return [0, 0, 0];
    
    return [
        (methods.cash / total) * 100,
        ((methods.pix || 0) / total) * 100,
        (((methods.credit || 0) + (methods.debit || 0)) / total) * 100
    ];
}

// Imprimir detalhes da venda
function printSaleDetails() {
    const printContent = dom.saleDetailsContent.innerHTML;
    const originalContent = document.body.innerHTML;
    
    document.body.innerHTML = `
        <div style="padding: 20px; font-family: Arial, sans-serif;">
            <h1 style="text-align: center; color: #333;">${appState.businessInfo.name}</h1>
            <div style="margin-top: 30px;">
                ${printContent}
            </div>
            <div style="margin-top: 40px; text-align: center; color: #666; font-size: 12px;">
                Emitido em: ${new Date().toLocaleString('pt-BR')}
            </div>
        </div>
    `;
    
    window.print();
    document.body.innerHTML = originalContent;
    location.reload();
}

// Inicializar aplicativo quando o DOM estiver pronto
document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>

