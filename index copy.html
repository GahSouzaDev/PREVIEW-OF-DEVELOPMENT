<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PraiaVendas | Gestão Inteligente para Vendedores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary: #FF9800;
            --primary-light: #FFB74D;
            --secondary: #2196F3;
            --success: #4CAF50;
            --success-light: #A5D6A7;
            --danger: #F44336;
            --warning: #FFC107;
            --info: #29B6F6;
            --dark: #333333;
            --light: #FFFFFF;
            --gray: #757575;
            --gray-light: #F5F5F5;
            --gray-dark: #424242;
            --beach-blue: #4FC3F7;
            --beach-sand: #FFECB3;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --border-radius: 16px;
        }

        [data-theme="dark"] {
            --primary: #FFB74D;
            --primary-light: #FFCC80;
            --secondary: #64B5F6;
            --success: #81C784;
            --success-light: #388E3C;
            --danger: #E57373;
            --warning: #FFD54F;
            --info: #4FC3F7;
            --dark: #F5F5F5;
            --light: #121212;
            --gray: #BDBDBD;
            --gray-light: #1E1E1E;
            --gray-dark: #BDBDBD;
            --beach-blue: #29B6F6;
            --beach-sand: #FFD54F;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #E3F2FD 0%, #FFF3E0 100%);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0D1B2A 0%, #1B263B 100%);
            color: var(--dark);
        }

        /* CORREÇÃO PARA MODO ESCURO - CAMPOS DE FORMULÁRIO */
        input, select, textarea {
            background-color: var(--light) !important;
            color: var(--dark) !important;
            border: 2px solid #E0E0E0 !important;
        }

        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            background-color: var(--gray-light) !important;
            color: var(--dark) !important;
            border-color: #444 !important;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary) !important;
            outline: none !important;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                        url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 2000;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.6s ease;
        }

        [data-theme="dark"] .login-box {
            background: #1E1E1E;
        }

        .business-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--primary);
            margin: 0 auto 1.5rem;
            display: block;
        }

        .business-name {
            text-align: center;
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 2rem;
            font-weight: 700;
        }

        .login-input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 1rem;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 0.5rem;
        }

        .login-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--danger);
            text-align: center;
            margin-top: 1rem;
            display: none;
        }

        /* Header */
        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 1rem 0.5rem;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .business-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .business-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
        }

        .business-info h1 {
            font-size: 1.3rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .business-info span {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: white;
            font-size: 1.2rem;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .tabs-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: thin;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            padding: 3px;
            min-width: max-content;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            text-align: center;
            padding: 8px 5px;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* Main container */
        .container {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard */
        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 1.5rem;
        }

        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 1.2rem;
            box-shadow: var(--card-shadow);
            text-align: center;
            border-top: 5px solid var(--primary);
            transition: var(--transition);
        }

        [data-theme="dark"] .summary-card {
            background: #1E1E1E;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .summary-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0.5rem 0;
            font-family: 'Courier New', monospace;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* NOVO: Sistema de Meta Diária */
        .daily-goal-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            color: white;
            box-shadow: var(--card-shadow);
        }

        .daily-goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .daily-goal-header h2 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .daily-goal-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .goal-progress-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
        }

        .goal-progress-title {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .goal-progress-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .goal-progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .goal-progress-fill {
            height: 100%;
            background: white;
            border-radius: 6px;
            transition: width 1s ease;
        }

        .goal-recommendation {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .goal-recommendation i {
            color: var(--warning);
            margin-right: 8px;
        }

        .goal-setter {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 1rem;
        }

        .goal-setter input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }

        .goal-setter input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .goal-setter button {
            background: white;
            color: var(--primary);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .goal-setter button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Controle de Produtos para Meta */
        .product-control-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
        }

        [data-theme="dark"] .product-control-section {
            background: #1E1E1E;
        }

        .product-control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .product-control-card {
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 1rem;
            transition: var(--transition);
        }

        [data-theme="dark"] .product-control-card {
            border-color: #444;
        }

        .product-control-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .product-control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .product-control-name {
            font-weight: 600;
            color: var(--dark);
        }

        .product-control-profit {
            color: var(--success);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .product-control-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray);
            margin: 0.5rem 0;
        }

        .product-control-actions {
            display: flex;
            gap: 8px;
            margin-top: 0.8rem;
        }

        .product-control-actions button {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Filtros */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: white;
            border: 2px solid #E0E0E0;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Cards */
        .sale-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--success);
        }

        [data-theme="dark"] .sale-card {
            background: #1E1E1E;
        }

        .sale-form {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.9rem;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }

        button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(33, 150, 243, 0.3);
        }

        button.secondary {
            background: var(--secondary);
        }

        button.danger {
            background: var(--danger);
        }

        button.success {
            background: var(--success);
        }

        button.info {
            background: var(--info);
        }

        /* PAGAMENTO MISTO */
        .mixed-payment-section {
            margin-top: 1.5rem;
            border-top: 2px dashed #E0E0E0;
            padding-top: 1.5rem;
        }

        .mixed-payment-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .mixed-payment-title h3 {
            color: var(--primary);
            font-size: 1.1rem;
        }

        .mixed-payment-item {
            background: var(--gray-light);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #E0E0E0;
            transition: var(--transition);
        }

        [data-theme="dark"] .mixed-payment-item {
            background: #2A2A2A;
            border-color: #444;
        }

        .mixed-payment-item:hover {
            border-color: var(--primary);
        }

        .mixed-payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .mixed-payment-method {
            font-weight: 600;
            color: var(--dark);
        }

        .mixed-payment-select {
            width: 150px;
            padding: 8px;
            font-size: 0.9rem;
            border-radius: 5px;
            border: 1px solid #E0E0E0;
        }

        .mixed-payment-amount {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 0.5rem;
        }

        .mixed-payment-amount input {
            width: 120px;
            padding: 8px;
            font-size: 0.95rem;
        }

        .mixed-payment-total {
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 1rem;
            text-align: center;
        }

        .mixed-payment-total span {
            font-size: 1.2rem;
        }

        .remove-payment-btn {
            background: var(--danger);
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            border: none;
        }

        .remove-payment-btn:hover {
            background: #D32F2F;
        }

        .add-payment-btn {
            background: var(--secondary);
            width: 100%;
            padding: 10px;
            margin-top: 0.5rem;
        }

        .remaining-amount {
            margin-top: 0.5rem;
            padding: 8px;
            border-radius: 5px;
            font-size: 0.9rem;
            text-align: center;
        }

        .remaining-positive {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .remaining-negative {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .remaining-zero {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        /* Animações */
        .sale-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
        }

        .sale-animation.show {
            animation: salePop 1s ease forwards;
        }

        @keyframes salePop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        /* Produtos */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid #E0E0E0;
        }

        [data-theme="dark"] .product-card {
            background: #1E1E1E;
            border-color: #444;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            height: 150px;
            background: linear-gradient(to right, var(--primary-light), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .product-info {
            padding: 1rem;
        }

        .product-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .product-price {
            color: var(--success);
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .product-stock {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .stock-low {
            color: var(--danger);
            font-weight: 600;
        }

        /* Financeiro */
        .chart-container {
            height: 300px;
            margin: 1.5rem 0;
            position: relative;
        }

        .transaction-list {
            margin-top: 1.5rem;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #E0E0E0;
            transition: var(--transition);
        }

        [data-theme="dark"] .transaction-item {
            border-color: #444;
        }

        .transaction-item:hover {
            background: #F5F5F5;
        }

        [data-theme="dark"] .transaction-item:hover {
            background: #2A2A2A;
        }

        .transaction-type {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .transaction-income {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .transaction-expense {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        /* Configurações */
        .settings-section {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }

        [data-theme="dark"] .settings-section {
            background: #1E1E1E;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 0 3px var(--dark);
            transform: scale(1.1);
        }

        .photo-upload {
            text-align: center;
            padding: 2rem;
            border: 2px dashed #E0E0E0;
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .photo-upload:hover {
            border-color: var(--primary);
            background: #F5F5F5;
        }

        .user-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            border: 3px solid var(--primary);
        }

        /* Notificações */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--success);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        [data-theme="dark"] .notification {
            background: #1E1E1E;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-danger {
            color: var(--danger);
        }

        .notification-warning {
            color: var(--warning);
        }

        .notification-info {
            color: var(--secondary);
        }

        /* Modais */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        [data-theme="dark"] .modal-content {
            background: #1E1E1E;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .container {
                padding: 0.8rem;
            }
            
            .dashboard-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .business-info h1 {
                font-size: 1.1rem;
            }
            
            .tab {
                min-width: 70px;
                font-size: 0.8rem;
                padding: 6px 4px;
            }
            
            .header-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .mixed-payment-amount {
                flex-direction: column;
                gap: 5px;
            }
            
            .mixed-payment-amount input {
                width: 100%;
            }
            
            .mixed-payment-select {
                width: 100%;
            }
            
            .daily-goal-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .dashboard-summary {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-btn {
                width: 100%;
            }
            
            .business-header {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }
            
            .product-control-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animações de números */
        .counting-up {
            animation: countUp 1s ease-out;
        }

        @keyframes countUp {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .data-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #E0E0E0;
        }

        .data-table tr:hover {
            background: #F5F5F5;
        }

        [data-theme="dark"] .data-table tr:hover {
            background: #2A2A2A;
        }
        
        .btn-small {
            padding: 5px 10px !important;
            font-size: 0.8rem !important;
            margin: 0 2px;
        }
        
        .btn-danger {
            background: var(--danger) !important;
        }
        
        .btn-warning {
            background: var(--warning) !important;
            color: #000 !important;
        }
        
        .actions-cell {
            white-space: nowrap;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .editable-change-fund {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .editable-change-fund input {
            flex: 1;
        }

        /* NOVA ABA: METAS */
        .goal-tracking-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
        }

        [data-theme="dark"] .goal-tracking-section {
            background: #1E1E1E;
        }

        .goal-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .goal-metric-card {
            background: var(--gray-light);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
            border-left: 4px solid var(--primary);
        }

        [data-theme="dark"] .goal-metric-card {
            background: #2A2A2A;
        }

        .goal-metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .goal-metric-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .goal-history {
            margin-top: 2rem;
        }

        .goal-day-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #E0E0E0;
            transition: var(--transition);
        }

        [data-theme="dark"] .goal-day-card {
            border-color: #444;
        }

        .goal-day-card:hover {
            background: var(--gray-light);
        }

        .goal-day-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .goal-achieved {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .goal-partial {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .goal-not-achieved {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        /* Indicador de progresso circular */
        .circular-progress {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .circular-progress svg {
            width: 100%;
            height: 100%;
        }

        .circular-progress-circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .circular-progress-bg {
            stroke: rgba(255, 255, 255, 0.2);
        }

        .circular-progress-fill {
            stroke: white;
            transition: stroke-dashoffset 1s ease;
        }

        .circular-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        /* Melhorias visuais para tabelas */
        .table-responsive {
            overflow-x: auto;
        }

        .table-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 10px 10px 0 0;
            font-weight: 600;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-success {
            background: var(--success-light);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(244, 67, 54, 0.2);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(33, 150, 243, 0.2);
            color: var(--secondary);
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <img id="businessLogo" class="business-logo" src="" alt="Logo do Negócio">
            <h1 id="businessNameLogin" class="business-name">PraiaVendas</h1>
            <input type="text" id="usernameInput" class="login-input" placeholder="Usuário" autocomplete="username">
            <input type="password" id="passwordInput" class="login-input" placeholder="Senha" autocomplete="current-password">
            <button id="loginBtn" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Entrar
            </button>
            <div id="loginError" class="login-error">
                <i class="fas fa-exclamation-circle"></i> Usuário ou senha incorretos
            </div>
        </div>
    </div>

    <!-- Aplicativo Principal (oculto inicialmente) -->
    <div id="mainApp" style="display: none;">
        <header>
            <div class="header-content">
                <div class="business-header">
                    <img id="businessAvatar" class="business-avatar" src="" alt="Avatar">
                    <div class="business-info">
                        <h1 id="businessNameHeader">PraiaVendas</h1>
                        <span id="businessSlogan">Vendas na Praia</span>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="header-btn" id="notificationToggle">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="header-btn" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="header-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="dashboard">
                            <i class="fas fa-home"></i> Início
                        </div>
                        <div class="tab" data-tab="goals">
                            <i class="fas fa-bullseye"></i> Metas
                        </div>
                        <div class="tab" data-tab="sales">
                            <i class="fas fa-shopping-cart"></i> Vendas
                        </div>
                        <div class="tab" data-tab="payment-methods">
                            <i class="fas fa-credit-card"></i> Pagamentos
                        </div>
                        <div class="tab" data-tab="costs">
                            <i class="fas fa-money-bill-wave"></i> Custos
                        </div>
                        <div class="tab" data-tab="products">
                            <i class="fas fa-box"></i> Produtos
                        </div>
                        <div class="tab" data-tab="finance">
                            <i class="fas fa-chart-line"></i> Financeiro
                        </div>
                        <div class="tab" data-tab="settings">
                            <i class="fas fa-cog"></i> Configurações
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="filters">
                    <button class="filter-btn active" data-filter="today">Hoje</button>
                    <button class="filter-btn" data-filter="week">Esta Semana</button>
                    <button class="filter-btn" data-filter="month">Este Mês</button>
                    <button class="filter-btn" data-filter="all">Todo Período</button>
                </div>
                
                <!-- NOVA SEÇÃO: Meta Diária -->
                <div class="daily-goal-section" id="dailyGoalSection">
                    <div class="daily-goal-header">
                        <h2><i class="fas fa-bullseye"></i> Meta de Lucro Diário</h2>
                        <button onclick="showGoalModal()" class="secondary">
                            <i class="fas fa-cog"></i> Configurar Meta
                        </button>
                    </div>
                    
                    <div class="daily-goal-content">
                        <div class="goal-progress-card">
                            <div class="goal-progress-title">Lucro Hoje</div>
                            <div class="goal-progress-value" id="todayProfitValue">R$ 0,00</div>
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill" id="todayProgressFill" style="width: 0%"></div>
                            </div>
                            <div class="goal-progress-title">
                                <span id="todayProgressText">0% da meta</span>
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltip-text">Percentual da sua meta diária já atingido</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="goal-progress-card">
                            <div class="goal-progress-title">Meta Diária</div>
                            <div class="goal-progress-value" id="dailyGoalValue">R$ 0,00</div>
                            <div class="circular-progress">
                                <svg viewBox="0 0 36 36">
                                    <path class="circular-progress-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circular-progress-fill" id="circularProgress" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
                                          stroke-dasharray="100, 100" />
                                </svg>
                                <div class="circular-progress-text" id="circularProgressText">0%</div>
                            </div>
                        </div>
                        
                        <div class="goal-progress-card">
                            <div class="goal-progress-title">Falta para Meta</div>
                            <div class="goal-progress-value" id="remainingGoalValue">R$ 0,00</div>
                            <div class="goal-progress-title">Produto mais lucrativo:</div>
                            <div class="goal-progress-value" id="bestProductProfit">R$ 0,00</div>
                            <div class="goal-progress-title">
                                <span id="unitsNeededText">0 unidades</span>
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltip-text">Quantas unidades do produto mais lucrativo faltam para bater a meta</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goal-recommendation" id="goalRecommendation">
                        <i class="fas fa-lightbulb"></i>
                        <span id="recommendationText">Defina sua meta diária para começar a acompanhar seu progresso!</span>
                    </div>
                </div>
                
                <div class="dashboard-summary">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="summary-value" id="totalSalesValue">R$ 0,00</div>
                        <div class="summary-label">Vendas Totais</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="summary-value" id="totalProductsSold">0</div>
                        <div class="summary-label">Produtos Vendidos</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="summary-value" id="grossRevenue">R$ 0,00</div>
                        <div class="summary-label">Faturamento Bruto</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="summary-value" id="netRevenue">R$ 0,00</div>
                        <div class="summary-label">Faturamento Líquido</div>
                    </div>
                </div>
                
                <div class="sale-card">
                    <h3><i class="fas fa-chart-pie"></i> Resumo Financeiro Detalhado</h3>
                    <div class="dashboard-summary" style="margin-top: 1rem;">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="summary-value" id="cmvValue">R$ 0,00</div>
                            <div class="summary-label">CMV/CPV</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="summary-value" id="machineFee">R$ 0,00</div>
                            <div class="summary-label">Taxa Maquininha</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="summary-value" id="changeFund">R$ 0,00</div>
                            <div class="summary-label">Fundo de Troco</div>
                            <div class="editable-change-fund">
                                <input type="number" id="changeFundInput" min="0" step="0.01" placeholder="0.00" style="padding: 5px; font-size: 0.9rem;">
                                <button onclick="updateChangeFund()" class="btn-small success" style="padding: 5px 10px;">
                                    <i class="fas fa-save"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="summary-value" id="salaryValue">R$ 0,00</div>
                            <div class="summary-label">Salário (Pró-labore)</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
            </section>
            
            <!-- NOVA SEÇÃO: Sistema de Metas -->
            <section id="goals" class="section">
                <div class="goal-tracking-section">
                    <h2><i class="fas fa-bullseye"></i> Sistema de Acompanhamento de Metas</h2>
                    <p style="margin: 1rem 0; color: var(--gray);">
                        <i class="fas fa-user-circle"></i> Sistema pessoal de autoavaliação e planejamento
                    </p>
                    
                    <div class="goal-metrics-grid">
                        <div class="goal-metric-card">
                            <div class="goal-metric-label">Meta Diária Atual</div>
                            <div class="goal-metric-value" id="currentDailyGoal">R$ 0,00</div>
                            <button onclick="showGoalModal()" class="btn-small secondary" style="margin-top: 10px;">
                                <i class="fas fa-edit"></i> Alterar
                            </button>
                        </div>
                        
                        <div class="goal-metric-card">
                            <div class="goal-metric-label">Média dos Últimos 7 Dias</div>
                            <div class="goal-metric-value" id="weeklyAverage">R$ 0,00</div>
                            <div class="goal-metric-label" id="weeklyTrend">
                                <i class="fas fa-minus"></i> Sem variação
                            </div>
                        </div>
                        
                        <div class="goal-metric-card">
                            <div class="goal-metric-label">Dias no Mês</div>
                            <div class="goal-metric-value" id="daysThisMonth">0/30</div>
                            <div class="goal-metric-label">Meta Mensal: <span id="monthlyGoalEstimate">R$ 0,00</span></div>
                        </div>
                        
                        <div class="goal-metric-card">
                            <div class="goal-metric-label">Taxa de Sucesso</div>
                            <div class="goal-metric-value" id="successRate">0%</div>
                            <div class="goal-metric-label">Dias que bateu a meta</div>
                        </div>
                    </div>
                    
                    <div class="goal-setter">
                        <input type="number" id="newDailyGoal" placeholder="Ex: 150.00" step="0.01" min="0">
                        <button onclick="setDailyGoal()" class="success">
                            <i class="fas fa-check"></i> Definir Meta Diária
                        </button>
                    </div>
                    
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--gray);">
                        <i class="fas fa-info-circle"></i> Esta meta é para seu acompanhamento pessoal. Ninguém mais tem acesso a esses dados.
                    </p>
                </div>
                
                <!-- Controle de Produtos para Metas -->
                <div class="product-control-section">
                    <h3><i class="fas fa-box-open"></i> Produtos Cadastrados para Cálculo de Lucro</h3>
                    <p style="margin-bottom: 1rem; color: var(--gray);">
                        Cadastre seus produtos com custo e preço de venda para calcular o lucro líquido por unidade.
                    </p>
                    
                    <div class="product-control-grid" id="productControlGrid">
                        <!-- Produtos serão carregados aqui -->
                    </div>
                    
                    <button onclick="showProductModal()" class="secondary" style="margin-top: 1rem;">
                        <i class="fas fa-plus"></i> Cadastrar Novo Produto
                    </button>
                </div>
                
                <!-- Histórico de Metas -->
                <div class="goal-tracking-section">
                    <h3><i class="fas fa-history"></i> Histórico de Desempenho Diário</h3>
                    <div id="goalHistoryList" class="goal-history">
                        <!-- Histórico será carregado aqui -->
                    </div>
                </div>
            </section>
            
            <!-- Vendas COM PAGAMENTO MISTO -->
            <section id="sales" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-cash-register"></i> Nova Venda</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="productSelect">Produto</label>
                            <select id="productSelect">
                                <option value="">Selecione um produto</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantityInput">Quantidade</label>
                            <input type="number" id="quantityInput" min="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="priceInput">Preço Unitário (R$)</label>
                            <input type="number" id="priceInput" min="0.01" step="0.01" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="saleTotal">Total da Venda (R$)</label>
                            <input type="number" id="saleTotal" readonly style="font-weight: bold; color: var(--success);">
                        </div>
                    </div>
                    
                    <!-- SEÇÃO DE PAGAMENTO MISTO -->
                    <div class="mixed-payment-section">
                        <div class="mixed-payment-title">
                            <h3><i class="fas fa-money-check-alt"></i> Pagamento Misto</h3>
                            <button id="addMixedPaymentBtn" class="add-payment-btn">
                                <i class="fas fa-plus"></i> Adicionar Forma
                            </button>
                        </div>
                        
                        <div id="mixedPaymentContainer">
                            <!-- Os métodos de pagamento serão adicionados aqui dinamicamente -->
                        </div>
                        
                        <div id="paymentSummary">
                            <div class="mixed-payment-total">
                                Total Pago: R$ <span id="totalPaid">0.00</span>
                            </div>
                            <div id="remainingAmount" class="remaining-amount remaining-zero">
                                Restante: R$ <span id="remainingValue">0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <button id="registerSaleBtn">
                            <i class="fas fa-check"></i> Registrar Venda
                        </button>
                        <button onclick="updateGoalDisplay()" class="secondary" style="margin-left: 10px;">
                            <i class="fas fa-sync-alt"></i> Atualizar Meta
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-history"></i> Vendas de Hoje</h3>
                    <div id="recentSalesList">
                        <!-- Vendas recentes serão carregadas aqui -->
                    </div>
                </div>
            </section>
            
            <!-- Formas de Pagamento (gerenciamento) -->
            <section id="payment-methods" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-credit-card"></i> Formas de Pagamento</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="paymentMethodName">Nome</label>
                            <input type="text" id="paymentMethodName" placeholder="Ex: Pix, Dinheiro, Cartão...">
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentMethodType">Tipo</label>
                            <select id="paymentMethodType">
                                <option value="pix">Pix</option>
                                <option value="cash">Dinheiro</option>
                                <option value="credit">Cartão Crédito</option>
                                <option value="debit">Cartão Débito</option>
                                <option value="other">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentMethodFee">Taxa (%)</label>
                            <input type="number" id="paymentMethodFee" min="0" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <button id="savePaymentMethodBtn">
                            <i class="fas fa-plus"></i> Adicionar Forma de Pagamento
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-list"></i> Formas de Pagamento Cadastradas</h3>
                    <table class="data-table" id="paymentMethodsTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Taxa</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="paymentMethodsList">
                            <!-- Formas de pagamento serão carregadas aqui -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Custos -->
            <section id="costs" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-money-bill-wave"></i> Adicionar Custo</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="costDescription">Descrição</label>
                            <input type="text" id="costDescription" placeholder="Ex: Transporte, Alimentação...">
                        </div>
                        
                        <div class="form-group">
                            <label for="costCategory">Categoria</label>
                            <select id="costCategory">
                                <option value="transport">Transporte</option>
                                <option value="food">Alimentação</option>
                                <option value="machine_fee">Taxa Maquininha</option>
                                <option value="donation">Doação</option>
                                <option value="barter">Escambo</option>
                                <option value="gift">Brinde</option>
                                <option value="water">Água</option>
                                <option value="electricity">Luz</option>
                                <option value="gas">Gás</option>
                                <option value="salary">Salário (Pró-labore)</option>
                                <option value="employee">Funcionário</option>
                                <option value="other">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="costValue">Valor (R$)</label>
                            <input type="number" id="costValue" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="costDate">Data</label>
                            <input type="date" id="costDate">
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <button id="addCostBtn">
                            <i class="fas fa-plus"></i> Adicionar Custo
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-calculator"></i> Custo das Mercadorias Vendidas (CMV)</h3>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="initialStock">Estoque Inicial (R$)</label>
                            <input type="number" id="initialStock" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="purchases">Compras (R$)</label>
                            <input type="number" id="purchases" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="finalStock">Estoque Final (R$)</label>
                            <input type="number" id="finalStock" min="0" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <button id="calculateCMVBtn">
                        <i class="fas fa-calculator"></i> Calcular CMV
                    </button>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--success); color: white; border-radius: 10px; display: none;" id="cmvResult">
                        <h3>CMV: R$ <span id="cmvResultValue">0.00</span></h3>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-history"></i> Custos Registrados</h3>
                    <table class="data-table" id="costsTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="costsList">
                            <!-- Custos serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Produtos -->
            <section id="products" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-plus-circle"></i> Adicionar Produto</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="productName">Nome do Produto</label>
                            <input type="text" id="productName" placeholder="Ex: Água de Coco, Sorvete...">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Categoria</label>
                            <select id="productCategory">
                                <option value="bebidas">Bebidas</option>
                                <option value="comidas">Comidas</option>
                                <option value="sobremesas">Sobremesas</option>
                                <option value="acessorios">Acessórios</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">Preço de Venda (R$)</label>
                            <input type="number" id="productPrice" min="0.01" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCost">Custo Unitário (R$)</label>
                            <input type="number" id="productCost" min="0.01" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="productStock">Estoque Inicial</label>
                            <input type="number" id="productStock" min="1" value="10">
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <button id="addProductBtn">
                            <i class="fas fa-plus"></i> Adicionar Produto
                        </button>
                    </div>
                </div>
                
                <h3 style="margin: 1.5rem 0 1rem;"><i class="fas fa-boxes"></i> Meus Produtos</h3>
                <div class="products-grid" id="productsList">
                    <!-- Produtos serão carregados aqui -->
                </div>
            </section>
            
            <!-- Financeiro -->
            <section id="finance" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-chart-pie"></i> Resumo Financeiro</h2>
                    <div class="dashboard-summary" style="margin-top: 1rem;">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-money-bill"></i>
                            </div>
                            <div class="summary-value" id="totalRevenue">R$ 0,00</div>
                            <div class="summary-label">Receita Total</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-sack-dollar"></i>
                            </div>
                            <div class="summary-value" id="profitValue">R$ 0,00</div>
                            <div class="summary-label">Lucro Estimado</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="summary-value" id="marginValue">0%</div>
                            <div class="summary-label">Margem Líquida</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="financeChart"></canvas>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-download"></i> Exportar Dados</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button id="exportSalesBtn" class="secondary">
                            <i class="fas fa-file-csv"></i> Exportar Vendas (CSV)
                        </button>
                        <button id="exportProductsBtn" class="secondary">
                            <i class="fas fa-file-excel"></i> Exportar Produtos (Excel)
                        </button>
                        <button id="exportFinanceBtn" class="secondary">
                            <i class="fas fa-file-pdf"></i> Relatório Financeiro (PDF)
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-chart-bar"></i> Projeções Futuras</h3>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="targetRevenue">Meta de Faturamento (R$)</label>
                            <input type="number" id="targetRevenue" min="0" step="0.01" placeholder="1000.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="targetPeriod">Período (dias)</label>
                            <input type="number" id="targetPeriod" min="1" value="30">
                        </div>
                    </div>
                    
                    <button id="calculateProjectionBtn">
                        <i class="fas fa-chart-line"></i> Calcular Projeção
                    </button>
                    
                    <div id="projectionResult" style="margin-top: 1rem; display: none;">
                        <!-- Resultado da projeção será exibido aqui -->
                    </div>
                </div>
            </section>
            
            <!-- Configurações -->
            <section id="settings" class="section">
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-store"></i> Informações do Negócio</h3>
                    <div class="form-group">
                        <label for="businessNameInput">Nome do Negócio</label>
                        <input type="text" id="businessNameInput" placeholder="Nome do seu negócio">
                    </div>
                    
                    <div class="form-group">
                        <label for="businessSloganInput">Slogan ou Descrição</label>
                        <input type="text" id="businessSloganInput" placeholder="Ex: As melhores águas de coco da praia!">
                    </div>
                    
                    <div class="form-group">
                        <label>Foto do Negócio</label>
                        <div class="photo-upload" id="photoUpload">
                            <img id="businessPhotoPreview" class="user-photo" src="" alt="Foto do Negócio">
                            <p>Clique para alterar a foto</p>
                            <input type="file" id="businessPhotoInput" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <button id="saveBusinessInfoBtn">
                        <i class="fas fa-save"></i> Salvar Informações
                    </button>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-palette"></i> Personalização</h3>
                    <div class="color-picker">
                        <div class="color-option selected" style="background-color: #FF9800;" data-color="#FF9800"></div>
                        <div class="color-option" style="background-color: #2196F3;" data-color="#2196F3"></div>
                        <div class="color-option" style="background-color: #4CAF50;" data-color="#4CAF50"></div>
                        <div class="color-option" style="background-color: #9C27B0;" data-color="#9C27B0"></div>
                        <div class="color-option" style="background-color: #FF5722;" data-color="#FF5722"></div>
                        <div class="color-option" style="background-color: #00BCD4;" data-color="#00BCD4"></div>
                        <div class="color-option" style="background-color: #FF4081;" data-color="#FF4081"></div>
                        <div class="color-option" style="background-color: #3F51B5;" data-color="#3F51B5"></div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-bell"></i> Notificações e Sons</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Sons de Venda</span>
                            <label class="switch">
                                <input type="checkbox" id="saleSoundsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Notificações de Estoque Baixo</span>
                            <label class="switch">
                                <input type="checkbox" id="stockNotificationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Animações</span>
                            <label class="switch">
                                <input type="checkbox" id="animationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Notificações de Meta Diária</span>
                            <label class="switch">
                                <input type="checkbox" id="goalNotificationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-database"></i> Gerenciamento de Dados</h3>
                    <div style="display: grid; gap: 1rem;">
                        <button id="backupDataBtn" class="secondary">
                            <i class="fas fa-save"></i> Fazer Backup
                        </button>
                        <button id="restoreDataBtn" class="secondary">
                            <i class="fas fa-undo"></i> Restaurar Backup
                        </button>
                        <button id="resetDataBtn" class="danger">
                            <i class="fas fa-trash"></i> Limpar Todos os Dados
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Notificações -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operação realizada com sucesso!</span>
    </div>

    <!-- Animação de venda -->
    <div class="sale-animation" id="saleAnimation">
        <i class="fas fa-money-bill-wave"></i>
    </div>

    <!-- Modal de Configuração de Meta -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-bullseye"></i> Configurar Meta Diária</h3>
            <p style="margin-bottom: 1rem;">Defina sua meta pessoal de lucro líquido diário:</p>
            
            <div class="form-group">
                <label for="modalDailyGoal">Meta de Lucro Diário (R$)</label>
                <input type="number" id="modalDailyGoal" min="0" step="0.01" placeholder="Ex: 150.00">
            </div>
            
            <div class="form-group">
                <label for="goalDescription">Descrição (opcional)</label>
                <input type="text" id="goalDescription" placeholder="Ex: Meta para viagem, poupança...">
            </div>
            
            <div style="background: var(--gray-light); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <h4><i class="fas fa-lightbulb"></i> Sugestões Baseadas no Histórico</h4>
                <div id="goalSuggestions" style="margin-top: 0.5rem;">
                    <!-- Sugestões serão carregadas aqui -->
                </div>
            </div>
            
            <div class="modal-actions">
                <button onclick="hideGoalModal()" class="secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="saveDailyGoal()" class="success">
                    <i class="fas fa-check"></i> Salvar Meta
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro de Produto para Meta -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-box"></i> Cadastrar Produto para Cálculo de Lucro</h3>
            
            <div class="form-group">
                <label for="modalProductName">Nome do Produto</label>
                <input type="text" id="modalProductName" placeholder="Ex: Água de Coco 500ml">
            </div>
            
            <div class="form-group">
                <label for="modalProductCost">Custo Unitário (R$)</label>
                <input type="number" id="modalProductCost" min="0.01" step="0.01" placeholder="Ex: 2.50">
            </div>
            
            <div class="form-group">
                <label for="modalProductPrice">Preço de Venda (R$)</label>
                <input type="number" id="modalProductPrice" min="0.01" step="0.01" placeholder="Ex: 5.00">
            </div>
            
            <div style="background: var(--success-light); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <h4><i class="fas fa-calculator"></i> Cálculo Automático</h4>
                <div style="margin-top: 0.5rem;">
                    <div>Lucro por unidade: <strong id="profitPerUnitCalc">R$ 0,00</strong></div>
                    <div>Margem de lucro: <strong id="profitMarginCalc">0%</strong></div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button onclick="hideProductModal()" class="secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="saveGoalProduct()" class="success">
                    <i class="fas fa-check"></i> Cadastrar Produto
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Cookies -->
    <div class="modal" id="cookieModal">
        <div class="modal-content">
            <h3 class="modal-title">Privacidade e Armazenamento</h3>
            <p>O PraiaVendas armazena todos os dados localmente no seu dispositivo para garantir sua privacidade. Nenhuma informação sai do seu celular. Usamos cookies para melhorar sua experiência e manter você logado.</p>
            <p style="margin-top: 1rem;"><strong>Seus dados ficam salvos por até 12 meses.</strong></p>
            <div class="modal-actions">
                <button id="acceptCookies" class="success">
                    <i class="fas fa-check"></i> Aceitar e Continuar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============ SISTEMA DE METAS DIÁRIAS ============
        
        // Estrutura de dados para metas
        const GOAL_DATA_KEYS = {
            DAILY_GOAL: 'praiaVendas_dailyGoal',
            GOAL_PRODUCTS: 'praiaVendas_goalProducts',
            GOAL_HISTORY: 'praiaVendas_goalHistory',
            GOAL_SETTINGS: 'praiaVendas_goalSettings'
        };

        // Estado do sistema de metas
        let goalState = {
            dailyGoal: 0,
            goalDescription: '',
            goalProducts: [],
            goalHistory: [],
            settings: {
                notifications: true,
                autoCalculate: true,
                showRecommendations: true
            },
            todayProfit: 0,
            todaySales: []
        };

        // ============ FUNÇÕES DO SISTEMA DE METAS ============

        // Carregar dados das metas
        function loadGoalData() {
            const savedDailyGoal = localStorage.getItem(GOAL_DATA_KEYS.DAILY_GOAL);
            if (savedDailyGoal) goalState.dailyGoal = parseFloat(savedDailyGoal);
            
            const savedGoalProducts = localStorage.getItem(GOAL_DATA_KEYS.GOAL_PRODUCTS);
            if (savedGoalProducts) goalState.goalProducts = JSON.parse(savedGoalProducts);
            
            const savedGoalHistory = localStorage.getItem(GOAL_DATA_KEYS.GOAL_HISTORY);
            if (savedGoalHistory) goalState.goalHistory = JSON.parse(savedGoalHistory);
            
            const savedGoalSettings = localStorage.getItem(GOAL_DATA_KEYS.GOAL_SETTINGS);
            if (savedGoalSettings) goalState.settings = JSON.parse(savedGoalSettings);
        }

        // Salvar dados das metas
        function saveGoalData() {
            localStorage.setItem(GOAL_DATA_KEYS.DAILY_GOAL, goalState.dailyGoal.toString());
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_PRODUCTS, JSON.stringify(goalState.goalProducts));
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_HISTORY, JSON.stringify(goalState.goalHistory));
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_SETTINGS, JSON.stringify(goalState.settings));
        }

        // Calcular lucro de hoje
        function calculateTodayProfit() {
            const today = new Date().toISOString().split('T')[0];
            goalState.todayProfit = 0;
            goalState.todaySales = [];
            
            // Filtrar vendas de hoje
            const todaySales = appState.sales.filter(sale => {
                const saleDate = new Date(sale.date).toISOString().split('T')[0];
                return saleDate === today;
            });
            
            // Calcular lucro líquido de cada venda
            todaySales.forEach(sale => {
                const product = goalState.goalProducts.find(p => p.name === sale.productName);
                if (product) {
                    const profit = (product.profitPerUnit * sale.quantity) - sale.machineFee;
                    goalState.todayProfit += profit;
                    
                    goalState.todaySales.push({
                        ...sale,
                        profit: profit,
                        productProfitPerUnit: product.profitPerUnit
                    });
                } else {
                    // Se não encontrar produto cadastrado, estima 50% de lucro
                    const estimatedProfit = (sale.total * 0.5) - sale.machineFee;
                    goalState.todayProfit += estimatedProfit;
                }
            });
            
            // Subtrair custos de hoje
            const todayCosts = appState.costs.filter(cost => {
                const costDate = new Date(cost.date).toISOString().split('T')[0];
                return costDate === today && cost.category !== 'salary';
            });
            
            todayCosts.forEach(cost => {
                goalState.todayProfit -= cost.value;
            });
            
            return goalState.todayProfit;
        }

        // Atualizar display da meta
        function updateGoalDisplay() {
            const todayProfit = calculateTodayProfit();
            const dailyGoal = goalState.dailyGoal;
            
            // Atualizar valores na tela
            document.getElementById('todayProfitValue').textContent = `R$ ${todayProfit.toFixed(2)}`;
            document.getElementById('dailyGoalValue').textContent = `R$ ${dailyGoal.toFixed(2)}`;
            document.getElementById('currentDailyGoal').textContent = `R$ ${dailyGoal.toFixed(2)}`;
            
            // Calcular progresso
            let progress = 0;
            let remaining = dailyGoal;
            
            if (dailyGoal > 0) {
                progress = Math.min((todayProfit / dailyGoal) * 100, 100);
                remaining = Math.max(dailyGoal - todayProfit, 0);
            }
            
            document.getElementById('remainingGoalValue').textContent = `R$ ${remaining.toFixed(2)}`;
            document.getElementById('todayProgressText').textContent = `${progress.toFixed(1)}% da meta`;
            document.getElementById('circularProgressText').textContent = `${progress.toFixed(0)}%`;
            
            // Atualizar barras de progresso
            document.getElementById('todayProgressFill').style.width = `${progress}%`;
            
            const circumference = 2 * Math.PI * 15.9155;
            const offset = circumference - (progress / 100) * circumference;
            document.getElementById('circularProgress').style.strokeDashoffset = offset;
            
            // Calcular e mostrar produto mais lucrativo
            updateBestProductInfo();
            
            // Atualizar recomendação
            updateGoalRecommendation(todayProfit, dailyGoal, progress);
            
            // Atualizar métricas adicionais
            updateGoalMetrics();
            
            // Atualizar histórico
            updateGoalHistory();
            
            // Atualizar produtos cadastrados
            updateGoalProductsDisplay();
        }

        // Atualizar informações do produto mais lucrativo
        function updateBestProductInfo() {
            if (goalState.goalProducts.length === 0) {
                document.getElementById('bestProductProfit').textContent = 'R$ 0,00';
                document.getElementById('unitsNeededText').textContent = 'Cadastre produtos';
                return;
            }
            
            // Encontrar produto com maior lucro por unidade
            const bestProduct = goalState.goalProducts.reduce((prev, current) => 
                (prev.profitPerUnit > current.profitPerUnit) ? prev : current
            );
            
            document.getElementById('bestProductProfit').textContent = `R$ ${bestProduct.profitPerUnit.toFixed(2)}`;
            
            // Calcular unidades necessárias para bater a meta
            const remaining = Math.max(goalState.dailyGoal - goalState.todayProfit, 0);
            const unitsNeeded = Math.ceil(remaining / bestProduct.profitPerUnit);
            
            document.getElementById('unitsNeededText').textContent = `${unitsNeeded} unidades`;
        }

        // Atualizar recomendação baseada no progresso
        function updateGoalRecommendation(todayProfit, dailyGoal, progress) {
            const recommendationEl = document.getElementById('recommendationText');
            let recommendation = '';
            
            if (dailyGoal === 0) {
                recommendation = 'Defina sua meta diária para começar a acompanhar seu progresso!';
            } else if (progress >= 100) {
                recommendation = '🎉 Parabéns! Você já bateu sua meta hoje!';
            } else if (progress >= 75) {
                recommendation = 'Ótimo trabalho! Você está quase lá!';
            } else if (progress >= 50) {
                recommendation = 'Bom progresso! Continue assim!';
            } else if (progress >= 25) {
                recommendation = 'Você está no caminho certo!';
            } else if (todayProfit > 0) {
                recommendation = 'Começou bem! Mantenha o ritmo!';
            } else {
                recommendation = 'Hora de começar! Venda seu primeiro produto hoje!';
            }
            
            // Adicionar dica de produto se houver produtos cadastrados
            if (goalState.goalProducts.length > 0 && progress < 100) {
                const bestProduct = goalState.goalProducts.reduce((prev, current) => 
                    (prev.profitPerUnit > current.profitPerUnit) ? prev : current
                );
                
                const remaining = dailyGoal - todayProfit;
                const unitsNeeded = Math.ceil(remaining / bestProduct.profitPerUnit);
                
                recommendation += ` Foque em vender ${unitsNeeded} unidades de ${bestProduct.name} para bater a meta!`;
            }
            
            recommendationEl.textContent = recommendation;
        }

        // Atualizar métricas das metas
        function updateGoalMetrics() {
            // Calcular média dos últimos 7 dias
            const last7Days = getLastNDays(7);
            const weeklyAverage = last7Days.reduce((sum, day) => sum + day.profit, 0) / 7;
            document.getElementById('weeklyAverage').textContent = `R$ ${weeklyAverage.toFixed(2)}`;
            
            // Calcular tendência
            const previousWeek = getLastNDays(14).slice(0, 7);
            const previousAverage = previousWeek.reduce((sum, day) => sum + day.profit, 0) / 7;
            const trend = weeklyAverage - previousAverage;
            
            const trendEl = document.getElementById('weeklyTrend');
            if (trend > 0) {
                trendEl.innerHTML = `<i class="fas fa-arrow-up" style="color: var(--success);"></i> +${trend.toFixed(2)}`;
            } else if (trend < 0) {
                trendEl.innerHTML = `<i class="fas fa-arrow-down" style="color: var(--danger);"></i> ${trend.toFixed(2)}`;
            } else {
                trendEl.innerHTML = `<i class="fas fa-minus"></i> Sem variação`;
            }
            
            // Dias no mês
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const today = now.getDate();
            document.getElementById('daysThisMonth').textContent = `${today}/${daysInMonth}`;
            
            // Meta mensal estimada
            const monthlyEstimate = goalState.dailyGoal * daysInMonth;
            document.getElementById('monthlyGoalEstimate').textContent = `R$ ${monthlyEstimate.toFixed(2)}`;
            
            // Taxa de sucesso
            const successDays = goalState.goalHistory.filter(day => day.profit >= day.goal && day.goal > 0).length;
            const totalDays = goalState.goalHistory.filter(day => day.goal > 0).length;
            const successRate = totalDays > 0 ? (successDays / totalDays) * 100 : 0;
            document.getElementById('successRate').textContent = `${successRate.toFixed(0)}%`;
        }

        // Obter dados dos últimos N dias
        function getLastNDays(n) {
            const days = [];
            const today = new Date();
            
            for (let i = 0; i < n; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // Buscar no histórico
                const historyDay = goalState.goalHistory.find(d => d.date === dateStr);
                
                if (historyDay) {
                    days.push(historyDay);
                } else {
                    // Calcular lucro para esse dia
                    const dayProfit = calculateDayProfit(dateStr);
                    days.push({
                        date: dateStr,
                        profit: dayProfit,
                        goal: 0
                    });
                }
            }
            
            return days;
        }

        // Calcular lucro de um dia específico
        function calculateDayProfit(dateStr) {
            let profit = 0;
            
            // Vendas do dia
            const daySales = appState.sales.filter(sale => {
                const saleDate = new Date(sale.date).toISOString().split('T')[0];
                return saleDate === dateStr;
            });
            
            daySales.forEach(sale => {
                const product = goalState.goalProducts.find(p => p.name === sale.productName);
                if (product) {
                    profit += (product.profitPerUnit * sale.quantity) - sale.machineFee;
                } else {
                    profit += (sale.total * 0.5) - sale.machineFee;
                }
            });
            
            // Custos do dia
            const dayCosts = appState.costs.filter(cost => {
                const costDate = new Date(cost.date).toISOString().split('T')[0];
                return costDate === dateStr && cost.category !== 'salary';
            });
            
            dayCosts.forEach(cost => {
                profit -= cost.value;
            });
            
            return profit;
        }

        // Atualizar histórico de metas
        function updateGoalHistory() {
            const historyList = document.getElementById('goalHistoryList');
            historyList.innerHTML = '';
            
            // Mostrar apenas últimos 14 dias
            const last14Days = getLastNDays(14);
            
            if (last14Days.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Nenhum histórico disponível</p>
                        <p style="font-size: 0.9rem;">Seu histórico será gerado automaticamente</p>
                    </div>
                `;
                return;
            }
            
            last14Days.forEach(day => {
                const dayDate = new Date(day.date);
                const formattedDate = dayDate.toLocaleDateString('pt-BR', { 
                    weekday: 'short',
                    day: '2-digit',
                    month: 'short'
                });
                
                const goal = day.goal || goalState.dailyGoal;
                const progress = goal > 0 ? (day.profit / goal) * 100 : 0;
                
                let status = 'goal-not-achieved';
                let statusText = 'Não atingida';
                
                if (goal > 0) {
                    if (day.profit >= goal) {
                        status = 'goal-achieved';
                        statusText = 'Meta atingida';
                    } else if (progress >= 50) {
                        status = 'goal-partial';
                        statusText = 'Parcial';
                    }
                }
                
                const dayCard = document.createElement('div');
                dayCard.className = 'goal-day-card';
                dayCard.innerHTML = `
                    <div>
                        <div style="font-weight: 600;">${formattedDate}</div>
                        <div style="font-size: 0.85rem; color: var(--gray);">
                            Lucro: R$ ${day.profit.toFixed(2)}
                            ${goal > 0 ? ` | Meta: R$ ${goal.toFixed(2)}` : ''}
                        </div>
                    </div>
                    <div class="goal-day-status ${status}">${statusText}</div>
                `;
                
                historyList.appendChild(dayCard);
            });
        }

        // Atualizar display dos produtos cadastrados
        function updateGoalProductsDisplay() {
            const productGrid = document.getElementById('productControlGrid');
            productGrid.innerHTML = '';
            
            if (goalState.goalProducts.length === 0) {
                productGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                        <i class="fas fa-box-open fa-3x" style="color: var(--gray); margin-bottom: 1rem;"></i>
                        <h3>Nenhum produto cadastrado</h3>
                        <p>Cadastre seus produtos para calcular o lucro exato por venda</p>
                        <button onclick="showProductModal()" class="secondary" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Cadastrar Primeiro Produto
                        </button>
                    </div>
                `;
                return;
            }
            
            goalState.goalProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-control-card';
                productCard.innerHTML = `
                    <div class="product-control-header">
                        <div class="product-control-name">${product.name}</div>
                        <div class="product-control-profit">+R$ ${product.profitPerUnit.toFixed(2)}</div>
                    </div>
                    <div class="product-control-stats">
                        <div>Custo: R$ ${product.cost.toFixed(2)}</div>
                        <div>Venda: R$ ${product.price.toFixed(2)}</div>
                        <div>Margem: ${product.margin.toFixed(1)}%</div>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--gray);">
                        <i class="fas fa-chart-line"></i> Contribuição hoje: R$ ${(product.profitPerUnit * getTodaySalesCount(product.name)).toFixed(2)}
                    </div>
                    <div class="product-control-actions">
                        <button onclick="editGoalProduct(${product.id})" class="btn-small info">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button onclick="deleteGoalProduct(${product.id})" class="btn-small danger">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                `;
                
                productGrid.appendChild(productCard);
            });
        }

        // Obter contagem de vendas de hoje para um produto
        function getTodaySalesCount(productName) {
            return goalState.todaySales.filter(sale => sale.productName === productName)
                .reduce((sum, sale) => sum + sale.quantity, 0);
        }

        // Definir meta diária
        function setDailyGoal() {
            const input = document.getElementById('newDailyGoal');
            const value = parseFloat(input.value);
            
            if (!value || value <= 0) {
                showNotification("Digite um valor válido para a meta", "danger");
                return;
            }
            
            goalState.dailyGoal = value;
            saveGoalData();
            updateGoalDisplay();
            
            input.value = '';
            showNotification(`Meta diária definida em R$ ${value.toFixed(2)}`, "success");
            
            // Registrar no histórico
            addGoalToHistory();
        }

        // Adicionar meta ao histórico
        function addGoalToHistory() {
            const today = new Date().toISOString().split('T')[0];
            const todayProfit = calculateTodayProfit();
            
            // Verificar se já existe entrada para hoje
            const existingIndex = goalState.goalHistory.findIndex(d => d.date === today);
            
            if (existingIndex !== -1) {
                goalState.goalHistory[existingIndex].goal = goalState.dailyGoal;
            } else {
                goalState.goalHistory.unshift({
                    date: today,
                    profit: todayProfit,
                    goal: goalState.dailyGoal
                });
            }
            
            // Manter apenas últimos 90 dias no histórico
            goalState.goalHistory = goalState.goalHistory.slice(0, 90);
            saveGoalData();
        }

        // Mostrar modal de configuração de meta
        function showGoalModal() {
            document.getElementById('modalDailyGoal').value = goalState.dailyGoal;
            document.getElementById('goalDescription').value = goalState.goalDescription;
            
            // Gerar sugestões
            generateGoalSuggestions();
            
            document.getElementById('goalModal').classList.add('show');
        }

        // Ocultar modal de configuração de meta
        function hideGoalModal() {
            document.getElementById('goalModal').classList.remove('show');
        }

        // Salvar meta do modal
        function saveDailyGoal() {
            const value = parseFloat(document.getElementById('modalDailyGoal').value);
            const description = document.getElementById('goalDescription').value;
            
            if (!value || value <= 0) {
                showNotification("Digite um valor válido para a meta", "danger");
                return;
            }
            
            goalState.dailyGoal = value;
            goalState.goalDescription = description;
            saveGoalData();
            updateGoalDisplay();
            
            hideGoalModal();
            showNotification(`Meta diária salva: R$ ${value.toFixed(2)}`, "success");
            
            // Registrar no histórico
            addGoalToHistory();
        }

        // Gerar sugestões de meta
        function generateGoalSuggestions() {
            const suggestionsEl = document.getElementById('goalSuggestions');
            suggestionsEl.innerHTML = '';
            
            // Calcular média dos últimos 7 dias
            const last7Days = getLastNDays(7);
            const weeklyAverage = last7Days.reduce((sum, day) => sum + day.profit, 0) / 7;
            
            // Calcular melhor dia
            const bestDay = last7Days.reduce((prev, current) => 
                (prev.profit > current.profit) ? prev : current
            );
            
            const suggestions = [
                { value: weeklyAverage * 1.1, label: `10% acima da média (R$ ${(weeklyAverage * 1.1).toFixed(2)})` },
                { value: weeklyAverage * 1.25, label: `25% acima da média (R$ ${(weeklyAverage * 1.25).toFixed(2)})` },
                { value: bestDay.profit, label: `Igual ao melhor dia (R$ ${bestDay.profit.toFixed(2)})` },
                { value: 150, label: 'Meta comum (R$ 150,00)' },
                { value: 250, label: 'Meta desafio (R$ 250,00)' }
            ];
            
            suggestions.forEach(suggestion => {
                const button = document.createElement('button');
                button.className = 'btn-small secondary';
                button.style.margin = '0 5px 5px 0';
                button.innerHTML = suggestion.label;
                button.onclick = () => {
                    document.getElementById('modalDailyGoal').value = suggestion.value.toFixed(2);
                };
                suggestionsEl.appendChild(button);
            });
        }

        // Mostrar modal de produto para meta
        function showProductModal(editId = null) {
            const modal = document.getElementById('productModal');
            const title = modal.querySelector('.modal-title');
            const saveButton = modal.querySelector('.modal-actions .success');
            
            if (editId !== null) {
                // Modo edição
                const product = goalState.goalProducts.find(p => p.id === editId);
                if (product) {
                    document.getElementById('modalProductName').value = product.name;
                    document.getElementById('modalProductCost').value = product.cost;
                    document.getElementById('modalProductPrice').value = product.price;
                    title.innerHTML = `<i class="fas fa-edit"></i> Editar Produto`;
                    saveButton.innerHTML = `<i class="fas fa-save"></i> Salvar Alterações`;
                    saveButton.dataset.editId = editId;
                }
            } else {
                // Modo criação
                document.getElementById('modalProductName').value = '';
                document.getElementById('modalProductCost').value = '';
                document.getElementById('modalProductPrice').value = '';
                title.innerHTML = `<i class="fas fa-box"></i> Cadastrar Produto para Cálculo de Lucro`;
                saveButton.innerHTML = `<i class="fas fa-check"></i> Cadastrar Produto`;
                delete saveButton.dataset.editId;
            }
            
            // Calcular lucro automaticamente
            updateProfitCalculation();
            
            modal.classList.add('show');
        }

        // Ocultar modal de produto
        function hideProductModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        // Atualizar cálculo de lucro no modal
        function updateProfitCalculation() {
            const cost = parseFloat(document.getElementById('modalProductCost').value) || 0;
            const price = parseFloat(document.getElementById('modalProductPrice').value) || 0;
            
            const profit = price - cost;
            const margin = price > 0 ? (profit / price) * 100 : 0;
            
            document.getElementById('profitPerUnitCalc').textContent = `R$ ${profit.toFixed(2)}`;
            document.getElementById('profitMarginCalc').textContent = `${margin.toFixed(1)}%`;
        }

        // Salvar produto para meta
        function saveGoalProduct() {
            const name = document.getElementById('modalProductName').value.trim();
            const cost = parseFloat(document.getElementById('modalProductCost').value);
            const price = parseFloat(document.getElementById('modalProductPrice').value);
            const saveButton = document.querySelector('#productModal .modal-actions .success');
            const editId = saveButton.dataset.editId;
            
            // Validações
            if (!name) {
                showNotification("Digite o nome do produto", "danger");
                return;
            }
            
            if (!cost || cost <= 0) {
                showNotification("Digite um custo válido", "danger");
                return;
            }
            
            if (!price || price <= 0) {
                showNotification("Digite um preço de venda válido", "danger");
                return;
            }
            
            if (price <= cost) {
                showNotification("O preço de venda deve ser maior que o custo", "danger");
                return;
            }
            
            const profit = price - cost;
            const margin = (profit / price) * 100;
            
            if (editId) {
                // Editar produto existente
                const productIndex = goalState.goalProducts.findIndex(p => p.id === parseInt(editId));
                if (productIndex !== -1) {
                    goalState.goalProducts[productIndex] = {
                        id: parseInt(editId),
                        name,
                        cost,
                        price,
                        profitPerUnit: profit,
                        margin,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // Adicionar novo produto
                const newProduct = {
                    id: Date.now(),
                    name,
                    cost,
                    price,
                    profitPerUnit: profit,
                    margin,
                    createdAt: new Date().toISOString()
                };
                goalState.goalProducts.push(newProduct);
            }
            
            saveGoalData();
            updateGoalProductsDisplay();
            updateGoalDisplay();
            
            hideProductModal();
            showNotification(`Produto "${name}" salvo com sucesso!`, "success");
        }

        // Editar produto para meta
        function editGoalProduct(productId) {
            showProductModal(productId);
        }

        // Excluir produto para meta
        function deleteGoalProduct(productId) {
            if (confirm("Tem certeza que deseja excluir este produto? Isso afetará o cálculo de lucro.")) {
                goalState.goalProducts = goalState.goalProducts.filter(p => p.id !== productId);
                saveGoalData();
                updateGoalProductsDisplay();
                updateGoalDisplay();
                showNotification("Produto excluído com sucesso!", "success");
            }
        }

        // ============ CONFIGURAÇÕES INICIAIS DO APP ============
        const APP_NAME = "PraiaVendas";
        const DATA_KEYS = {
            USERS: 'praiaVendas_users',
            BUSINESS_INFO: 'praiaVendas_businessInfo',
            PRODUCTS: 'praiaVendas_products',
            SALES: 'praiaVendas_sales',
            PAYMENT_METHODS: 'praiaVendas_paymentMethods',
            COSTS: 'praiaVendas_costs',
            CMV: 'praiaVendas_cmv',
            SETTINGS: 'praiaVendas_settings',
            COOKIE_CONSENT: 'praiaVendas_cookieConsent',
            SESSION: 'praiaVendas_session'
        };

        // Estado da aplicação
        let appState = {
            currentUser: null,
            businessInfo: {
                name: "PraiaVendas",
                slogan: "Vendas na Praia",
                logo: "",
                themeColor: '#FF9800',
                changeFund: 0.00
            },
            products: [],
            sales: [],
            paymentMethods: [
                { id: 1, name: "Pix", type: "pix", fee: 0.00, total: 0 },
                { id: 2, name: "Dinheiro", type: "cash", fee: 0.00, total: 0 },
                { id: 3, name: "Cartão Crédito", type: "credit", fee: 3.99, total: 0 },
                { id: 4, name: "Cartão Débito", type: "debit", fee: 2.39, total: 0 }
            ],
            costs: [],
            cmv: {
                initialStock: 0,
                purchases: 0,
                finalStock: 0,
                calculatedCMV: 0
            },
            settings: {
                darkMode: false,
                saleSounds: true,
                stockNotifications: true,
                animations: true,
                currentFilter: 'today',
                machineFeePercentage: 3.99,
                goalNotifications: true
            },
            users: [],
            currentSection: 'dashboard'
        };

        // Variáveis para controle do pagamento misto
        let mixedPaymentMethods = [];
        let nextPaymentId = 1;

        // Elementos DOM
        const dom = {
            // Login
            loginScreen: document.getElementById('loginScreen'),
            mainApp: document.getElementById('mainApp'),
            businessLogo: document.getElementById('businessLogo'),
            businessNameLogin: document.getElementById('businessNameLogin'),
            usernameInput: document.getElementById('usernameInput'),
            passwordInput: document.getElementById('passwordInput'),
            loginBtn: document.getElementById('loginBtn'),
            loginError: document.getElementById('loginError'),
            
            // Header
            businessAvatar: document.getElementById('businessAvatar'),
            businessNameHeader: document.getElementById('businessNameHeader'),
            businessSlogan: document.getElementById('businessSlogan'),
            notificationToggle: document.getElementById('notificationToggle'),
            themeToggle: document.getElementById('themeToggle'),
            logoutBtn: document.getElementById('logoutBtn'),
            tabs: document.querySelectorAll('.tab'),
            
            // Seções
            sections: document.querySelectorAll('.section'),
            
            // Dashboard
            totalSalesValue: document.getElementById('totalSalesValue'),
            totalProductsSold: document.getElementById('totalProductsSold'),
            grossRevenue: document.getElementById('grossRevenue'),
            netRevenue: document.getElementById('netRevenue'),
            cmvValue: document.getElementById('cmvValue'),
            machineFee: document.getElementById('machineFee'),
            changeFund: document.getElementById('changeFund'),
            changeFundInput: document.getElementById('changeFundInput'),
            salaryValue: document.getElementById('salaryValue'),
            filterButtons: document.querySelectorAll('.filter-btn'),
            salesChart: document.getElementById('salesChart'),
            
            // Vendas (com pagamento misto)
            productSelect: document.getElementById('productSelect'),
            quantityInput: document.getElementById('quantityInput'),
            priceInput: document.getElementById('priceInput'),
            saleTotal: document.getElementById('saleTotal'),
            registerSaleBtn: document.getElementById('registerSaleBtn'),
            recentSalesList: document.getElementById('recentSalesList'),
            
            // Pagamento Misto
            addMixedPaymentBtn: document.getElementById('addMixedPaymentBtn'),
            mixedPaymentContainer: document.getElementById('mixedPaymentContainer'),
            totalPaid: document.getElementById('totalPaid'),
            remainingValue: document.getElementById('remainingValue'),
            remainingAmount: document.getElementById('remainingAmount'),
            
            // Formas de Pagamento (gerenciamento)
            paymentMethodName: document.getElementById('paymentMethodName'),
            paymentMethodType: document.getElementById('paymentMethodType'),
            paymentMethodFee: document.getElementById('paymentMethodFee'),
            savePaymentMethodBtn: document.getElementById('savePaymentMethodBtn'),
            paymentMethodsList: document.getElementById('paymentMethodsList'),
            paymentMethodsTable: document.getElementById('paymentMethodsTable'),
            
            // Custos
            costDescription: document.getElementById('costDescription'),
            costCategory: document.getElementById('costCategory'),
            costValue: document.getElementById('costValue'),
            costDate: document.getElementById('costDate'),
            addCostBtn: document.getElementById('addCostBtn'),
            costsList: document.getElementById('costsList'),
            costsTable: document.getElementById('costsTable'),
            initialStock: document.getElementById('initialStock'),
            purchases: document.getElementById('purchases'),
            finalStock: document.getElementById('finalStock'),
            calculateCMVBtn: document.getElementById('calculateCMVBtn'),
            cmvResult: document.getElementById('cmvResult'),
            cmvResultValue: document.getElementById('cmvResultValue'),
            
            // Produtos
            productName: document.getElementById('productName'),
            productCategory: document.getElementById('productCategory'),
            productPrice: document.getElementById('productPrice'),
            productCost: document.getElementById('productCost'),
            productStock: document.getElementById('productStock'),
            addProductBtn: document.getElementById('addProductBtn'),
            productsList: document.getElementById('productsList'),
            
            // Financeiro
            totalRevenue: document.getElementById('totalRevenue'),
            profitValue: document.getElementById('profitValue'),
            marginValue: document.getElementById('marginValue'),
            financeChart: document.getElementById('financeChart'),
            exportSalesBtn: document.getElementById('exportSalesBtn'),
            exportProductsBtn: document.getElementById('exportProductsBtn'),
            exportFinanceBtn: document.getElementById('exportFinanceBtn'),
            targetRevenue: document.getElementById('targetRevenue'),
            targetPeriod: document.getElementById('targetPeriod'),
            calculateProjectionBtn: document.getElementById('calculateProjectionBtn'),
            projectionResult: document.getElementById('projectionResult'),
            
            // Configurações
            businessNameInput: document.getElementById('businessNameInput'),
            businessSloganInput: document.getElementById('businessSloganInput'),
            businessPhotoPreview: document.getElementById('businessPhotoPreview'),
            businessPhotoInput: document.getElementById('businessPhotoInput'),
            photoUpload: document.getElementById('photoUpload'),
            saveBusinessInfoBtn: document.getElementById('saveBusinessInfoBtn'),
            colorOptions: document.querySelectorAll('.color-option'),
            saleSoundsToggle: document.getElementById('saleSoundsToggle'),
            stockNotificationsToggle: document.getElementById('stockNotificationsToggle'),
            animationsToggle: document.getElementById('animationsToggle'),
            goalNotificationsToggle: document.getElementById('goalNotificationsToggle'),
            backupDataBtn: document.getElementById('backupDataBtn'),
            restoreDataBtn: document.getElementById('restoreDataBtn'),
            resetDataBtn: document.getElementById('resetDataBtn'),
            
            // Notificações
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText'),
            
            // Animação
            saleAnimation: document.getElementById('saleAnimation'),
            
            // Modal
            cookieModal: document.getElementById('cookieModal'),
            acceptCookies: document.getElementById('acceptCookies')
        };

        // ============ FUNÇÕES PARA PAGAMENTO MISTO ============

        // Gerar opções HTML para seleção de métodos de pagamento
        function generatePaymentMethodOptions() {
            let options = '';
            appState.paymentMethods.forEach(method => {
                options += `<option value="${method.id}">${method.name} ${method.fee > 0 ? `(${method.fee}%)` : ''}</option>`;
            });
            return options;
        }

        // Adicionar um método de pagamento à lista de pagamento misto
        function addMixedPaymentMethod() {
            if (appState.paymentMethods.length === 0) {
                showNotification("Adicione formas de pagamento primeiro na seção 'Pagamentos'", "warning");
                return;
            }

            const paymentId = nextPaymentId++;
            // Usa o primeiro método como padrão, mas permite mudar
            const defaultMethod = appState.paymentMethods[0];
            
            mixedPaymentMethods.push({
                id: paymentId,
                methodId: defaultMethod.id,
                methodName: defaultMethod.name,
                methodType: defaultMethod.type,
                methodFee: defaultMethod.fee,
                amount: 0
            });

            updateMixedPaymentDisplay();
        }

        // Remover um método de pagamento da lista
        function removeMixedPaymentMethod(id) {
            mixedPaymentMethods = mixedPaymentMethods.filter(item => item.id !== id);
            updateMixedPaymentDisplay();
        }

        // Atualizar o método de pagamento selecionado
        function updateMixedPaymentMethod(id, methodId) {
            const item = mixedPaymentMethods.find(item => item.id === id);
            if (item) {
                const method = appState.paymentMethods.find(m => m.id === parseInt(methodId));
                if (method) {
                    item.methodId = method.id;
                    item.methodName = method.name;
                    item.methodType = method.type;
                    item.methodFee = method.fee;
                    updatePaymentSummary();
                }
            }
        }

        // Atualizar o valor de um método de pagamento
        function updateMixedPaymentAmount(id, amount) {
            const item = mixedPaymentMethods.find(item => item.id === id);
            if (item) {
                item.amount = parseFloat(amount) || 0;
                updatePaymentSummary();
            }
        }

        // Atualizar a exibição dos métodos de pagamento misto
        function updateMixedPaymentDisplay() {
            const container = dom.mixedPaymentContainer;
            container.innerHTML = '';

            if (mixedPaymentMethods.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-money-bill-wave"></i>
                        <p>Adicione formas de pagamento para dividir o valor total</p>
                    </div>
                `;
                return;
            }

            mixedPaymentMethods.forEach(item => {
                const methodDiv = document.createElement('div');
                methodDiv.className = 'mixed-payment-item';
                methodDiv.innerHTML = `
                    <div class="mixed-payment-header">
                        <div>
                            <select class="mixed-payment-select" 
                                    onchange="updateMixedPaymentMethod(${item.id}, this.value)"
                                    data-id="${item.id}">
                                ${generatePaymentMethodOptions()}
                            </select>
                        </div>
                        <button onclick="removeMixedPaymentMethod(${item.id})" class="remove-payment-btn">
                            <i class="fas fa-times"></i> Remover
                        </button>
                    </div>
                    <div class="mixed-payment-amount">
                        <input type="number" 
                               min="0" 
                               step="0.01" 
                               value="${item.amount.toFixed(2)}" 
                               placeholder="0.00"
                               onchange="updateMixedPaymentAmount(${item.id}, this.value)"
                               oninput="updateMixedPaymentAmount(${item.id}, this.value)">
                        <span>R$</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                        Taxa: R$ ${((item.amount * item.methodFee) / 100).toFixed(2)}
                    </div>
                `;
                
                // Selecionar o método correto no dropdown
                const select = methodDiv.querySelector('.mixed-payment-select');
                select.value = item.methodId;
                
                container.appendChild(methodDiv);
            });

            updatePaymentSummary();
        }

        // Atualizar o resumo do pagamento
        function updatePaymentSummary() {
            const totalSaleValue = parseFloat(dom.saleTotal.value) || 0;
            let totalPaidValue = 0;

            mixedPaymentMethods.forEach(item => {
                totalPaidValue += item.amount;
            });

            const remaining = totalSaleValue - totalPaidValue;
            
            // Atualizar valores na tela
            dom.totalPaid.textContent = totalPaidValue.toFixed(2);
            dom.remainingValue.textContent = Math.abs(remaining).toFixed(2);
            
            // Atualizar estilo baseado no restante
            const remainingElement = dom.remainingAmount;
            remainingElement.className = 'remaining-amount ';
            
            if (remaining > 0) {
                remainingElement.classList.add('remaining-positive');
                remainingElement.innerHTML = `Restante a pagar: R$ <span id="remainingValue">${remaining.toFixed(2)}</span>`;
            } else if (remaining < 0) {
                remainingElement.classList.add('remaining-negative');
                remainingElement.innerHTML = `Troco necessário: R$ <span id="remainingValue">${Math.abs(remaining).toFixed(2)}</span>`;
            } else {
                remainingElement.classList.add('remaining-zero');
                remainingElement.innerHTML = `Valor quitado! <span id="remainingValue">${remaining.toFixed(2)}</span>`;
            }
        }

        // Calcular o total da venda
        function calculateSaleTotal() {
            const productId = parseInt(dom.productSelect.value);
            const quantity = parseInt(dom.quantityInput.value) || 1;

            if (!productId) {
                dom.saleTotal.value = '0.00';
                return;
            }

            const product = appState.products.find(p => p.id === productId);
            if (product) {
                const total = product.price * quantity;
                dom.priceInput.value = product.price.toFixed(2);
                dom.saleTotal.value = total.toFixed(2);
                updatePaymentSummary();
            }
        }

        // ============ FUNÇÕES PRINCIPAIS DO APP ============

        // Inicialização
        async function initApp() {
            // Carregar dados
            loadAppData();
            loadGoalData();
            
            // Verificar consentimento de cookies
            checkCookieConsent();
            
            // Configurar eventos
            setupEventListeners();
            
            // Atualizar interface
            updateBusinessInfo();
            loadProducts();
            loadPaymentMethods();
            loadCosts();
            updateDashboard();
            updateGoalDisplay();
            setupCharts();
            
            // Verificar se há sessão ativa
            checkSession();
            
            // Configurar eventos para cálculo automático de lucro
            setupGoalCalculationEvents();
        }

        // Configurar eventos para cálculo automático de lucro
        function setupGoalCalculationEvents() {
            // Atualizar cálculo de lucro no modal de produto
            const costInput = document.getElementById('modalProductCost');
            const priceInput = document.getElementById('modalProductPrice');
            
            if (costInput) {
                costInput.addEventListener('input', updateProfitCalculation);
                priceInput.addEventListener('input', updateProfitCalculation);
            }
        }

        // Gerenciamento de cookies
        function checkCookieConsent() {
            const consent = localStorage.getItem(DATA_KEYS.COOKIE_CONSENT);
            if (!consent) {
                setTimeout(() => {
                    dom.cookieModal.classList.add('show');
                }, 1000);
            }
        }

        // Carregar dados
        function loadAppData() {
            const savedBusinessInfo = localStorage.getItem(DATA_KEYS.BUSINESS_INFO);
            if (savedBusinessInfo) appState.businessInfo = JSON.parse(savedBusinessInfo);
            
            const savedProducts = localStorage.getItem(DATA_KEYS.PRODUCTS);
            if (savedProducts) appState.products = JSON.parse(savedProducts);
            
            const savedSales = localStorage.getItem(DATA_KEYS.SALES);
            if (savedSales) appState.sales = JSON.parse(savedSales);
            
            const savedPaymentMethods = localStorage.getItem(DATA_KEYS.PAYMENT_METHODS);
            if (savedPaymentMethods) appState.paymentMethods = JSON.parse(savedPaymentMethods);
            
            const savedCosts = localStorage.getItem(DATA_KEYS.COSTS);
            if (savedCosts) appState.costs = JSON.parse(savedCosts);
            
            const savedCMV = localStorage.getItem(DATA_KEYS.CMV);
            if (savedCMV) appState.cmv = JSON.parse(savedCMV);
            
            const savedSettings = localStorage.getItem(DATA_KEYS.SETTINGS);
            if (savedSettings) appState.settings = JSON.parse(savedSettings);
            
            // Carregar usuários padrão
            appState.users = [
                {
                    id: 1,
                    username: "admin",
                    password: "admin123",
                    nome: "Administrador",
                    role: "admin",
                    ativo: true,
                    bloqueado: false,
                    data_criacao: "2024-01-01",
                    ultimo_acesso: null,
                    mensagem_acesso: "Bem-vindo ao sistema de gestão!"
                },
                {
                    id: 2,
                    username: "guilhermmkt",
                    password: "guilhermmkt123",
                    nome: "Gui Castilho",
                    role: "vendedor",
                    ativo: true,
                    bloqueado: false,
                    data_criacao: "2025-12-03",
                    ultimo_acesso: null,
                    mensagem_acesso: "Acesso liberado para vendas"
                },
                {
                    id: 3,
                    username: "sidney",
                    password: "sidney12345",
                    nome: "Sidney",
                    role: "vendedor",
                    ativo: true,
                    bloqueado: false,
                    data_criacao: "2025-12-03",
                    ultimo_acesso: null,
                    mensagem_acesso: "Acesso liberado para vendas"
                },
                {
                    id: 4,
                    username: "teste",
                    password: "teste123456789",
                    nome: "Usuário Teste",
                    role: "vendedor",
                    ativo: true,
                    bloqueado: true,
                    data_criacao: "2024-02-10",
                    ultimo_acesso: null,
                    mensagem_acesso: "SEU ACESSO FOI BLOQUEADO! Entre em contato com o administrador."
                }
            ];
            
            updateLastAccess();
        }

        // Salvar dados
        function saveAppData() {
            localStorage.setItem(DATA_KEYS.BUSINESS_INFO, JSON.stringify(appState.businessInfo));
            localStorage.setItem(DATA_KEYS.PRODUCTS, JSON.stringify(appState.products));
            localStorage.setItem(DATA_KEYS.SALES, JSON.stringify(appState.sales));
            localStorage.setItem(DATA_KEYS.PAYMENT_METHODS, JSON.stringify(appState.paymentMethods));
            localStorage.setItem(DATA_KEYS.COSTS, JSON.stringify(appState.costs));
            localStorage.setItem(DATA_KEYS.CMV, JSON.stringify(appState.cmv));
            localStorage.setItem(DATA_KEYS.SETTINGS, JSON.stringify(appState.settings));
        }

        // Atualizar último acesso
        function updateLastAccess() {
            if (appState.currentUser) {
                const userIndex = appState.users.findIndex(u => u.id === appState.currentUser.id);
                if (userIndex !== -1) {
                    appState.users[userIndex].ultimo_acesso = new Date().toISOString();
                    localStorage.setItem(DATA_KEYS.USERS, JSON.stringify(appState.users));
                }
            }
        }

        // Atualizar informações do negócio na interface
        function updateBusinessInfo() {
            document.documentElement.style.setProperty('--primary', appState.businessInfo.themeColor);
            
            if (appState.businessInfo.logo) {
                dom.businessLogo.src = appState.businessInfo.logo;
                dom.businessAvatar.src = appState.businessInfo.logo;
                dom.businessPhotoPreview.src = appState.businessInfo.logo;
            } else {
                const defaultIcon = "https://cdn-icons-png.flaticon.com/512/2173/2173475.png";
                dom.businessLogo.src = defaultIcon;
                dom.businessAvatar.src = defaultIcon;
                dom.businessPhotoPreview.src = defaultIcon;
            }
            
            dom.businessNameLogin.textContent = appState.businessInfo.name;
            dom.businessNameHeader.textContent = appState.businessInfo.name;
            dom.businessSlogan.textContent = appState.businessInfo.slogan;
            dom.businessNameInput.value = appState.businessInfo.name;
            dom.businessSloganInput.value = appState.businessInfo.slogan;
            
            dom.changeFund.textContent = `R$ ${appState.businessInfo.changeFund.toFixed(2)}`;
            dom.changeFundInput.value = appState.businessInfo.changeFund;
            
            dom.colorOptions.forEach(option => {
                option.classList.toggle('selected', option.dataset.color === appState.businessInfo.themeColor);
            });
            
            updateTheme();
        }

        // Atualizar fundo de troco
        function updateChangeFund() {
            const newValue = parseFloat(dom.changeFundInput.value) || 0;
            appState.businessInfo.changeFund = newValue;
            saveAppData();
            updateBusinessInfo();
            showNotification(`Fundo de troco atualizado para R$ ${newValue.toFixed(2)}`, "success");
        }

        // Tema escuro/claro
        function toggleTheme() {
            appState.settings.darkMode = !appState.settings.darkMode;
            saveAppData();
            updateTheme();
            showNotification(appState.settings.darkMode ? "Modo escuro ativado" : "Modo claro ativado", "info");
        }

        function updateTheme() {
            if (appState.settings.darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                dom.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.documentElement.removeAttribute('data-theme');
                dom.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Login/Logout
        function login(username, password) {
            const user = appState.users.find(u => 
                u.username === username && u.password === password
            );
            
            if (user) {
                if (!user.ativo) {
                    showNotification("Usuário inativo", "danger");
                    return false;
                }

                if (user.bloqueado) {
                    showNotification(user.mensagem_acesso || "Usuário bloqueado", "danger");
                    return false;
                }

                appState.currentUser = user;
                
                updateLastAccess();
                
                const session = {
                    username: user.username,
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
                };
                localStorage.setItem(DATA_KEYS.SESSION, JSON.stringify(session));
                
                showMainApp();
                showNotification(user.mensagem_acesso || `Bem-vindo, ${user.nome}!`, "success");
                return true;
            }
            
            return false;
        }

        function logout() {
            appState.currentUser = null;
            localStorage.removeItem(DATA_KEYS.SESSION);
            showLogin();
            showNotification("Você saiu do sistema", "info");
        }

        function showLogin() {
            dom.loginScreen.style.display = 'flex';
            dom.mainApp.style.display = 'none';
            dom.usernameInput.value = '';
            dom.passwordInput.value = '';
            dom.loginError.style.display = 'none';
        }

        function showMainApp() {
            dom.loginScreen.style.display = 'none';
            dom.mainApp.style.display = 'block';
        }

        // Verificar sessão
        function checkSession() {
            const session = localStorage.getItem(DATA_KEYS.SESSION);
            if (session) {
                const sessionData = JSON.parse(session);
                if (sessionData.expires > Date.now()) {
                    appState.currentUser = appState.users.find(u => u.username === sessionData.username);
                    if (appState.currentUser) {
                        showMainApp();
                    } else {
                        showLogin();
                    }
                } else {
                    localStorage.removeItem(DATA_KEYS.SESSION);
                    showLogin();
                }
            } else {
                showLogin();
            }
        }

        // Produtos
        function loadProducts() {
            dom.productSelect.innerHTML = '<option value="">Selecione um produto</option>';
            
            appState.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - R$ ${product.price.toFixed(2)}`;
                option.dataset.price = product.price;
                option.dataset.cost = product.cost || 0;
                dom.productSelect.appendChild(option);
            });
            
            updateProductsGrid();
        }

        function addProduct(name, category, price, cost, stock) {
            const newProduct = {
                id: Date.now(),
                name: name,
                category: category,
                price: parseFloat(price),
                cost: parseFloat(cost) || 0,
                stock: parseInt(stock),
                minStock: 5,
                createdAt: new Date().toISOString()
            };
            
            appState.products.push(newProduct);
            saveAppData();
            loadProducts();
            showNotification(`Produto "${name}" adicionado com sucesso!`, "success");
            
            // Sincronizar com produtos de meta se necessário
            syncWithGoalProducts(name, cost, price);
        }

        // Sincronizar produto com sistema de metas
        function syncWithGoalProducts(name, cost, price) {
            // Verificar se já existe nos produtos de meta
            const existingGoalProduct = goalState.goalProducts.find(p => p.name === name);
            
            if (!existingGoalProduct && cost > 0 && price > 0) {
                // Perguntar se quer adicionar ao sistema de metas
                if (confirm(`Deseja adicionar "${name}" ao cálculo de lucro das metas?`)) {
                    const profit = price - cost;
                    const margin = (profit / price) * 100;
                    
                    goalState.goalProducts.push({
                        id: Date.now(),
                        name,
                        cost,
                        price,
                        profitPerUnit: profit,
                        margin,
                        createdAt: new Date().toISOString()
                    });
                    
                    saveGoalData();
                    updateGoalProductsDisplay();
                    updateGoalDisplay();
                    
                    showNotification(`Produto "${name}" adicionado ao cálculo de lucro!`, "success");
                }
            }
        }

        function updateProductStock(productId, quantity) {
            const product = appState.products.find(p => p.id === productId);
            if (product) {
                product.stock -= quantity;
                
                if (product.stock <= product.minStock && appState.settings.stockNotifications) {
                    showNotification(`Estoque baixo: ${product.name}`, "warning");
                }
                
                saveAppData();
                loadProducts();
            }
        }

        function updateProductsGrid() {
            dom.productsList.innerHTML = '';
            
            if (appState.products.length === 0) {
                dom.productsList.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                        <i class="fas fa-box-open fa-3x" style="color: var(--gray); margin-bottom: 1rem;"></i>
                        <h3>Nenhum produto cadastrado</h3>
                        <p>Adicione seus produtos para começar a vender</p>
                    </div>
                `;
                return;
            }
            
            appState.products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-image">
                        <i class="fas fa-${getProductIcon(product.category)}"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                        <div class="product-stock ${product.stock <= product.minStock ? 'stock-low' : ''}">
                            Estoque: ${product.stock} ${product.stock <= product.minStock ? '⚠️ Baixo' : ''}
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 0.5rem;">
                            Custo: R$ ${product.cost ? product.cost.toFixed(2) : '0.00'}
                        </div>
                        <button onclick="editProduct(${product.id})" style="margin-top: 0.5rem; padding: 8px 12px; font-size: 0.9rem;">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                `;
                dom.productsList.appendChild(card);
            });
        }

        function getProductIcon(category) {
            const icons = {
                'bebidas': 'wine-bottle',
                'comidas': 'hamburger',
                'sobremesas': 'ice-cream',
                'acessorios': 'umbrella-beach',
                'outros': 'box'
            };
            return icons[category] || 'box';
        }

        // Registrar venda com pagamento misto
        function registerMixedPaymentSale() {
            const productId = parseInt(dom.productSelect.value);
            const quantity = parseInt(dom.quantityInput.value) || 1;
            const totalSale = parseFloat(dom.saleTotal.value) || 0;

            // Validações
            if (!productId) {
                showNotification("Selecione um produto", "danger");
                return false;
            }

            if (quantity <= 0) {
                showNotification("Quantidade inválida", "danger");
                return false;
            }

            if (totalSale <= 0) {
                showNotification("Valor da venda inválido", "danger");
                return false;
            }

            if (mixedPaymentMethods.length === 0) {
                showNotification("Adicione pelo menos uma forma de pagamento", "danger");
                return false;
            }

            const product = appState.products.find(p => p.id === productId);
            if (!product) return false;

            if (product.stock < quantity) {
                showNotification(`Estoque insuficiente de ${product.name}`, "danger");
                return false;
            }

            // Calcular total pago
            let totalPaid = 0;
            mixedPaymentMethods.forEach(item => {
                totalPaid += item.amount;
            });

            const remaining = totalSale - totalPaid;
            if (remaining > 0) {
                showNotification(`Falta R$ ${remaining.toFixed(2)} para completar o pagamento`, "warning");
                return false;
            }

            // Registrar uma venda principal
            const mainSale = {
                id: Date.now(),
                productId: productId,
                productName: product.name,
                quantity: quantity,
                price: product.price,
                total: totalSale,
                paymentMethod: "Pagamento Misto",
                paymentMethodId: null,
                machineFee: 0, // Será calculado abaixo
                date: new Date().toISOString(),
                isMixedPayment: true,
                mixedPaymentDetails: []
            };

            // Calcular taxas e adicionar detalhes
            let totalMachineFee = 0;
            mixedPaymentMethods.forEach(item => {
                if (item.amount > 0) {
                    const paymentMethod = appState.paymentMethods.find(p => p.id === item.methodId);
                    if (paymentMethod) {
                        const machineFee = paymentMethod.fee > 0 ? (item.amount * paymentMethod.fee / 100) : 0;
                        totalMachineFee += machineFee;
                        
                        // Adicionar ao detalhe da venda mista
                        mainSale.mixedPaymentDetails.push({
                            methodId: paymentMethod.id,
                            methodName: paymentMethod.name,
                            amount: item.amount,
                            fee: machineFee
                        });
                        
                        // Atualizar total da forma de pagamento
                        paymentMethod.total += item.amount;
                    }
                }
            });

            // Atualizar taxa da maquininha na venda principal
            mainSale.machineFee = totalMachineFee;
            
            // Adicionar venda ao histórico
            appState.sales.push(mainSale);

            // Atualizar estoque
            updateProductStock(productId, quantity);
            
            saveAppData();
            
            // Efeitos visuais e sonoros
            if (appState.settings.animations) {
                playSaleAnimation();
            }
            
            if (appState.settings.saleSounds) {
                playSaleSound();
            }
            
            // Atualizar dashboard e metas
            updateDashboard();
            updateGoalDisplay();
            
            // Resetar formulário
            resetSaleForm();
            
            // Mostrar resumo da venda
            let summary = `Venda registrada: ${product.name} x${quantity}<br>`;
            summary += `Total: R$ ${totalSale.toFixed(2)}<br>`;
            summary += `Formas de pagamento:<br>`;
            mixedPaymentMethods.forEach(item => {
                if (item.amount > 0) {
                    summary += `- ${item.methodName}: R$ ${item.amount.toFixed(2)}<br>`;
                }
            });
            
            showNotification(summary, "success");
            return true;
        }

        // Resetar formulário de venda
        function resetSaleForm() {
            dom.productSelect.value = '';
            dom.quantityInput.value = '1';
            dom.priceInput.value = '';
            dom.saleTotal.value = '0.00';
            mixedPaymentMethods = [];
            updateMixedPaymentDisplay();
        }

        // Formas de Pagamento
        function loadPaymentMethods() {
            // Limpar tabela
            dom.paymentMethodsList.innerHTML = '';
            
            // Adicionar formas de pagamento
            appState.paymentMethods.forEach(method => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${method.name}</td>
                    <td>${getPaymentTypeName(method.type)}</td>
                    <td>${method.fee}%</td>
                    <td class="actions-cell">
                        <button onclick="deletePaymentMethod(${method.id})" class="btn-small danger">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                dom.paymentMethodsList.appendChild(row);
            });
        }

        function getPaymentTypeName(type) {
            const types = {
                'pix': 'Pix',
                'cash': 'Dinheiro',
                'credit': 'Cartão Crédito',
                'debit': 'Cartão Débito',
                'other': 'Outro'
            };
            return types[type] || type;
        }

        function addPaymentMethod(name, type, fee) {
            const newMethod = {
                id: Date.now(),
                name: name,
                type: type,
                fee: parseFloat(fee) || 0,
                total: 0
            };
            
            appState.paymentMethods.push(newMethod);
            saveAppData();
            loadPaymentMethods();
            // Atualizar display do pagamento misto se estiver na seção de vendas
            if (appState.currentSection === 'sales') {
                updateMixedPaymentDisplay();
            }
            showNotification(`Forma de pagamento "${name}" adicionada com sucesso!`, "success");
        }

        // Função global para exclusão de forma de pagamento
        window.deletePaymentMethod = function(id) {
            if (appState.paymentMethods.length <= 2) {
                showNotification("Você precisa ter pelo menos 2 formas de pagamento", "warning");
                return;
            }
            
            if (confirm("Tem certeza que deseja excluir esta forma de pagamento?")) {
                appState.paymentMethods = appState.paymentMethods.filter(m => m.id !== id);
                saveAppData();
                loadPaymentMethods();
                // Atualizar display do pagamento misto se estiver na seção de vendas
                if (appState.currentSection === 'sales') {
                    updateMixedPaymentDisplay();
                }
                showNotification("Forma de pagamento excluída com sucesso!", "success");
            }
        };

        // Custos
        function loadCosts() {
            dom.costsList.innerHTML = '';
            
            appState.costs.forEach(cost => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(cost.date).toLocaleDateString('pt-BR')}</td>
                    <td>${cost.description}</td>
                    <td>${getCostCategoryName(cost.category)}</td>
                    <td>R$ ${cost.value.toFixed(2)}</td>
                    <td class="actions-cell">
                        <button onclick="deleteCost(${cost.id})" class="btn-small danger">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                dom.costsList.appendChild(row);
            });
        }

        function getCostCategoryName(category) {
            const categories = {
                'transport': 'Transporte',
                'food': 'Alimentação',
                'machine_fee': 'Taxa Maquininha',
                'donation': 'Doação',
                'barter': 'Escambo',
                'gift': 'Brinde',
                'water': 'Água',
                'electricity': 'Luz',
                'gas': 'Gás',
                'salary': 'Salário (Pró-labore)',
                'employee': 'Funcionário',
                'other': 'Outros'
            };
            return categories[category] || category;
        }

        function addCost(description, category, value, date) {
            const newCost = {
                id: Date.now(),
                description: description,
                category: category,
                value: parseFloat(value) || 0,
                date: date || new Date().toISOString().split('T')[0]
            };
            
            appState.costs.push(newCost);
            saveAppData();
            loadCosts();
            updateDashboard();
            updateGoalDisplay();
            showNotification(`Custo "${description}" adicionado com sucesso!`, "success");
        }

        // Função global para exclusão de custos
        window.deleteCost = function(id) {
            if (confirm("Tem certeza que deseja excluir este custo?")) {
                appState.costs = appState.costs.filter(c => c.id !== id);
                saveAppData();
                loadCosts();
                updateDashboard();
                updateGoalDisplay();
                showNotification("Custo excluído com sucesso!", "success");
            }
        };

        // Calcular CMV
        function calculateCMV() {
            const initialStock = parseFloat(dom.initialStock.value) || 0;
            const purchases = parseFloat(dom.purchases.value) || 0;
            const finalStock = parseFloat(dom.finalStock.value) || 0;
            
            const cmv = initialStock + purchases - finalStock;
            
            appState.cmv = {
                initialStock: initialStock,
                purchases: purchases,
                finalStock: finalStock,
                calculatedCMV: cmv
            };
            saveAppData();
            
            dom.cmvResultValue.textContent = cmv.toFixed(2);
            dom.cmvResult.style.display = 'block';
            
            updateDashboard();
            updateGoalDisplay();
            
            showNotification(`CMV calculado: R$ ${cmv.toFixed(2)}`, "success");
        }

        // Dashboard
        function updateDashboard() {
            const filter = appState.settings.currentFilter;
            let filteredSales = appState.sales;
            
            if (filter !== 'all') {
                const now = new Date();
                filteredSales = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    
                    switch(filter) {
                        case 'today':
                            return saleDate.toDateString() === now.toDateString();
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return saleDate >= weekAgo;
                        case 'month':
                            return saleDate.getMonth() === now.getMonth() && 
                                   saleDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            const totalSales = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalProducts = filteredSales.reduce((sum, sale) => sum + sale.quantity, 0);
            const cmv = appState.cmv.calculatedCMV || 0;
            const machineFees = filteredSales.reduce((sum, sale) => sum + sale.machineFee, 0);
            const otherCosts = appState.costs.reduce((sum, cost) => {
                if (cost.category !== 'salary') return sum + cost.value;
                return sum;
            }, 0);
            const salary = appState.costs.reduce((sum, cost) => {
                if (cost.category === 'salary') return sum + cost.value;
                return sum;
            }, 0);
            const grossRevenue = totalSales;
            const netRevenue = grossRevenue - cmv - machineFees - otherCosts - salary;
            const margin = grossRevenue > 0 ? ((netRevenue / grossRevenue) * 100) : 0;
            
            dom.totalSalesValue.textContent = `R$ ${totalSales.toFixed(2)}`;
            dom.totalProductsSold.textContent = totalProducts.toString();
            dom.grossRevenue.textContent = `R$ ${grossRevenue.toFixed(2)}`;
            dom.netRevenue.textContent = `R$ ${netRevenue.toFixed(2)}`;
            dom.cmvValue.textContent = `R$ ${cmv.toFixed(2)}`;
            dom.machineFee.textContent = `R$ ${machineFees.toFixed(2)}`;
            dom.salaryValue.textContent = `R$ ${salary.toFixed(2)}`;
            
            dom.totalRevenue.textContent = `R$ ${grossRevenue.toFixed(2)}`;
            dom.profitValue.textContent = `R$ ${netRevenue.toFixed(2)}`;
            dom.marginValue.textContent = `${margin.toFixed(1)}%`;
            
            updateSalesChart(filteredSales);
            updateFinanceChart();
        }

        // Gráficos
        function setupCharts() {
            window.salesChart = new Chart(dom.salesChart, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: [],
                        borderColor: appState.businessInfo.themeColor,
                        backgroundColor: `${appState.businessInfo.themeColor}20`,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            window.financeChart = new Chart(dom.financeChart, {
                type: 'doughnut',
                data: {
                    labels: ['Faturamento Bruto', 'CMV', 'Taxas', 'Custos', 'Salário', 'Lucro Líquido'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#4CAF50',
                            '#FF9800',
                            '#2196F3',
                            '#F44336',
                            '#9C27B0',
                            '#00BCD4'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateSalesChart(filteredSales) {
            const salesByDay = {};
            filteredSales.forEach(sale => {
                const date = new Date(sale.date).toLocaleDateString('pt-BR', { weekday: 'short' });
                if (!salesByDay[date]) salesByDay[date] = 0;
                salesByDay[date] += sale.total;
            });
            
            window.salesChart.data.labels = Object.keys(salesByDay);
            window.salesChart.data.datasets[0].data = Object.values(salesByDay);
            window.salesChart.update();
        }

        function updateFinanceChart() {
            const totalSales = appState.sales.reduce((sum, sale) => sum + sale.total, 0);
            const cmv = appState.cmv.calculatedCMV || 0;
            const machineFees = appState.sales.reduce((sum, sale) => sum + sale.machineFee, 0);
            const otherCosts = appState.costs.reduce((sum, cost) => {
                if (cost.category !== 'salary') return sum + cost.value;
                return sum;
            }, 0);
            const salary = appState.costs.reduce((sum, cost) => {
                if (cost.category === 'salary') return sum + cost.value;
                return sum;
            }, 0);
            const netProfit = totalSales - cmv - machineFees - otherCosts - salary;
            
            window.financeChart.data.datasets[0].data = [
                totalSales,
                cmv,
                machineFees,
                otherCosts,
                salary,
                netProfit
            ];
            window.financeChart.update();
        }

        // Efeitos e sons
        function playSaleAnimation() {
            dom.saleAnimation.classList.add('show');
            setTimeout(() => {
                dom.saleAnimation.classList.remove('show');
            }, 1000);
        }

        function playSaleSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Som não disponível
            }
        }

        // Notificações
        function showNotification(message, type = "success") {
            dom.notificationText.innerHTML = message;
            dom.notification.className = `notification ${type}`;
            dom.notification.classList.add('show');
            
            setTimeout(() => {
                dom.notification.classList.remove('show');
            }, 3000);
        }

        // Exportação de dados
        function exportData(type) {
            let data, filename;
            
            switch(type) {
                case 'sales':
                    data = appState.sales.map(sale => ({
                        Data: new Date(sale.date).toLocaleDateString('pt-BR'),
                        Produto: sale.productName,
                        Quantidade: sale.quantity,
                        'Preço Unitário': sale.price.toFixed(2),
                        Total: sale.total.toFixed(2),
                        'Forma de Pagamento': sale.paymentMethod,
                        'Taxa da Maquininha': sale.machineFee.toFixed(2)
                    }));
                    filename = 'vendas.csv';
                    exportToCSV(data, filename);
                    break;
                    
                case 'products':
                    data = appState.products.map(product => ({
                        Nome: product.name,
                        Categoria: product.category,
                        'Preço de Venda': product.price.toFixed(2),
                        'Custo Unitário': product.cost ? product.cost.toFixed(2) : '0.00',
                        Estoque: product.stock,
                        'Estoque Mínimo': product.minStock
                    }));
                    filename = 'produtos.csv';
                    exportToCSV(data, filename);
                    break;
                    
                case 'finance':
                    const totalSales = appState.sales.reduce((sum, sale) => sum + sale.total, 0);
                    const totalProducts = appState.sales.reduce((sum, sale) => sum + sale.quantity, 0);
                    const average = totalSales / (appState.sales.length || 1);
                    const cmv = appState.cmv.calculatedCMV || 0;
                    const machineFees = appState.sales.reduce((sum, sale) => sum + sale.machineFee, 0);
                    const otherCosts = appState.costs.reduce((sum, cost) => sum + cost.value, 0);
                    const netProfit = totalSales - cmv - machineFees - otherCosts;
                    
                    const report = `
                        RELATÓRIO FINANCEIRO - ${appState.businessInfo.name}
                        ============================================
                        Período: ${new Date().toLocaleDateString('pt-BR')}
                        
                        RESUMO:
                        - Receita Total: R$ ${totalSales.toFixed(2)}
                        - Produtos Vendidos: ${totalProducts}
                        - Ticket Médio: R$ ${average.toFixed(2)}
                        - Total de Vendas: ${appState.sales.length}
                        
                        CUSTOS:
                        - CMV: R$ ${cmv.toFixed(2)}
                        - Taxas da Maquininha: R$ ${machineFees.toFixed(2)}
                        - Outros Custos: R$ ${otherCosts.toFixed(2)}
                        
                        RESULTADO:
                        - Lucro Líquido: R$ ${netProfit.toFixed(2)}
                        - Margem Líquida: ${totalSales > 0 ? ((netProfit / totalSales) * 100).toFixed(1) : 0}%
                        
                        FORMAS DE PAGAMENTO:
                        ${appState.paymentMethods.map(p => `- ${p.name}: R$ ${p.total.toFixed(2)} (${p.fee}%)`).join('\n')}
                        
                        ESTOQUE ATUAL:
                        ${appState.products.map(p => `- ${p.name}: ${p.stock} unidades (Custo: R$ ${p.cost ? p.cost.toFixed(2) : '0.00'})`).join('\n')}
                        
                        META DIÁRIA:
                        - Meta Atual: R$ ${goalState.dailyGoal.toFixed(2)}
                        - Lucro Hoje: R$ ${calculateTodayProfit().toFixed(2)}
                        - Progresso: ${goalState.dailyGoal > 0 ? ((calculateTodayProfit() / goalState.dailyGoal) * 100).toFixed(1) : 0}%
                    `;
                    
                    downloadFile(report, 'relatorio-financeiro.txt', 'text/plain');
                    break;
            }
            
            showNotification(`Dados exportados com sucesso!`, "success");
        }

        function exportToCSV(data, filename, contentType) {
            if (data.length === 0) {
                showNotification("Nenhum dado para exportar", "warning");
                return;
            }
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => row[header]).join(','))
            ].join('\n');
            
            downloadFile(csvContent, filename, 'text/csv');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Projeção de vendas
        function calculateProjection() {
            const targetRevenue = parseFloat(dom.targetRevenue.value) || 0;
            const targetPeriod = parseInt(dom.targetPeriod.value) || 30;
            
            if (targetRevenue <= 0) {
                showNotification("Digite uma meta de faturamento válida", "danger");
                return;
            }
            
            const dailySales = appState.sales.reduce((acc, sale) => {
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                if (!acc[date]) acc[date] = 0;
                acc[date] += sale.total;
                return acc;
            }, {});
            
            const daysCount = Object.keys(dailySales).length || 1;
            const totalSales = Object.values(dailySales).reduce((a, b) => a + b, 0);
            const averageDaily = totalSales / daysCount;
            const projection = averageDaily * targetPeriod;
            const neededDaily = targetRevenue / targetPeriod;
            const growthNeeded = ((neededDaily - averageDaily) / averageDaily) * 100;
            
            let html = `
                <div style="background: #f5f5f5; padding: 1rem; border-radius: 10px; margin-top: 1rem;">
                    <h4>Projeção para ${targetPeriod} dias</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div>
                            <strong>Média Diária Atual:</strong><br>
                            R$ ${averageDaily.toFixed(2)}
                        </div>
                        <div>
                            <strong>Meta Diária Necessária:</strong><br>
                            R$ ${neededDaily.toFixed(2)}
                        </div>
                        <div>
                            <strong>Crescimento Necessário:</strong><br>
                            ${growthNeeded.toFixed(1)}%
                        </div>
                        <div>
                            <strong>Projeção Atual:</strong><br>
                            R$ ${projection.toFixed(2)}
                        </div>
                    </div>
            `;
            
            if (projection >= targetRevenue) {
                html += `<p style="color: var(--success); margin-top: 1rem;">🎯 Meta atingível com o ritmo atual!</p>`;
            } else {
                html += `<p style="color: var(--warning); margin-top: 1rem;">⚠️ Ajustes necessários para atingir a meta.</p>`;
            }
            
            html += `</div>`;
            
            dom.projectionResult.innerHTML = html;
            dom.projectionResult.style.display = 'block';
        }

        // Configurar eventos
        function setupEventListeners() {
            // Login
            dom.loginBtn.addEventListener('click', () => {
                const username = dom.usernameInput.value.trim();
                const password = dom.passwordInput.value;
                
                if (!username || !password) {
                    showNotification("Preencha todos os campos", "danger");
                    return;
                }
                
                if (login(username, password)) {
                    // Sucesso
                } else {
                    dom.loginError.style.display = 'block';
                }
            });
            
            dom.passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    dom.loginBtn.click();
                }
            });
            
            // Logout
            dom.logoutBtn.addEventListener('click', logout);
            
            // Navegação
            dom.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const sectionId = tab.dataset.tab;
                    setActiveSection(sectionId);
                });
            });
            
            // Tema
            dom.themeToggle.addEventListener('click', toggleTheme);
            
            // Filtros do dashboard
            dom.filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    dom.filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.settings.currentFilter = btn.dataset.filter;
                    saveAppData();
                    updateDashboard();
                });
            });
            
            // Vendas (pagamento misto)
            dom.productSelect.addEventListener('change', calculateSaleTotal);
            dom.quantityInput.addEventListener('input', calculateSaleTotal);
            
            // Botão para adicionar método de pagamento misto
            dom.addMixedPaymentBtn.addEventListener('click', addMixedPaymentMethod);
            
            // Registrar venda com pagamento misto
            dom.registerSaleBtn.addEventListener('click', () => {
                if (registerMixedPaymentSale()) {
                    showNotification(`Venda registrada com sucesso!`, "success");
                }
            });
            
            // Formas de Pagamento (gerenciamento)
            dom.savePaymentMethodBtn.addEventListener('click', () => {
                const name = dom.paymentMethodName.value.trim();
                const type = dom.paymentMethodType.value;
                const fee = dom.paymentMethodFee.value;
                
                if (!name) {
                    showNotification("Digite o nome da forma de pagamento", "danger");
                    return;
                }
                
                addPaymentMethod(name, type, fee);
                
                dom.paymentMethodName.value = '';
                dom.paymentMethodFee.value = '';
            });
            
            // Custos
            dom.addCostBtn.addEventListener('click', () => {
                const description = dom.costDescription.value.trim();
                const category = dom.costCategory.value;
                const value = dom.costValue.value;
                const date = dom.costDate.value;
                
                if (!description) {
                    showNotification("Digite a descrição do custo", "danger");
                    return;
                }
                
                if (!value || parseFloat(value) <= 0) {
                    showNotification("Digite um valor válido", "danger");
                    return;
                }
                
                addCost(description, category, value, date);
                
                dom.costDescription.value = '';
                dom.costValue.value = '';
                dom.costDate.value = '';
            });
            
            // CMV
            dom.calculateCMVBtn.addEventListener('click', calculateCMV);
            
            // Produtos
            dom.addProductBtn.addEventListener('click', () => {
                const name = dom.productName.value.trim();
                const category = dom.productCategory.value;
                const price = dom.productPrice.value;
                const cost = dom.productCost.value;
                const stock = dom.productStock.value;
                
                if (!name || !price || !stock) {
                    showNotification("Preencha todos os campos obrigatórios", "danger");
                    return;
                }
                
                addProduct(name, category, price, cost, stock);
                
                dom.productName.value = '';
                dom.productPrice.value = '';
                dom.productCost.value = '';
                dom.productStock.value = '10';
            });
            
            // Configurações do negócio
            dom.saveBusinessInfoBtn.addEventListener('click', () => {
                const name = dom.businessNameInput.value.trim();
                const slogan = dom.businessSloganInput.value.trim();
                
                if (!name) {
                    showNotification("Digite o nome do negócio", "danger");
                    return;
                }
                
                appState.businessInfo.name = name;
                appState.businessInfo.slogan = slogan;
                saveAppData();
                updateBusinessInfo();
                showNotification("Informações salvas com sucesso!", "success");
            });
            
            // Upload de foto
            dom.photoUpload.addEventListener('click', () => {
                dom.businessPhotoInput.click();
            });
            
            dom.businessPhotoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    showNotification("Selecione uma imagem", "danger");
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    appState.businessInfo.logo = event.target.result;
                    saveAppData();
                    updateBusinessInfo();
                    showNotification("Foto atualizada com sucesso!", "success");
                };
                reader.readAsDataURL(file);
            });
            
            // Cores
            dom.colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    appState.businessInfo.themeColor = option.dataset.color;
                    saveAppData();
                    updateBusinessInfo();
                    showNotification("Cor do tema alterada!", "success");
                });
            });
            
            // Configurações de notificação/som
            dom.saleSoundsToggle.addEventListener('change', (e) => {
                appState.settings.saleSounds = e.target.checked;
                saveAppData();
            });
            
            dom.stockNotificationsToggle.addEventListener('change', (e) => {
                appState.settings.stockNotifications = e.target.checked;
                saveAppData();
            });
            
            dom.animationsToggle.addEventListener('change', (e) => {
                appState.settings.animations = e.target.checked;
                saveAppData();
            });
            
            dom.goalNotificationsToggle.addEventListener('change', (e) => {
                goalState.settings.notifications = e.target.checked;
                saveGoalData();
            });
            
            // Gerenciamento de dados
            dom.backupDataBtn.addEventListener('click', () => {
                const backup = {
                    businessInfo: appState.businessInfo,
                    products: appState.products,
                    sales: appState.sales,
                    paymentMethods: appState.paymentMethods,
                    costs: appState.costs,
                    cmv: appState.cmv,
                    settings: appState.settings,
                    users: appState.users,
                    goalData: goalState,
                    backupDate: new Date().toISOString()
                };
                
                const backupStr = JSON.stringify(backup, null, 2);
                downloadFile(backupStr, `praiaVendas-backup-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
                showNotification("Backup criado com sucesso!", "success");
            });
            
            dom.restoreDataBtn.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const backup = JSON.parse(event.target.result);
                            
                            if (confirm("Tem certeza que deseja restaurar este backup? Todos os dados atuais serão substituídos.")) {
                                appState.businessInfo = backup.businessInfo || appState.businessInfo;
                                appState.products = backup.products || [];
                                appState.sales = backup.sales || [];
                                appState.paymentMethods = backup.paymentMethods || appState.paymentMethods;
                                appState.costs = backup.costs || [];
                                appState.cmv = backup.cmv || appState.cmv;
                                appState.settings = backup.settings || appState.settings;
                                appState.users = backup.users || appState.users;
                                
                                if (backup.goalData) {
                                    goalState = backup.goalData;
                                }
                                
                                saveAppData();
                                saveGoalData();
                                updateBusinessInfo();
                                loadProducts();
                                loadPaymentMethods();
                                loadCosts();
                                updateDashboard();
                                updateGoalDisplay();
                                updateFinanceChart();
                                
                                showNotification("Backup restaurado com sucesso!", "success");
                            }
                        } catch (err) {
                            showNotification("Erro ao ler arquivo de backup", "danger");
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            });
            
            dom.resetDataBtn.addEventListener('click', () => {
                if (confirm("Tem certeza que deseja limpar TODOS os dados? Esta ação não pode ser desfeita.")) {
                    localStorage.clear();
                    location.reload();
                }
            });
            
            // Exportação
            dom.exportSalesBtn.addEventListener('click', () => exportData('sales'));
            dom.exportProductsBtn.addEventListener('click', () => exportData('products'));
            dom.exportFinanceBtn.addEventListener('click', () => exportData('finance'));
            
            // Projeção
            dom.calculateProjectionBtn.addEventListener('click', calculateProjection);
            
            // Cookies
            dom.acceptCookies.addEventListener('click', () => {
                localStorage.setItem(DATA_KEYS.COOKIE_CONSENT, 'true');
                dom.cookieModal.classList.remove('show');
            });
        }

        // Navegação entre seções
        function setActiveSection(sectionId) {
            dom.tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === sectionId);
            });
            
            dom.sections.forEach(section => {
                section.classList.toggle('active', section.id === sectionId);
            });
            
            appState.currentSection = sectionId;
            
            if (sectionId === 'dashboard') {
                updateDashboard();
                updateGoalDisplay();
            } else if (sectionId === 'goals') {
                updateGoalDisplay();
            } else if (sectionId === 'finance') {
                updateFinanceChart();
            } else if (sectionId === 'payment-methods') {
                loadPaymentMethods();
            } else if (sectionId === 'costs') {
                loadCosts();
                dom.initialStock.value = appState.cmv.initialStock;
                dom.purchases.value = appState.cmv.purchases;
                dom.finalStock.value = appState.cmv.finalStock;
                if (appState.cmv.calculatedCMV > 0) {
                    dom.cmvResultValue.textContent = appState.cmv.calculatedCMV.toFixed(2);
                    dom.cmvResult.style.display = 'block';
                }
            } else if (sectionId === 'sales') {
                resetSaleForm();
                updateMixedPaymentDisplay();
            }
        }

        // Função global para editar produto
        window.editProduct = function(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (!product) return;
            
            const newStock = prompt(`Atualizar estoque de ${product.name}:`, product.stock);
            if (newStock !== null && !isNaN(newStock) && parseInt(newStock) >= 0) {
                product.stock = parseInt(newStock);
                saveAppData();
                loadProducts();
                showNotification(`Estoque de ${product.name} atualizado!`, "success");
            }
        };

        // Funções globais para pagamento misto
        window.addMixedPaymentMethod = addMixedPaymentMethod;
        window.removeMixedPaymentMethod = removeMixedPaymentMethod;
        window.updateMixedPaymentAmount = updateMixedPaymentAmount;
        window.updateMixedPaymentMethod = updateMixedPaymentMethod;

        // Funções globais para sistema de metas
        window.showGoalModal = showGoalModal;
        window.hideGoalModal = hideGoalModal;
        window.saveDailyGoal = saveDailyGoal;
        window.setDailyGoal = setDailyGoal;
        window.showProductModal = showProductModal;
        window.hideProductModal = hideProductModal;
        window.saveGoalProduct = saveGoalProduct;
        window.editGoalProduct = editGoalProduct;
        window.deleteGoalProduct = deleteGoalProduct;
        window.updateGoalDisplay = updateGoalDisplay;

        // Inicializar aplicativo
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>