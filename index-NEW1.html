<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PraiaVendas Pro | Gestão Inteligente para Vendedores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary: #FF6B35;
            --primary-gradient: linear-gradient(135deg, #FF6B35 0%, #FF8E53 100%);
            --primary-light: #FF8E53;
            --primary-dark: #E55A2B;
            --secondary: #4ECDC4;
            --secondary-light: #6FE7DF;
            --success: #00C851;
            --success-light: #5DFC7B;
            --success-dark: #00A843;
            --danger: #FF4444;
            --danger-light: #FF6B6B;
            --warning: #FFBB33;
            --warning-light: #FFD166;
            --info: #33B5E5;
            --dark: #2D3047;
            --light: #FFFFFF;
            --gray-50: #FAFAFA;
            --gray-100: #F5F5F5;
            --gray-200: #EEEEEE;
            --gray-300: #E0E0E0;
            --gray-400: #BDBDBD;
            --gray-500: #9E9E9E;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --card-shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --border-radius-lg: 24px;
            --font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        [data-theme="dark"] {
            --primary: #FF8E53;
            --primary-light: #FFA87A;
            --primary-dark: #E55A2B;
            --secondary: #6FE7DF;
            --secondary-light: #8CF5EE;
            --success: #5DFC7B;
            --success-light: #7DFF9B;
            --danger: #FF6B6B;
            --danger-light: #FF8A8A;
            --warning: #FFD166;
            --warning-light: #FFE08A;
            --info: #66CCFF;
            --dark: #FFFFFF;
            --light: #1A1A2E;
            --gray-50: #2D3047;
            --gray-100: #3A3E5C;
            --gray-200: #474C70;
            --gray-300: #545985;
            --gray-400: #616699;
            --gray-500: #6E73AD;
            --gray-600: #7B80C2;
            --gray-700: #888DD6;
            --gray-800: #959AEB;
            --gray-900: #A2A7FF;
            --glass-bg: rgba(26, 26, 46, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --card-shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
        }

        /* Login Screen */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .login-box {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .business-logo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary);
            margin: 0 auto 20px;
            display: block;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .business-name {
            text-align: center;
            font-size: 28px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 30px;
            letter-spacing: -0.5px;
        }

        .login-input-group {
            position: relative;
            margin-bottom: 16px;
        }

        .login-input {
            width: 100%;
            padding: 16px 50px 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            color: white;
            transition: var(--transition);
            font-weight: 500;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.2);
        }

        .login-input::placeholder {
            color: var(--gray-500);
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 8px;
            font-size: 18px;
            transition: var(--transition);
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 8px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(255, 107, 53, 0.6);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            color: var(--danger);
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 600;
            padding: 12px;
            background: rgba(255, 68, 68, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 68, 68, 0.3);
            display: none;
        }

        /* Header */
        header {
            background: var(--primary-gradient);
            padding: 16px 16px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .business-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .business-avatar {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .business-info h1 {
            font-size: 20px;
            font-weight: 800;
            color: white;
            line-height: 1.3;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .business-info span {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
            justify-content: flex-end;
        }

        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 18px;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .header-btn:active {
            transform: scale(0.95);
        }

        .tabs-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 12px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 4px;
            min-width: max-content;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            min-width: 90px;
            text-align: center;
            padding: 12px 8px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        /* Main Container */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            order: 3;
        }

        .summary-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            border-left: 6px solid var(--primary);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow-hover);
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .summary-icon {
            font-size: 32px;
            margin-bottom: 12px;
            color: var(--primary);
            opacity: 0.9;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 800;
            margin: 8px 0;
            color: var(--dark);
            font-family: 'Courier New', monospace;
            letter-spacing: -0.5px;
        }

        .summary-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Gráficos CORRIGIDOS - AGORA RESPONSÍVEIS */
        .chart-section {
            order: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .chart-container {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            position: relative;
            min-height: 350px;
            height: 400px;
            overflow: hidden;
        }

        .chart-container canvas {
            width: 100% !important;
            height: calc(90% - 60px) !important;
            max-height: 300px;
            display: block;
        }

        .chart-container.full-width {
            grid-column: 1 / -1;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            height: 40px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-description {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 15px;
            line-height: 1.4;
            min-height: 40px;
        }

        /* Meta Diária */
        .daily-goal-section {
            background: var(--primary-gradient);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            color: white;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
            order: 2;
        }

        .daily-goal-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite linear;
        }

        .daily-goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .daily-goal-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .daily-goal-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .goal-progress-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .goal-progress-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .goal-progress-title {
            font-size: 13px;
            margin-bottom: 6px;
            opacity: 0.9;
            font-weight: 600;
        }

        .goal-progress-value {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }

        .goal-progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 12px 0;
            overflow: hidden;
            position: relative;
        }

        .goal-progress-fill {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .goal-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite linear;
        }

        .circular-progress {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 12px auto;
        }

        .circular-progress svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .circular-progress-circle {
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
        }

        .circular-progress-bg {
            stroke: rgba(255, 255, 255, 0.2);
        }

        .circular-progress-fill {
            stroke: white;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .circular-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            font-weight: 800;
            color: white;
            font-family: 'Courier New', monospace;
        }

        /* Sale Card */
        .sale-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            border-top: 6px solid var(--success);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .sale-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow-hover);
        }

        .sale-form {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .form-group {
            margin-bottom: 4px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px;
            background: var(--gray-100);
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            color: var(--dark);
            transition: var(--transition);
            font-weight: 500;
        }

        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            background: var(--gray-800);
            color: var(--dark);
            border-color: var(--gray-700);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--gray-50);
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.2);
        }

        button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(255, 107, 53, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            box-shadow: 0 8px 24px rgba(78, 205, 196, 0.4);
        }

        button.secondary:hover {
            box-shadow: 0 12px 32px rgba(78, 205, 196, 0.6);
        }

        button.danger {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-light) 100%);
            box-shadow: 0 8px 24px rgba(255, 68, 68, 0.4);
        }

        button.danger:hover {
            box-shadow: 0 12px 32px rgba(255, 68, 68, 0.6);
        }

        button.success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
            box-shadow: 0 8px 24px rgba(0, 200, 81, 0.4);
        }

        button.success:hover {
            box-shadow: 0 12px 32px rgba(0, 200, 81, 0.6);
        }

        button.info {
            background: linear-gradient(135deg, var(--info) 0%, #66CCFF 100%);
            box-shadow: 0 8px 24px rgba(51, 181, 229, 0.4);
        }

        button.info:hover {
            box-shadow: 0 12px 32px rgba(51, 181, 229, 0.6);
        }

        button.warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-light) 100%);
            box-shadow: 0 8px 24px rgba(255, 187, 51, 0.4);
            color: var(--gray-900);
        }

        button.warning:hover {
            box-shadow: 0 12px 32px rgba(255, 187, 51, 0.6);
        }

        /* Sale Products */
        .sale-products-container {
            margin-bottom: 24px;
        }

        .sale-products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sale-products-list {
            max-height: 300px;
            overflow-y: auto;
            background: var(--gray-50);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--gray-200);
        }

        [data-theme="dark"] .sale-products-list {
            background: var(--gray-800);
            border-color: var(--gray-700);
        }

        .sale-product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--light);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .sale-product-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .sale-product-info {
            flex: 1;
        }

        .sale-product-name {
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--dark);
        }

        .sale-product-details {
            font-size: 14px;
            color: var(--gray-600);
        }

        .sale-product-total {
            font-weight: 800;
            color: var(--success);
            margin-right: 16px;
            font-size: 18px;
        }

        .remove-product-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .remove-product-btn:hover {
            background: var(--danger-light);
            transform: scale(1.1);
        }

        .remove-product-btn:active {
            transform: scale(0.95);
        }

        .sale-total-summary {
            background: linear-gradient(135deg, rgba(0, 200, 81, 0.1) 0%, rgba(93, 252, 123, 0.1) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--success);
        }

        .sale-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed var(--gray-300);
        }

        .sale-total-row:last-child {
            border-bottom: none;
        }

        .sale-total-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .sale-total-value {
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: var(--dark);
        }

        .sale-total-final {
            border-top: 2px solid var(--success);
            padding-top: 16px;
            margin-top: 16px;
            font-size: 20px;
        }

        /* Mixed Payment */
        .mixed-payment-section {
            margin-top: 24px;
            border-top: 2px dashed var(--gray-300);
            padding-top: 24px;
        }

        .mixed-payment-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .mixed-payment-item {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 2px solid var(--gray-200);
            transition: var(--transition);
        }

        [data-theme="dark"] .mixed-payment-item {
            background: var(--gray-800);
            border-color: var(--gray-700);
        }

        .mixed-payment-item:hover {
            border-color: var(--primary);
        }

        .mixed-payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mixed-payment-method {
            font-weight: 700;
            color: var(--dark);
            font-size: 14px;
        }

        .mixed-payment-select {
            width: 180px;
            padding: 10px;
            font-size: 14px;
            border-radius: 8px;
            border: 2px solid var(--gray-300);
            background: var(--light);
            color: var(--dark);
        }

        .mixed-payment-amount {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 12px;
        }

        .mixed-payment-amount input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
        }

        .mixed-payment-total {
            background: var(--primary-gradient);
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-weight: 800;
            margin-top: 20px;
            text-align: center;
            font-size: 20px;
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
        }

        .remove-payment-btn {
            background: var(--danger);
            padding: 6px 12px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
            border: none;
            font-weight: 600;
        }

        .remove-payment-btn:hover {
            background: var(--danger-light);
            transform: translateY(-1px);
        }

        .add-payment-btn {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            font-size: 15px;
        }

        .remaining-amount {
            margin-top: 12px;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            font-weight: 700;
            border: 2px solid;
        }

        .remaining-positive {
            background: rgba(0, 200, 81, 0.1);
            color: var(--success);
            border-color: rgba(0, 200, 81, 0.3);
        }

        .remaining-negative {
            background: rgba(255, 68, 68, 0.1);
            color: var(--danger);
            border-color: rgba(255, 68, 68, 0.3);
        }

        .remaining-zero {
            background: rgba(255, 187, 51, 0.1);
            color: var(--warning);
            border-color: rgba(255, 187, 51, 0.3);
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .product-card {
            background: var(--light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow-hover);
            border-color: var(--primary);
        }

        .product-image {
            height: 160px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }

        .product-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            animation: shimmer 2s infinite linear;
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .product-price {
            color: var(--success);
            font-weight: 800;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .product-stock {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 16px;
            font-weight: 600;
        }

        .stock-low {
            color: var(--danger);
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .product-actions button {
            flex: 1;
            padding: 12px;
            font-size: 14px;
        }

        /* History Table */
        .table-container {
            background: var(--light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin: 24px 0;
        }

        .table-header {
            padding: 20px;
            background: var(--primary-gradient);
            color: white;
        }

        .table-header h3 {
            margin: 0;
            font-weight: 800;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-filters {
            padding: 16px 20px;
            background: var(--gray-50);
            border-bottom: 2px solid var(--gray-200);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            background: var(--light);
            color: var(--dark);
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th {
            background: var(--gray-100);
            color: var(--gray-700);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 16px;
            text-align: left;
            border-bottom: 2px solid var(--gray-300);
            position: sticky;
            top: 0;
        }

        [data-theme="dark"] .data-table th {
            background: var(--gray-800);
            color: var(--gray-300);
            border-color: var(--gray-700);
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-700);
        }

        [data-theme="dark"] .data-table td {
            border-color: var(--gray-700);
            color: var(--gray-400);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        [data-theme="dark"] .data-table tr:hover {
            background: var(--gray-800);
        }

        .actions-cell {
            white-space: nowrap;
        }

        .btn-small {
            padding: 8px 16px !important;
            font-size: 13px !important;
            margin: 0 2px;
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        }

        .btn-small:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2) !important;
        }

        /* Paginação */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: var(--gray-50);
            border-top: 2px solid var(--gray-200);
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            border: 2px solid var(--gray-300);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--dark);
        }

        .page-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .page-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: var(--primary);
        }

        .page-info {
            margin: 0 12px;
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Settings */
        .settings-section {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            transition: var(--transition);
        }

        .settings-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow-hover);
        }

        .settings-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
        }

        /* Seletor de Ícones para Produtos */
        .icon-selector-container {
            position: relative;
        }

        .icon-selector-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: var(--light);
            border-radius: 8px;
            border: 2px solid var(--gray-200);
            margin-top: 8px;
            position: absolute;
            width: 100%;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .icon-selector-grid.active {
            display: grid;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 20px;
            color: var(--gray-700);
            border: 2px solid transparent;
        }

        .icon-option:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .icon-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .icon-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
            border: 2px solid var(--gray-200);
        }

        .color-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .color-picker {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .color-option {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .color-option.selected {
            border-color: var(--light);
            box-shadow: 0 0 0 3px var(--dark), 0 8px 24px rgba(0, 0, 0, 0.3);
            transform: scale(1.15);
        }

        .color-customizer {
            margin-top: 20px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
            border: 2px solid var(--gray-200);
        }

        .color-sliders {
            display: grid;
            gap: 16px;
            margin-top: 16px;
        }

        .color-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #000, var(--slider-color, #ff0000));
            border-radius: 4px;
            outline: none;
        }

        .color-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--slider-color, #ff0000);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .photo-upload {
            text-align: center;
            padding: 40px 20px;
            border: 3px dashed var(--gray-300);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            background: var(--gray-50);
        }

        .photo-upload:hover {
            border-color: var(--primary);
            background: var(--gray-100);
            transform: translateY(-2px);
        }

        .user-photo {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            object-fit: cover;
            margin: 0 auto 20px;
            border: 4px solid var(--primary);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .links-section {
            display: grid;
            gap: 16px;
            margin-top: 20px;
        }

        .link-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 12px;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .link-item:hover {
            background: var(--gray-100);
            border-color: var(--primary);
            transform: translateX(8px);
        }

        .link-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .link-text h4 {
            margin: 0 0 4px 0;
            font-weight: 700;
            font-size: 16px;
        }

        .link-text p {
            margin: 0;
            font-size: 14px;
            color: var(--gray-600);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            padding: 20px;
        }

        .modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--light);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.4);
            transform: translateY(20px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.show .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 24px;
            color: var(--primary);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            justify-content: flex-end;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--light);
            padding: 20px 24px;
            border-radius: var(--border-radius);
            box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 4000;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            border-left: 6px solid var(--success);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 24px;
            color: var(--success);
        }

        .notification-danger {
            border-left-color: var(--danger);
        }

        .notification-danger i {
            color: var(--danger);
        }

        .notification-warning {
            border-left-color: var(--warning);
        }

        .notification-warning i {
            color: var(--warning);
        }

        .notification-info {
            border-left-color: var(--info);
        }

        .notification-info i {
            color: var(--info);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes salePop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        .sale-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            color: var(--primary);
            filter: drop-shadow(0 8px 24px rgba(255, 107, 53, 0.6));
        }

        .sale-animation.show {
            animation: salePop 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gray-400);
            transition: var(--transition);
            border-radius: 50px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
            background: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(28px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--gray-600);
            font-weight: 700;
        }

        .empty-state p {
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Discount Section */
        .discount-section {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(255, 142, 83, 0.05) 100%);
            border-radius: 12px;
            padding: 16px;
            margin: 24px 0 20px 0;
            border: 2px solid rgba(255, 107, 53, 0.1);
        }

        .discount-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .discount-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px;
            background: var(--light);
            border-radius: 8px;
            border: 2px solid var(--gray-200);
            transition: var(--transition);
            cursor: pointer;
        }

        .discount-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .discount-option.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .discount-option.active .discount-icon {
            color: white;
        }

        .discount-icon {
            font-size: 18px;
            color: var(--primary);
        }

        .discount-value {
            font-weight: 700;
            font-size: 16px;
            font-family: 'Courier New', monospace;
        }

        /* Payment Controls */
        .payment-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .payment-control {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .payment-label {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 600;
        }

        .payment-input {
            padding: 12px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            background: var(--light);
            color: var(--dark);
            transition: var(--transition);
        }

        .payment-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
        }

        /* Financeiro */
        .finance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin: 24px 0;
        }

        .finance-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .finance-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow-hover);
        }

        .finance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .finance-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .finance-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--success);
            font-family: 'Courier New', monospace;
            margin: 16px 0;
        }

        .finance-details {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Filtros Responsivos */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 16px !important;
            font-size: 13px !important;
            border-radius: 20px !important;
            background: var(--gray-100) !important;
            color: var(--gray-700) !important;
            border: 2px solid var(--gray-300) !important;
            box-shadow: none !important;
            transition: var(--transition) !important;
            min-width: 100px;
        }

        .filter-btn.active {
            background: var(--primary-gradient) !important;
            color: white !important;
            border-color: var(--primary) !important;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3) !important;
        }

        .filter-btn:hover:not(.active) {
            background: var(--gray-200) !important;
            transform: translateY(-2px) !important;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .dashboard-summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .daily-goal-content {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .sale-form {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .products-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .header-actions {
                justify-content: center;
                gap: 8px;
            }

            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .tab {
                min-width: 80px;
                font-size: 12px;
                padding: 10px 6px;
            }

            .business-avatar {
                width: 48px;
                height: 48px;
            }

            .business-info h1 {
                font-size: 18px;
            }

            .chart-container {
                height: 350px;
                padding: 16px;
                min-height: 500px;
            }

            .modal-content {
                padding: 24px;
                margin: 16px;
            }

            .mixed-payment-amount {
                flex-direction: column;
                gap: 8px;
            }

            .mixed-payment-amount input {
                width: 100%;
            }

            .mixed-payment-select {
                width: 100%;
            }

            .data-table {
                display: block;
                overflow-x: auto;
            }

            .table-filters {
                flex-direction: column;
            }

            .filter-input {
                min-width: 100%;
            }

            .color-picker {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }

            .color-option {
                width: 40px;
                height: 40px;
            }

            .icon-selector-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 480px) {
            .login-box {
                padding: 24px;
            }

            .business-name {
                font-size: 24px;
            }

            .summary-card {
                padding: 16px;
            }

            .summary-value {
                font-size: 24px;
            }

            .goal-progress-value {
                font-size: 20px;
            }

            .circular-progress {
                width: 80px;
                height: 80px;
            }

            .circular-progress-text {
                font-size: 18px;
            }

            button {
                padding: 14px 20px;
                font-size: 14px;
            }

            .notification {
                left: 16px;
                right: 16px;
                max-width: none;
            }

            .modal {
                padding: 16px;
            }

            .discount-options {
                grid-template-columns: 1fr;
            }

            .finance-grid {
                grid-template-columns: 1fr;
            }

            .icon-selector-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Touch Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .summary-card:hover,
            .goal-progress-card:hover,
            .sale-card:hover,
            .product-card:hover,
            .sale-product-item:hover,
            .link-item:hover,
            .color-option:hover,
            .discount-option:hover {
                transform: none !important;
            }

            button:hover,
            .header-btn:hover,
            .remove-product-btn:hover,
            .remove-payment-btn:hover {
                transform: none !important;
            }

            .tab:hover {
                transform: none !important;
            }
        }

        /* Para telas muito pequenas */
        @media (max-width: 480px) {
            .filters {
                gap: 6px;
            }
            
            .filter-btn {
                padding: 8px 12px !important;
                font-size: 12px !important;
                min-width: 80px;
                flex: 1;
                text-align: center;
            }
        }

        /* Para modo paisagem em celular */
        @media (max-height: 600px) and (orientation: landscape) {
            .filters {
                margin-bottom: 16px;
            }
            
            .filter-btn {
                padding: 6px 10px !important;
                font-size: 11px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <img id="businessLogo" class="business-logo" src="" alt="Logo do Negócio">
            <h1 id="businessNameLogin" class="business-name">PraiaVendas Pro</h1>
            
            <div class="login-input-group">
                <input type="text" id="usernameInput" class="login-input" placeholder="Usuário" autocomplete="username">
            </div>
            
            <div class="login-input-group">
                <input type="password" id="passwordInput" class="login-input" placeholder="Senha" autocomplete="current-password">
                <button type="button" id="togglePassword" class="password-toggle">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <button id="loginBtn" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Entrar
            </button>
            <div id="loginError" class="login-error">
                <i class="fas fa-exclamation-circle"></i> Usuário ou senha incorretos
            </div>
        </div>
    </div>

    <!-- Aplicativo Principal -->
    <div id="mainApp" style="display: none;">
        <header>
            <div class="header-content">
                <div class="business-header">
                    <img id="businessAvatar" class="business-avatar" src="" alt="Avatar">
                    <div class="business-info">
                        <h1 id="businessNameHeader">PraiaVendas Pro</h1>
                        <span id="businessSlogan">Gestão Inteligente para Vendedores</span>
                    </div>
                </div>
                
                <div class="header-actions">
                    <button class="header-btn" id="hideValuesToggle" title="Ocultar/Mostrar Valores">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                    <button class="header-btn" id="notificationToggle">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="header-btn" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="header-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="dashboard">
                            <i class="fas fa-home"></i> Início
                        </div>
                        <div class="tab" data-tab="goals">
                            <i class="fas fa-bullseye"></i> Metas
                        </div>
                        <div class="tab" data-tab="sales">
                            <i class="fas fa-shopping-cart"></i> Vendas
                        </div>
                        <div class="tab" data-tab="history">
                            <i class="fas fa-history"></i> Histórico
                        </div>
                        <div class="tab" data-tab="payment-methods">
                            <i class="fas fa-credit-card"></i> Pagamentos
                        </div>
                        <div class="tab" data-tab="costs">
                            <i class="fas fa-money-bill-wave"></i> Custos
                        </div>
                        <div class="tab" data-tab="finance">
                            <i class="fas fa-chart-line"></i> Financeiro
                        </div>
                        <div class="tab" data-tab="products">
                            <i class="fas fa-box"></i> Produtos
                        </div>
                        <div class="tab" data-tab="settings">
                            <i class="fas fa-cog"></i> Configurações
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="filters" style="margin-bottom: 24px;">
                    <button class="filter-btn active" data-filter="all">Todo Período</button>
                    <button class="filter-btn" data-filter="today">Hoje</button>
                    <button class="filter-btn" data-filter="week">Semana</button>
                    <button class="filter-btn" data-filter="month">Mês</button>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Gráficos no topo -->
                    <div class="chart-section">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title"><i class="fas fa-chart-line"></i> Vendas ao Longo do Tempo</h3>
                            </div>
                            <div class="chart-description">
                                Evolução das vendas no período selecionado. Mostra tendências e padrões de venda.
                            </div>
                            <canvas id="salesChart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title"><i class="fas fa-credit-card"></i> Métodos de Pagamento</h3>
                            </div>
                            <div class="chart-description">
                                Distribuição dos valores por forma de pagamento utilizada.
                            </div>
                            <canvas id="paymentMethodsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Meta Diária mais compacta -->
                    <div>
                        <div class="daily-goal-section" id="dailyGoalSection">
                            <div class="daily-goal-header">
                                <h2><i class="fas fa-bullseye"></i> Meta Diária</h2>
                                <button onclick="showGoalModal()" class="secondary" style="padding: 8px 16px; font-size: 14px;">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                            
                            <div class="daily-goal-content">
                                <div class="goal-progress-card">
                                    <div class="goal-progress-title">Lucro Hoje</div>
                                    <div class="goal-progress-value" id="todayProfitValue">R$ 0,00</div>
                                    <div class="goal-progress-bar">
                                        <div class="goal-progress-fill" id="todayProgressFill" style="width: 0%"></div>
                                    </div>
                                    <div class="goal-progress-title">
                                        <span id="todayProgressText">0% da meta</span>
                                    </div>
                                </div>
                                
                                <div class="goal-progress-card">
                                    <div class="goal-progress-title">Meta Diária</div>
                                    <div class="goal-progress-value" id="dailyGoalValue">R$ 0,00</div>
                                    <div class="circular-progress">
                                        <svg viewBox="0 0 36 36">
                                            <path class="circular-progress-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                            <path class="circular-progress-fill" id="circularProgress" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
                                                  stroke-dasharray="100, 100" />
                                        </svg>
                                        <div class="circular-progress-text" id="circularProgressText">0%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="goal-recommendation" id="goalRecommendation">
                                <i class="fas fa-lightbulb"></i>
                                <span id="recommendationText">Defina sua meta diária para começar!</span>
                            </div>
                        </div>
                        
                        <!-- Resumo Financeiro -->
                        <div class="dashboard-summary">
                            <div class="summary-card">
                                <div class="summary-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="summary-value" id="totalSalesValue">R$ 0,00</div>
                                <div class="summary-label">Vendas Totais</div>
                            </div>
                            
                            <div class="summary-card">
                                <div class="summary-icon">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div class="summary-value" id="totalProductsSold">0</div>
                                <div class="summary-label">Produtos Vendidos</div>
                            </div>
                            
                            <div class="summary-card">
                                <div class="summary-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="summary-value" id="grossRevenue">R$ 0,00</div>
                                <div class="summary-label">Faturamento</div>
                            </div>
                            
                            <div class="summary-card">
                                <div class="summary-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="summary-value" id="netRevenue">R$ 0,00</div>
                                <div class="summary-label">Lucro Líquido</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Metas -->
            <section id="goals" class="section">
                <div class="sale-card">
                    <div class="goal-setter" style="display: flex; gap: 12px; align-items: flex-end; margin-bottom: 24px;">
                        <div style="flex: 1;">
                            <label>Nova Meta Diária (R$)</label>
                            <input type="number" id="newDailyGoal" placeholder="Ex: 150.00" step="0.01" min="0" style="width: 100%;">
                        </div>
                        <button onclick="setDailyGoal()" class="success">
                            <i class="fas fa-check"></i> Definir
                        </button>
                    </div>
                    
                    <div class="dashboard-summary">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="summary-value" id="currentDailyGoal">R$ 0,00</div>
                            <div class="summary-label">Meta Atual</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="summary-value" id="weeklyAverage">R$ 0,00</div>
                            <div class="summary-label">Média Semanal</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="summary-value" id="successRate">0%</div>
                            <div class="summary-label">Taxa de Sucesso</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="summary-value" id="daysAchieved">0/0</div>
                            <div class="summary-label">Dias Atingidos</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container full-width">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Progresso das Metas</h3>
                        <button onclick="exportGoalReport()" class="secondary" style="padding: 8px 16px;">
                            <i class="fas fa-download"></i> Relatório
                        </button>
                    </div>
                    <div class="chart-description">
                        Comparativo entre meta estabelecida e lucro real alcançado por dia.
                    </div>
                    <canvas id="goalProgressChart"></canvas>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-history"></i> Histórico de Metas</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Meta (R$)</th>
                                <th>Lucro (R$)</th>
                                <th>Progresso</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="goalHistoryList">
                            <!-- Carregado dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Vendas -->
            <section id="sales" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-cash-register"></i> Nova Venda</h2>
                    
                    <!-- Formulário de Venda primeiro -->
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="productSelect">Produto</label>
                            <select id="productSelect"></select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantityInput">Quantidade</label>
                            <input type="number" id="quantityInput" min="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="priceInput">Preço Unitário (R$)</label>
                            <input type="number" id="priceInput" min="0.01" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button id="addProductToSaleBtn" class="success">
                                <i class="fas fa-plus"></i> Adicionar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Desconto abaixo -->
                    <div class="discount-section">
                        <h3><i class="fas fa-tag"></i> Aplicar Desconto</h3>
                        <div class="discount-options">
                            <div class="discount-option" onclick="setDiscount('percent', 10)">
                                <div class="discount-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div>
                                    <div class="discount-value">10% OFF</div>
                                    <small style="font-size: 12px;">Percentual</small>
                                </div>
                            </div>
                            <div class="discount-option" onclick="setDiscount('percent', 20)">
                                <div class="discount-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div>
                                    <div class="discount-value">20% OFF</div>
                                    <small style="font-size: 12px;">Percentual</small>
                                </div>
                            </div>
                            <div class="discount-option" onclick="setDiscount('fixed', 5)">
                                <div class="discount-icon">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div>
                                    <div class="discount-value">R$ 5,00 OFF</div>
                                    <small style="font-size: 12px;">Valor Fixo</small>
                                </div>
                            </div>
                            <div class="discount-option" onclick="setDiscount('fixed', 10)">
                                <div class="discount-icon">
                                    <i class="fas fa-money-bill"></i>
                                </div>
                                <div>
                                    <div class="discount-value">R$ 10,00 OFF</div>
                                    <small style="font-size: 12px;">Valor Fixo</small>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 12px;">
                            <input type="text" id="customDiscount" placeholder="Desconto personalizado (ex: 15% ou R$ 7,50)" style="width: 100%; padding: 12px;">
                        </div>
                    </div>
                    
                    <!-- Produtos na Venda -->
                    <div class="sale-products-container">
                        <div class="sale-products-header">
                            <h3><i class="fas fa-list"></i> Produtos na Venda</h3>
                            <span id="productsCount">0 produtos</span>
                        </div>
                        
                        <div class="sale-products-list" id="saleProductsList">
                            <div class="empty-state">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Nenhum produto adicionado à venda</p>
                            </div>
                        </div>
                        
                        <div class="sale-total-summary" id="saleTotalSummary" style="display: none;">
                            <div class="sale-total-row">
                                <span class="sale-total-label">Subtotal:</span>
                                <span class="sale-total-value" id="subtotalValue">R$ 0,00</span>
                            </div>
                            <div class="sale-total-row">
                                <span class="sale-total-label">Desconto:</span>
                                <span class="sale-total-value" id="discountValue">R$ 0,00</span>
                            </div>
                            <div class="sale-total-row">
                                <span class="sale-total-label">Custo Total:</span>
                                <span class="sale-total-value" id="totalCostValue">R$ 0,00</span>
                            </div>
                            <div class="sale-total-row sale-total-final">
                                <span class="sale-total-label">Lucro Bruto:</span>
                                <span class="sale-total-value" id="grossProfitValue">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Controles de Pagamento -->
                    <div class="payment-controls">
                        <div class="payment-control">
                            <div class="payment-label">Total da Venda</div>
                            <input type="text" id="totalSaleAmount" class="payment-input" value="R$ 0,00" readonly>
                        </div>
                        
                        <div class="payment-control">
                            <div class="payment-label">Valor Pago (Dinheiro)</div>
                            <input type="number" id="cashPaidAmount" class="payment-input" placeholder="R$ 0,00" step="0.01" onchange="calculateChange()">
                        </div>
                        
                        <div class="payment-control">
                            <div class="payment-label">Troco</div>
                            <input type="text" id="changeAmount" class="payment-input" value="R$ 0,00" readonly>
                        </div>
                    </div>
                    
                    <!-- Pagamento Misto -->
                    <div class="mixed-payment-section">
                        <div class="mixed-payment-title">
                            <h3><i class="fas fa-money-check-alt"></i> Pagamento Misto</h3>
                            <button onclick="autoDistributePayment()" class="secondary" style="padding: 8px 16px; font-size: 14px;">
                                <i class="fas fa-balance-scale"></i> Distribuir
                            </button>
                        </div>
                        
                        <div id="mixedPaymentContainer">
                            <div class="empty-state" style="padding: 20px;">
                                <i class="fas fa-credit-card"></i>
                                <p>Adicione formas de pagamento</p>
                            </div>
                        </div>
                        
                        <button id="addMixedPaymentBtn" class="add-payment-btn">
                            <i class="fas fa-plus"></i> Adicionar Forma de Pagamento
                        </button>
                        
                        <div id="paymentSummary" style="margin-top: 20px;">
                            <div class="mixed-payment-total">
                                Total Pago: R$ <span id="totalPaid">0.00</span>
                            </div>
                            <div id="remainingAmount" class="remaining-amount remaining-zero">
                                Valor Quitado
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
                        <button id="registerSaleBtn" disabled>
                            <i class="fas fa-check"></i> Registrar Venda
                        </button>
                        <button id="clearSaleBtn" class="secondary">
                            <i class="fas fa-times"></i> Limpar Tudo
                        </button>
                        <button id="calculateChangeBtn" class="info" onclick="calculateChange()">
                            <i class="fas fa-calculator"></i> Calcular Troco
                        </button>
                    </div>
                </div>
                
                <!-- Vendas Recentes -->
                <div class="sale-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3><i class="fas fa-history"></i> Vendas de Hoje</h3>
                        <span id="todaySalesCount">0 vendas</span>
                    </div>
                    <div id="recentSalesList" class="sale-products-list">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>Nenhuma venda hoje</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Histórico -->
            <section id="history" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-history"></i> Histórico Completo de Vendas</h3>
                        <button onclick="clearHistory()" class="danger" style="margin-left: auto; padding: 8px 16px;">
                            <i class="fas fa-trash"></i> Limpar Histórico
                        </button>
                    </div>
                    
                    <div class="table-filters">
                        <input type="date" id="filterDate" class="filter-input">
                        <input type="text" id="filterProduct" class="filter-input" placeholder="Filtrar por produto...">
                        <select id="filterPayment" class="filter-input">
                            <option value="">Todos os pagamentos</option>
                        </select>
                        <button onclick="exportHistory()" class="secondary" style="margin-left: auto;">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Valor</th>
                                    <th>Pagamento</th>
                                    <th>Lucro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="historyList">
                                <!-- Histórico carregado dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Paginação -->
                    <div class="pagination" id="historyPagination" style="display: none;">
                        <button class="page-btn" onclick="changeHistoryPage('prev')">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="page-info" id="historyPageInfo">Página 1 de 1</span>
                        <button class="page-btn" onclick="changeHistoryPage('next')">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="chart-container full-width">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Análise de Vendas por Dia</h3>
                    </div>
                    <div class="chart-description">
                        Volume de vendas diário com destaque para os dias de maior movimento.
                    </div>
                    <canvas id="historyChart"></canvas>
                </div>
            </section>
            
            <!-- Pagamentos -->
            <section id="payment-methods" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-credit-card"></i> Gerenciar Formas de Pagamento</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="paymentMethodName">Nome</label>
                            <input type="text" id="paymentMethodName" placeholder="Ex: Pix, Dinheiro...">
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentMethodType">Tipo</label>
                            <select id="paymentMethodType">
                                <option value="pix">Pix</option>
                                <option value="cash">Dinheiro</option>
                                <option value="credit">Cartão Crédito</option>
                                <option value="debit">Cartão Débito</option>
                                <option value="other">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentMethodFee">Taxa (%)</label>
                            <input type="number" id="paymentMethodFee" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentMethodIcon">Ícone (Font Awesome)</label>
                            <input type="text" id="paymentMethodIcon" placeholder="fa-credit-card">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 20px;">
                        <button id="savePaymentMethodBtn">
                            <i class="fas fa-plus"></i> Adicionar
                        </button>
                        <button id="cancelPaymentEdit" class="secondary" style="display: none;">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-list"></i> Formas de Pagamento Cadastradas</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ícone</th>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Taxa</th>
                                <th>Total Recebido</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="paymentMethodsList">
                            <!-- Carregado dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Custos -->
            <section id="costs" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-money-bill-wave"></i> Registrar Custo/Despesa</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="costDescription">Descrição</label>
                            <input type="text" id="costDescription" placeholder="Ex: Transporte, Alimentação...">
                        </div>
                        
                        <div class="form-group">
                            <label for="costCategory">Categoria</label>
                            <select id="costCategory">
                                <option value="transport">Transporte</option>
                                <option value="food">Alimentação</option>
                                <option value="machine_fee">Taxa Maquininha</option>
                                <option value="donation">Doação</option>
                                <option value="barter">Escambo</option>
                                <option value="gift">Brinde</option>
                                <option value="water">Água</option>
                                <option value="electricity">Luz</option>
                                <option value="gas">Gás</option>
                                <option value="salary">Salário</option>
                                <option value="employee">Funcionário</option>
                                <option value="other">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="costValue">Valor (R$)</label>
                            <input type="number" id="costValue" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="costDate">Data</label>
                            <input type="date" id="costDate">
                        </div>
                    </div>
                    
                    <button id="addCostBtn">
                        <i class="fas fa-plus"></i> Registrar Custo
                    </button>
                </div>
                
                <div class="chart-container full-width">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Distribuição de Custos por Categoria</h3>
                        <button onclick="exportCostReport()" class="secondary" style="padding: 8px 16px;">
                            <i class="fas fa-download"></i> Relatório
                        </button>
                    </div>
                    <div class="chart-description">
                        Análise dos principais custos agrupados por categoria para identificar oportunidades de redução.
                    </div>
                    <canvas id="costsChart"></canvas>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-calculator"></i> Custos Registrados</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="costsList">
                            <!-- Carregado dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Financeiro -->
            <section id="finance" class="section">
                <div class="finance-grid">
                    <div class="finance-card">
                        <div class="finance-header">
                            <h3 class="finance-title"><i class="fas fa-money-bill-wave"></i> Fluxo de Caixa</h3>
                            <span class="secondary" style="padding: 6px 12px; border-radius: 20px; font-size: 12px;">Mensal</span>
                        </div>
                        <div class="finance-value" id="cashFlowValue">R$ 0,00</div>
                        <div class="finance-details">
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Entradas:</span>
                                <span style="color: var(--success); font-weight: 600;" id="cashInflows">R$ 0,00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Saídas:</span>
                                <span style="color: var(--danger); font-weight: 600;" id="cashOutflows">R$ 0,00</span>
                            </div>
                            <div style="margin-top: 16px; font-size: 13px;">
                                <i class="fas fa-info-circle"></i> Saldo líquido do período
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-card">
                        <div class="finance-header">
                            <h3 class="finance-title"><i class="fas fa-chart-line"></i> Rentabilidade</h3>
                            <span class="secondary" style="padding: 6px 12px; border-radius: 20px; font-size: 12px;">Margem</span>
                        </div>
                        <div class="finance-value" id="profitMarginValue">0%</div>
                        <div class="finance-details">
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Faturamento:</span>
                                <span id="revenueAmount">R$ 0,00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Lucro:</span>
                                <span style="color: var(--success); font-weight: 600;" id="profitAmount">R$ 0,00</span>
                            </div>
                            <div style="margin-top: 16px; font-size: 13px;">
                                <i class="fas fa-chart-bar"></i> Margem de lucro sobre vendas
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-card">
                        <div class="finance-header">
                            <h3 class="finance-title"><i class="fas fa-calendar-alt"></i> Média Diária</h3>
                            <span class="secondary" style="padding: 6px 12px; border-radius: 20px; font-size: 12px;">30 dias</span>
                        </div>
                        <div class="finance-value" id="dailyAverageValue">R$ 0,00</div>
                        <div class="finance-details">
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Melhor dia:</span>
                                <span style="color: var(--success); font-weight: 600;" id="bestDayValue">R$ 0,00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Pior dia:</span>
                                <span style="color: var(--danger); font-weight: 600;" id="worstDayValue">R$ 0,00</span>
                            </div>
                            <div style="margin-top: 16px; font-size: 13px;">
                                <i class="fas fa-trend-up"></i> Tendência de crescimento
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-card">
                        <div class="finance-header">
                            <h3 class="finance-title"><i class="fas fa-box"></i> Produtividade</h3>
                            <span class="secondary" style="padding: 6px 12px; border-radius: 20px; font-size: 12px;">Unidade</span>
                        </div>
                        <div class="finance-value" id="productivityValue">0</div>
                        <div class="finance-details">
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Vendas/dia:</span>
                                <span id="salesPerDay">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                <span>Ticket médio:</span>
                                <span id="averageTicket">R$ 0,00</span>
                            </div>
                            <div style="margin-top: 16px; font-size: 13px;">
                                <i class="fas fa-bolt"></i> Eficiência operacional
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container full-width">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-area"></i> Evolução Financeira Mensal</h3>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="exportFinancialReport()" class="secondary" style="padding: 8px 16px;">
                                <i class="fas fa-download"></i> Relatório
                            </button>
                            <button onclick="showFinancialDetails()" class="info" style="padding: 8px 16px;">
                                <i class="fas fa-search"></i> Detalhes
                            </button>
                        </div>
                    </div>
                    <div class="chart-description">
                        Comparativo mensal entre faturamento, custos e lucro líquido para análise de desempenho.
                    </div>
                    <canvas id="financialChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-balance-scale"></i> Composição de Custos</h3>
                    </div>
                    <div class="chart-description">
                        Distribuição percentual dos principais tipos de custos em relação ao total.
                    </div>
                    <canvas id="costCompositionChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-trend-up"></i> Projeção Financeira</h3>
                    </div>
                    <div class="chart-description">
                        Previsão de faturamento e lucro para os próximos 30 dias baseado no histórico.
                    </div>
                    <canvas id="forecastChart"></canvas>
                </div>
            </section>
            
            <!-- Produtos - ATUALIZADO COM SELETOR DE ÍCONES -->
            <section id="products" class="section">
                <div class="sale-card">
                    <h2><i class="fas fa-plus-circle"></i> Gerenciar Produtos</h2>
                    <div class="sale-form">
                        <div class="form-group">
                            <label for="productName">Nome do Produto</label>
                            <input type="text" id="productName" placeholder="Ex: Água de Coco, Sorvete...">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Categoria</label>
                            <select id="productCategory">
                                <option value="bebidas">Bebidas</option>
                                <option value="comidas">Comidas</option>
                                <option value="sobremesas">Sobremesas</option>
                                <option value="acessorios">Acessórios</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group icon-selector-container">
                            <label for="productIcon">Ícone do Produto</label>
                            <input type="text" id="productIcon" placeholder="Clique para escolher um ícone" readonly onclick="showIconSelector()" style="cursor: pointer;">
                            <div class="icon-selector-grid" id="iconSelector">
                                <!-- Ícones serão carregados aqui -->
                            </div>
                            <div class="icon-preview" id="iconPreview" style="display: none;">
                                <i id="selectedIconPreview" class="fas fa-box"></i>
                                <span id="selectedIconName">Ícone selecionado: fa-box</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">Preço de Venda (R$)</label>
                            <input type="number" id="productPrice" min="0.01" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCost">Custo Unitário (R$)</label>
                            <input type="number" id="productCost" min="0.01" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="productStock">Estoque Atual</label>
                            <input type="number" id="productStock" min="0" value="10">
                        </div>
                        
                        <div class="form-group">
                            <label for="productMinStock">Estoque Mínimo</label>
                            <input type="number" id="productMinStock" min="0" value="5">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 20px;">
                        <button id="addProductBtn">
                            <i class="fas fa-plus"></i> Adicionar Produto
                        </button>
                        <button id="cancelEditBtn" class="secondary" style="display: none;">
                            <i class="fas fa-times"></i> Cancelar Edição
                        </button>
                        <button onclick="importProducts()" class="info">
                            <i class="fas fa-file-import"></i> Importar
                        </button>
                    </div>
                </div>
                
                <div class="products-grid" id="productsList">
                    <!-- Carregado dinamicamente -->
                </div>
            </section>
            
            <!-- Configurações -->
            <section id="settings" class="section">
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-store"></i> Personalização do Negócio</h3>
                    <div class="form-group">
                        <label for="businessNameInput">Nome do Negócio</label>
                        <input type="text" id="businessNameInput" placeholder="Nome do seu negócio">
                    </div>
                    
                    <div class="form-group">
                        <label for="businessSloganInput">Slogan/Descrição</label>
                        <input type="text" id="businessSloganInput" placeholder="Ex: As melhores águas de coco da praia!">
                    </div>
                    
                    <div class="form-group">
                        <label>Logo/Foto do Negócio</label>
                        <div class="photo-upload" id="photoUpload">
                            <img id="businessPhotoPreview" class="user-photo" src="" alt="Foto do Negócio">
                            <p>Clique para selecionar uma imagem</p>
                            <input type="file" id="businessPhotoInput" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <button id="saveBusinessInfoBtn">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-palette"></i> Personalização Visual</h3>
                    <p style="margin-bottom: 16px; color: var(--gray-600);">
                        Selecione uma cor ou personalize para alterar o tema do sistema
                    </p>
                    
                    <div class="color-picker">
                        <div class="color-option selected" style="background-color: #FF6B35;" data-color="#FF6B35"></div>
                        <div class="color-option" style="background-color: #4ECDC4;" data-color="#4ECDC4"></div>
                        <div class="color-option" style="background-color: #00C851;" data-color="#00C851"></div>
                        <div class="color-option" style="background-color: #FF4444;" data-color="#FF4444"></div>
                        <div class="color-option" style="background-color: #FFBB33;" data-color="#FFBB33"></div>
                        <div class="color-option" style="background-color: #33B5E5;" data-color="#33B5E5"></div>
                        <div class="color-option" style="background-color: #9C27B0;" data-color="#9C27B0"></div>
                        <div class="color-option" style="background-color: #795548;" data-color="#795548"></div>
                        <div class="color-option" style="background-color: #607D8B;" data-color="#607D8B"></div>
                        <div class="color-option" style="background-color: #FF4081;" data-color="#FF4081"></div>
                        <div class="color-option" style="background-color: #3F51B5;" data-color="#3F51B5"></div>
                        <div class="color-option" style="background-color: #009688;" data-color="#009688"></div>
                        <div class="color-option" style="background-color: #FF9800;" data-color="#FF9800"></div>
                        <div class="color-option" style="background-color: #8BC34A;" data-color="#8BC34A"></div>
                        <div class="color-option" style="background-color: #E91E63;" data-color="#E91E63"></div>
                        <div class="color-option" style="background-color: #673AB7;" data-color="#673AB7"></div>
                    </div>
                    
                    <div class="color-customizer">
                        <h4 style="margin-bottom: 16px;">Personalizar Cor Principal</h4>
                        <input type="color" id="customColorPicker" style="width: 100%; height: 60px; border-radius: 12px; border: none; margin-bottom: 16px;">
                        <div class="color-sliders">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 60px; font-weight: 600; color: var(--gray-700);">Vermelho</span>
                                <input type="range" id="redSlider" min="0" max="255" value="255" class="color-slider" style="--slider-color: #ff0000; flex: 1;">
                                <span id="redValue" style="width: 40px; text-align: center; font-family: monospace;">255</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 60px; font-weight: 600; color: var(--gray-700);">Verde</span>
                                <input type="range" id="greenSlider" min="0" max="255" value="107" class="color-slider" style="--slider-color: #00ff00; flex: 1;">
                                <span id="greenValue" style="width: 40px; text-align: center; font-family: monospace;">107</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="width: 60px; font-weight: 600; color: var(--gray-700);">Azul</span>
                                <input type="range" id="blueSlider" min="0" max="255" value="53" class="color-slider" style="--slider-color: #0000ff; flex: 1;">
                                <span id="blueValue" style="width: 40px; text-align: center; font-family: monospace;">53</span>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <label for="hexColorInput" style="display: block; margin-bottom: 8px; font-weight: 600;">Código HEX</label>
                            <input type="text" id="hexColorInput" placeholder="#FF6B35" style="width: 100%; text-align: center; font-family: monospace; font-weight: bold; padding: 12px; border-radius: 8px; border: 2px solid var(--gray-300);">
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-bell"></i> Preferências de Notificação</h3>
                    <div style="display: grid; gap: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Sons de Venda</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Efeitos sonoros ao registrar vendas</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="saleSoundsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Notificações de Estoque</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Alertas quando produtos estiverem com estoque baixo</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="stockNotificationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Animações e Efeitos</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Animações visuais durante o uso</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="animationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Alertas de Meta</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Notificações sobre progresso de metas</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="goalNotificationsToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-eye-slash"></i> Privacidade e Exibição</h3>
                    <div style="display: grid; gap: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Ocultar Valores Financeiros</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Esconde valores monetários, exceto na área de vendas</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="hideValuesToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">Modo de Exibição Simplificado</div>
                                <div style="font-size: 14px; color: var(--gray-600);">Interface mais limpa com menos informações</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="simpleModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-database"></i> Gerenciamento de Dados</h3>
                    <div style="display: grid; gap: 16px;">
                        <button id="backupDataBtn" class="secondary">
                            <i class="fas fa-save"></i> Criar Backup Completo
                        </button>
                        <button id="restoreDataBtn" class="secondary">
                            <i class="fas fa-undo"></i> Restaurar de Backup
                        </button>
                        <button id="exportAllDataBtn" class="info">
                            <i class="fas fa-file-export"></i> Exportar Todos os Dados
                        </button>
                        <button id="resetDataBtn" class="danger">
                            <i class="fas fa-trash"></i> Limpar Todos os Dados
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title"><i class="fas fa-link"></i> Links e Suporte</h3>
                    <div class="links-section">
                        <a href="#" class="link-item" target="_blank">
                            <div class="link-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="link-text">
                                <h4>Criador do Sistema</h4>
                                <p>Conheça o desenvolvedor e seu trabalho</p>
                            </div>
                        </a>
                        
                        <a href="#" class="link-item" target="_blank">
                            <div class="link-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="link-text">
                                <h4>Versão Premium</h4>
                                <p>Recursos avançados e suporte prioritário</p>
                            </div>
                        </a>
                        
                        <a href="#" class="link-item" target="_blank">
                            <div class="link-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <div class="link-text">
                                <h4>Central de Ajuda</h4>
                                <p>Tutoriais, FAQ e suporte técnico</p>
                            </div>
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Notificação -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operação realizada com sucesso!</span>
    </div>

    <!-- Animação de Venda -->
    <div class="sale-animation" id="saleAnimation">
        <i class="fas fa-money-bill-wave"></i>
    </div>

    <!-- Modal de Meta -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-bullseye"></i> Configurar Meta Avançada</h3>
            
            <div class="form-group">
                <label for="modalDailyGoal">Valor da Meta (R$)</label>
                <input type="number" id="modalDailyGoal" min="0" step="0.01" placeholder="Ex: 150.00">
            </div>
            
            <div class="form-group">
                <label for="goalDescription">Descrição da Meta</label>
                <input type="text" id="goalDescription" placeholder="Ex: Meta para investimento em equipamentos...">
            </div>
            
            <div class="form-group">
                <label for="goalPeriod">Período da Meta</label>
                <select id="goalPeriod">
                    <option value="daily">Diária</option>
                    <option value="weekly">Semanal</option>
                    <option value="monthly">Mensal</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="goalStartDate">Data Inicial</label>
                <input type="date" id="goalStartDate">
            </div>
            
            <div class="form-group">
                <label for="goalEndDate">Data Final</label>
                <input type="date" id="goalEndDate">
            </div>
            
            <div class="modal-actions">
                <button onclick="hideGoalModal()" class="secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="saveDailyGoal()" class="success">
                    <i class="fas fa-check"></i> Salvar Meta
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Exclusão -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h3>
            <p id="deleteModalText">Tem certeza que deseja excluir este item? Esta ação não pode ser desfeita.</p>
            <div class="modal-actions">
                <button onclick="hideDeleteModal()" class="secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button onclick="confirmDelete()" class="danger">
                    <i class="fas fa-trash"></i> Excluir Permanentemente
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Cookies -->
    <div class="modal" id="cookieModal">
        <div class="modal-content">
            <h3 class="modal-title"><i class="fas fa-cookie-bite"></i> Privacidade e Armazenamento</h3>
            <p style="margin-bottom: 16px;">Usamos armazenamento local no seu dispositivo para salvar todos os dados do sistema. Nenhuma informação é enviada para servidores externos.</p>
            <p style="margin-bottom: 24px; color: var(--gray-600); font-size: 14px;">
                <i class="fas fa-shield-alt"></i> Seus dados permanecem 100% no seu dispositivo
            </p>
            <div class="modal-actions">
                <button id="acceptCookies" class="success">
                    <i class="fas fa-check"></i> Entendi e Aceito
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Financeiro Detalhado -->
    <div class="modal" id="financialDetailsModal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 class="modal-title"><i class="fas fa-chart-line"></i> Detalhamento Financeiro</h3>
            <div id="financialDetailsContent">
                <!-- Conteúdo carregado dinamicamente -->
            </div>
            <div class="modal-actions">
                <button onclick="hideFinancialDetails()" class="secondary">
                    <i class="fas fa-times"></i> Fechar
                </button>
                <button onclick="exportFinancialDetails()" class="success">
                    <i class="fas fa-download"></i> Exportar Relatório
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============ SISTEMA DE LOGIN COM JSON ============
        const LOGIN_SYSTEM_KEYS = {
            LAST_LOGIN_DATE: 'praiaVendas_lastLoginDate',
            LOGIN_REQUIRED: 'praiaVendas_loginRequired',
            SESSION: 'praiaVendas_session',
            LOGIN_ATTEMPTS: 'praiaVendas_loginAttempts',
            BLOCKED_UNTIL: 'praiaVendas_blockedUntil'
        };

        // ============ SISTEMA DE METAS ============
        const GOAL_DATA_KEYS = {
            DAILY_GOAL: 'praiaVendas_dailyGoal',
            GOAL_PRODUCTS: 'praiaVendas_goalProducts',
            GOAL_HISTORY: 'praiaVendas_goalHistory',
            GOAL_SETTINGS: 'praiaVendas_goalSettings',
            GOAL_CONFIGS: 'praiaVendas_goalConfigs'
        };

        // ============ APLICAÇÃO PRINCIPAL ============
        const DATA_KEYS = {
            BUSINESS_INFO: 'praiaVendas_businessInfo',
            PRODUCTS: 'praiaVendas_products',
            SALES: 'praiaVendas_sales',
            PAYMENT_METHODS: 'praiaVendas_paymentMethods',
            COSTS: 'praiaVendas_costs',
            SETTINGS: 'praiaVendas_settings',
            COOKIE_CONSENT: 'praiaVendas_cookieConsent',
            FINANCIAL_DATA: 'praiaVendas_financialData'
        };

        let appState = {
            currentUser: null,
            businessInfo: {
                name: "PraiaVendas Pro",
                slogan: "Gestão Inteligente para Vendedores",
                logo: "",
                themeColor: '#FF6B35',
                changeFund: 0.00
            },
            products: [],
            sales: [],
            paymentMethods: [
                { id: 1, name: "Pix", type: "pix", fee: 0.00, total: 0, icon: "fa-qrcode" },
                { id: 2, name: "Dinheiro", type: "cash", fee: 0.00, total: 0, icon: "fa-money-bill-wave" },
                { id: 3, name: "Cartão Crédito", type: "credit", fee: 3.99, total: 0, icon: "fa-credit-card" },
                { id: 4, name: "Cartão Débito", type: "debit", fee: 2.39, total: 0, icon: "fa-credit-card" }
            ],
            costs: [],
            settings: {
                darkMode: false,
                saleSounds: true,
                stockNotifications: true,
                animations: true,
                currentFilter: 'all',
                goalNotifications: true,
                hideValues: false,
                simpleMode: false
            },
            users: [],
            currentSection: 'dashboard',
            financialData: {
                monthlyData: [],
                projections: [],
                analysis: {}
            }
        };

        let goalState = {
            dailyGoal: 0,
            goalProducts: [],
            goalHistory: [],
            settings: {
                notifications: true,
                autoCalculate: true
            },
            todayProfit: 0,
            configs: []
        };

        let currentSale = {
            products: [],
            total: 0,
            cost: 0,
            grossProfit: 0,
            discount: {
                type: null,
                value: 0
            }
        };

        let mixedPaymentMethods = [];
        let nextPaymentId = 1;
        let itemToDelete = null;
        let deleteCallback = null;

        // Gráficos
        let salesChart = null;
        let paymentMethodsChart = null;
        let goalProgressChart = null;
        let historyChart = null;
        let costsChart = null;
        let financialChart = null;
        let costCompositionChart = null;
        let forecastChart = null;

        // Paginação do histórico
        let historyPage = 1;
        const HISTORY_ITEMS_PER_PAGE = 20;
        let filteredHistory = [];

        // Lista de ícones disponíveis
        const availableIcons = [
            'fa-wine-bottle', 'fa-wine-glass-alt', 'fa-beer', 'fa-cocktail', 'fa-coffee',
            'fa-hamburger', 'fa-pizza-slice', 'fa-hotdog', 'fa-drumstick-bite', 'fa-fish',
            'fa-ice-cream', 'fa-cookie', 'fa-cake-candles', 'fa-candy-cane', 'fa-lollipop',
            'fa-umbrella-beach', 'fa-sunglasses', 'fa-tshirt', 'fa-hat-cowboy', 'fa-shoe-prints',
            'fa-box', 'fa-gift', 'fa-star', 'fa-heart', 'fa-gem',
            'fa-basket-shopping', 'fa-shopping-cart', 'fa-tag', 'fa-tags', 'fa-percentage',
            'fa-bolt', 'fa-fire', 'fa-sun', 'fa-moon', 'fa-cloud',
            'fa-apple-alt', 'fa-lemon', 'fa-pepper-hot', 'fa-carrot', 'fa-seedling'
        ];

        // ============ FUNÇÕES PRINCIPAIS ============
        async function initApp() {
            await loadUsersFromJSON();
            loadAppData();
            loadGoalData();
            
            const needsLogin = checkDailyLogin();
            if (needsLogin) {
                showLogin();
            } else {
                checkSession();
            }
            
            checkCookieConsent();
            setupEventListeners();
            updateBusinessInfo();
            loadProducts();
            loadPaymentMethods();
            loadCosts();
            setupIconSelector();
            
            // Inicializar gráficos primeiro
            setTimeout(() => {
                setupCharts();
                updateDashboard();
                updateGoalDisplay();
                updateRecentSales();
                updateFinancialDashboard();
                updateAllCharts();
            }, 100);
        }

        async function loadUsersFromJSON() {
            try {
                const response = await fetch('usuarios.json');
                if (!response.ok) {
                    throw new Error('Arquivo usuarios.json não encontrado');
                }
                
                const data = await response.json();
                appState.users = data.usuarios || [];
                
                // Atualizar último acesso para usuários logados
                const session = localStorage.getItem(LOGIN_SYSTEM_KEYS.SESSION);
                if (session) {
                    const sessionData = JSON.parse(session);
                    const user = appState.users.find(u => u.username === sessionData.username);
                    if (user) {
                        user.ultimo_acesso = new Date().toISOString();
                    }
                }
                
            } catch (error) {
                console.error('Erro ao carregar usuários:', error);
                // Usuários padrão como fallback
                
            }
        }

        function loadAppData() {
            const savedBusinessInfo = localStorage.getItem(DATA_KEYS.BUSINESS_INFO);
            if (savedBusinessInfo) appState.businessInfo = JSON.parse(savedBusinessInfo);
            
            const savedProducts = localStorage.getItem(DATA_KEYS.PRODUCTS);
            if (savedProducts) appState.products = JSON.parse(savedProducts);
            
            const savedSales = localStorage.getItem(DATA_KEYS.SALES);
            if (savedSales) appState.sales = JSON.parse(savedSales);
            
            const savedPaymentMethods = localStorage.getItem(DATA_KEYS.PAYMENT_METHODS);
            if (savedPaymentMethods) appState.paymentMethods = JSON.parse(savedPaymentMethods);
            
            const savedCosts = localStorage.getItem(DATA_KEYS.COSTS);
            if (savedCosts) appState.costs = JSON.parse(savedCosts);
            
            const savedSettings = localStorage.getItem(DATA_KEYS.SETTINGS);
            if (savedSettings) appState.settings = JSON.parse(savedSettings);
            
            const savedFinancialData = localStorage.getItem(DATA_KEYS.FINANCIAL_DATA);
            if (savedFinancialData) appState.financialData = JSON.parse(savedFinancialData);
        }

        function saveAppData() {
            localStorage.setItem(DATA_KEYS.BUSINESS_INFO, JSON.stringify(appState.businessInfo));
            localStorage.setItem(DATA_KEYS.PRODUCTS, JSON.stringify(appState.products));
            localStorage.setItem(DATA_KEYS.SALES, JSON.stringify(appState.sales));
            localStorage.setItem(DATA_KEYS.PAYMENT_METHODS, JSON.stringify(appState.paymentMethods));
            localStorage.setItem(DATA_KEYS.COSTS, JSON.stringify(appState.costs));
            localStorage.setItem(DATA_KEYS.SETTINGS, JSON.stringify(appState.settings));
            localStorage.setItem(DATA_KEYS.FINANCIAL_DATA, JSON.stringify(appState.financialData));
        }

        function loadGoalData() {
            const savedDailyGoal = localStorage.getItem(GOAL_DATA_KEYS.DAILY_GOAL);
            if (savedDailyGoal) goalState.dailyGoal = parseFloat(savedDailyGoal);
            
            const savedGoalProducts = localStorage.getItem(GOAL_DATA_KEYS.GOAL_PRODUCTS);
            if (savedGoalProducts) goalState.goalProducts = JSON.parse(savedGoalProducts);
            
            const savedGoalHistory = localStorage.getItem(GOAL_DATA_KEYS.GOAL_HISTORY);
            if (savedGoalHistory) goalState.goalHistory = JSON.parse(savedGoalHistory);
            
            const savedGoalSettings = localStorage.getItem(GOAL_DATA_KEYS.GOAL_SETTINGS);
            if (savedGoalSettings) goalState.settings = JSON.parse(savedGoalSettings);
            
            const savedGoalConfigs = localStorage.getItem(GOAL_DATA_KEYS.GOAL_CONFIGS);
            if (savedGoalConfigs) goalState.configs = JSON.parse(savedGoalConfigs);
        }

        function saveGoalData() {
            localStorage.setItem(GOAL_DATA_KEYS.DAILY_GOAL, goalState.dailyGoal.toString());
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_PRODUCTS, JSON.stringify(goalState.goalProducts));
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_HISTORY, JSON.stringify(goalState.goalHistory));
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_SETTINGS, JSON.stringify(goalState.settings));
            localStorage.setItem(GOAL_DATA_KEYS.GOAL_CONFIGS, JSON.stringify(goalState.configs));
        }

        function checkDailyLogin() {
            const lastLoginDate = localStorage.getItem(LOGIN_SYSTEM_KEYS.LAST_LOGIN_DATE);
            const today = new Date().toDateString();
            
            if (!lastLoginDate || lastLoginDate !== today) {
                localStorage.setItem(LOGIN_SYSTEM_KEYS.LOGIN_REQUIRED, 'true');
                return true;
            }
            
            const loginRequired = localStorage.getItem(LOGIN_SYSTEM_KEYS.LOGIN_REQUIRED);
            return loginRequired === 'true';
        }

        function markAsLoggedIn() {
            const today = new Date().toDateString();
            localStorage.setItem(LOGIN_SYSTEM_KEYS.LAST_LOGIN_DATE, today);
            localStorage.setItem(LOGIN_SYSTEM_KEYS.LOGIN_REQUIRED, 'false');
            localStorage.removeItem(LOGIN_SYSTEM_KEYS.LOGIN_ATTEMPTS);
            localStorage.removeItem(LOGIN_SYSTEM_KEYS.BLOCKED_UNTIL);
        }

        function checkSession() {
            const session = localStorage.getItem(LOGIN_SYSTEM_KEYS.SESSION);
            if (session) {
                const sessionData = JSON.parse(session);
                if (sessionData.expires > Date.now()) {
                    const user = appState.users.find(u => u.username === sessionData.username);
                    if (user && user.ativo && !user.bloqueado) {
                        appState.currentUser = user;
                        const needsLogin = checkDailyLogin();
                        if (needsLogin) {
                            showLogin();
                        } else {
                            showMainApp();
                        }
                        return;
                    }
                }
            }
            showLogin();
        }

        function login(username, password) {
            // Verificar se está bloqueado
            const blockedUntil = localStorage.getItem(LOGIN_SYSTEM_KEYS.BLOCKED_UNTIL);
            if (blockedUntil && Date.now() < parseInt(blockedUntil)) {
                const minutes = Math.ceil((parseInt(blockedUntil) - Date.now()) / (1000 * 60));
                showNotification(`Acesso bloqueado. Tente novamente em ${minutes} minutos.`, "danger");
                return false;
            }
            
            const user = appState.users.find(u => 
                u.username === username && u.password === password && u.ativo
            );
            
            if (user) {
                if (user.bloqueado) {
                    showNotification(user.mensagem_acesso || "Usuário bloqueado. Entre em contato com o administrador.", "danger");
                    return false;
                }
                
                appState.currentUser = user;
                markAsLoggedIn();
                
                const session = {
                    username: user.username,
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
                };
                localStorage.setItem(LOGIN_SYSTEM_KEYS.SESSION, JSON.stringify(session));
                
                // Atualizar último acesso no JSON
                user.ultimo_acesso = new Date().toISOString();
                
                showMainApp();
                showNotification(user.mensagem_acesso || `Bem-vindo, ${user.nome}!`, "success");
                return true;
            }
            
            // Contar tentativas falhas
            let attempts = parseInt(localStorage.getItem(LOGIN_SYSTEM_KEYS.LOGIN_ATTEMPTS) || '0') + 1;
            localStorage.setItem(LOGIN_SYSTEM_KEYS.LOGIN_ATTEMPTS, attempts.toString());
            
            if (attempts >= 3) {
                const blockTime = Date.now() + (30 * 60 * 1000); // 30 minutos
                localStorage.setItem(LOGIN_SYSTEM_KEYS.BLOCKED_UNTIL, blockTime.toString());
                showNotification("Muitas tentativas falhas. Acesso bloqueado por 30 minutos.", "danger");
            } else {
                showNotification(`Usuário ou senha incorretos. Tentativas restantes: ${3 - attempts}`, "danger");
            }
            
            return false;
        }

        function logout() {
            appState.currentUser = null;
            localStorage.removeItem(LOGIN_SYSTEM_KEYS.SESSION);
            const today = new Date().toDateString();
            localStorage.setItem(LOGIN_SYSTEM_KEYS.LAST_LOGIN_DATE, today);
            localStorage.setItem(LOGIN_SYSTEM_KEYS.LOGIN_REQUIRED, 'true');
            showLogin();
            showNotification("Você saiu do sistema", "info");
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('usernameInput').value = '';
            document.getElementById('passwordInput').value = '';
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('togglePassword').innerHTML = '<i class="fas fa-eye"></i>';
            document.getElementById('passwordInput').type = 'password';
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            updateUIForHiddenValues();
        }

        // ============ INTERFACE ============
        function updateBusinessInfo() {
            document.documentElement.style.setProperty('--primary', appState.businessInfo.themeColor);
            
            const gradient = `linear-gradient(135deg, ${appState.businessInfo.themeColor} 0%, ${lightenColor(appState.businessInfo.themeColor, 30)} 100%)`;
            document.documentElement.style.setProperty('--primary-gradient', gradient);
            
            const logo = appState.businessInfo.logo || 'logo.jpeg';
            document.getElementById('businessLogo').src = logo;
            document.getElementById('businessAvatar').src = logo;
            document.getElementById('businessPhotoPreview').src = logo;
            
            document.getElementById('businessNameLogin').textContent = appState.businessInfo.name;
            document.getElementById('businessNameHeader').textContent = appState.businessInfo.name;
            document.getElementById('businessSlogan').textContent = appState.businessInfo.slogan;
            document.getElementById('businessNameInput').value = appState.businessInfo.name;
            document.getElementById('businessSloganInput').value = appState.businessInfo.slogan;
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.toggle('selected', option.dataset.color === appState.businessInfo.themeColor);
            });
            
            updateTheme();
            setupColorCustomizer();
        }

        function updateTheme() {
            if (appState.settings.darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.documentElement.removeAttribute('data-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        function toggleTheme() {
            appState.settings.darkMode = !appState.settings.darkMode;
            saveAppData();
            updateTheme();
            showNotification(appState.settings.darkMode ? "Modo escuro ativado" : "Modo claro ativado", "info");
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleBtn = document.getElementById('togglePassword');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = 'password';
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        function updateUIForHiddenValues() {
            const hideValues = appState.settings.hideValues;
            const valueElements = document.querySelectorAll('.summary-value, .finance-value, .goal-progress-value, .sale-total-value');
            
            valueElements.forEach(element => {
                if (hideValues) {
                    element.dataset.originalValue = element.textContent;
                    element.textContent = '••••••';
                    element.style.filter = 'blur(5px)';
                } else {
                    if (element.dataset.originalValue) {
                        element.textContent = element.dataset.originalValue;
                        delete element.dataset.originalValue;
                    }
                    element.style.filter = 'none';
                }
            });
            
            // Manter valores visíveis na área de vendas
            const saleElements = document.querySelectorAll('#sales .summary-value, #sales .finance-value, #sales .goal-progress-value, #sales .sale-total-value');
            saleElements.forEach(element => {
                if (element.dataset.originalValue) {
                    element.textContent = element.dataset.originalValue;
                    delete element.dataset.originalValue;
                }
                element.style.filter = 'none';
            });
        }

        // ============ SELETOR DE ÍCONES ============
        function setupIconSelector() {
            const iconSelector = document.getElementById('iconSelector');
            iconSelector.innerHTML = '';
            
            availableIcons.forEach(iconClass => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option';
                iconOption.innerHTML = `<i class="fas ${iconClass}"></i>`;
                iconOption.title = iconClass;
                iconOption.onclick = () => selectIcon(iconClass);
                iconSelector.appendChild(iconOption);
            });
            
            // Fechar seletor ao clicar fora
            document.addEventListener('click', (e) => {
                const iconSelector = document.getElementById('iconSelector');
                const productIconInput = document.getElementById('productIcon');
                
                if (!iconSelector.contains(e.target) && e.target !== productIconInput) {
                    iconSelector.classList.remove('active');
                }
            });
        }

        function showIconSelector() {
            const iconSelector = document.getElementById('iconSelector');
            iconSelector.classList.toggle('active');
        }

        function selectIcon(iconClass) {
            const productIconInput = document.getElementById('productIcon');
            const iconPreview = document.getElementById('iconPreview');
            const selectedIconPreview = document.getElementById('selectedIconPreview');
            const selectedIconName = document.getElementById('selectedIconName');
            
            productIconInput.value = iconClass;
            selectedIconPreview.className = `fas ${iconClass}`;
            selectedIconName.textContent = `Ícone selecionado: ${iconClass}`;
            iconPreview.style.display = 'flex';
            
            // Remover seleção anterior
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Marcar como selecionado
            const selectedOption = Array.from(document.querySelectorAll('.icon-option'))
                .find(option => option.querySelector('i').className.includes(iconClass));
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            // Fechar seletor
            document.getElementById('iconSelector').classList.remove('active');
            
            showNotification(`Ícone ${iconClass} selecionado`, "success");
        }

        // ============ PRODUTOS ============
        function loadProducts() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">Selecione um produto</option>';
            
            appState.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - R$ ${product.price.toFixed(2)}`;
                select.appendChild(option);
            });
            
            updateProductsGrid();
        }

        function updateProductsGrid() {
            const container = document.getElementById('productsList');
            container.innerHTML = '';
            
            if (appState.products.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-box-open fa-3x" style="color: var(--gray-400); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--gray-600); margin-bottom: 12px;">Nenhum produto cadastrado</h3>
                        <p style="color: var(--gray-500);">Adicione seus produtos para começar a vender</p>
                    </div>
                `;
                return;
            }
            
            appState.products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                // Usar o ícone personalizado ou o padrão por categoria
                const iconClass = product.icon ? `fas ${product.icon}` : `fas ${getProductIcon(product.category)}`;
                
                card.innerHTML = `
                    <div class="product-image">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                        <div class="product-stock ${product.stock <= product.minStock ? 'stock-low' : ''}">
                            Estoque: ${product.stock} ${product.stock <= product.minStock ? '⚠️' : ''}
                        </div>
                        <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">
                            Custo: R$ ${product.cost ? product.cost.toFixed(2) : '0.00'} | Mín: ${product.minStock}
                        </div>
                        <div class="product-actions">
                            <button onclick="editProduct(${product.id})" class="btn-small info">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button onclick="showDeleteItem('product', ${product.id})" class="btn-small danger">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function getProductIcon(category) {
            const icons = {
                'bebidas': 'fa-wine-bottle',
                'comidas': 'fa-hamburger',
                'sobremesas': 'fa-ice-cream',
                'acessorios': 'fa-umbrella-beach',
                'outros': 'fa-box'
            };
            return icons[category] || 'fa-box';
        }

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const icon = document.getElementById('productIcon').value.trim() || getProductIcon(category);
            const price = parseFloat(document.getElementById('productPrice').value);
            const cost = parseFloat(document.getElementById('productCost').value) || 0;
            const stock = parseInt(document.getElementById('productStock').value);
            const minStock = parseInt(document.getElementById('productMinStock').value);
            
            if (!name || !price || isNaN(stock)) {
                showNotification("Preencha todos os campos obrigatórios", "danger");
                return;
            }
            
            if (price <= 0) {
                showNotification("Preço inválido", "danger");
                return;
            }
            
            const editId = document.getElementById('addProductBtn').dataset.editId;
            
            if (editId) {
                const index = appState.products.findIndex(p => p.id === parseInt(editId));
                if (index !== -1) {
                    appState.products[index] = {
                        ...appState.products[index],
                        name, category, icon, price, cost, stock, minStock
                    };
                    showNotification("Produto atualizado com sucesso!", "success");
                }
            } else {
                const newProduct = {
                    id: Date.now(),
                    name, category, icon, price, cost, stock, minStock,
                    createdAt: new Date().toISOString()
                };
                appState.products.push(newProduct);
                showNotification("Produto adicionado com sucesso!", "success");
            }
            
            saveAppData();
            loadProducts();
            resetProductForm();
        }

        function editProduct(id) {
            const product = appState.products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productIcon').value = product.icon || '';
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productCost').value = product.cost || 0;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productMinStock').value = product.minStock;
            
            // Atualizar preview do ícone
            if (product.icon) {
                const iconPreview = document.getElementById('iconPreview');
                const selectedIconPreview = document.getElementById('selectedIconPreview');
                const selectedIconName = document.getElementById('selectedIconName');
                
                selectedIconPreview.className = `fas ${product.icon}`;
                selectedIconName.textContent = `Ícone selecionado: ${product.icon}`;
                iconPreview.style.display = 'flex';
                
                // Marcar ícone como selecionado no seletor
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.querySelector('i').className.includes(product.icon)) {
                        option.classList.add('selected');
                    }
                });
            }
            
            const btn = document.getElementById('addProductBtn');
            btn.innerHTML = '<i class="fas fa-save"></i> Salvar Alterações';
            btn.dataset.editId = id;
            document.getElementById('cancelEditBtn').style.display = 'flex';
            
            showNotification(`Editando: ${product.name}`, "info");
        }

        function resetProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = 'bebidas';
            document.getElementById('productIcon').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productCost').value = '';
            document.getElementById('productStock').value = '10';
            document.getElementById('productMinStock').value = '5';
            
            // Limpar preview do ícone
            document.getElementById('iconPreview').style.display = 'none';
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            const btn = document.getElementById('addProductBtn');
            btn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Produto';
            delete btn.dataset.editId;
            document.getElementById('cancelEditBtn').style.display = 'none';
        }

        // ============ VENDAS ============
        function addProductToSale() {
            const productId = parseInt(document.getElementById('productSelect').value);
            const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
            const price = parseFloat(document.getElementById('priceInput').value) || 0;
            
            if (!productId) {
                showNotification("Selecione um produto", "danger");
                return;
            }
            
            if (quantity <= 0) {
                showNotification("Quantidade inválida", "danger");
                return;
            }
            
            if (price <= 0) {
                showNotification("Preço inválido", "danger");
                return;
            }
            
            const product = appState.products.find(p => p.id === productId);
            if (!product) {
                showNotification("Produto não encontrado", "danger");
                return;
            }
            
            if (product.stock < quantity) {
                showNotification(`Estoque insuficiente. Disponível: ${product.stock}`, "danger");
                return;
            }
            
            const unitCost = product.cost || 0;
            const totalCost = unitCost * quantity;
            const subtotal = price * quantity;
            const profit = subtotal - totalCost;
            
            const saleProduct = {
                id: Date.now(),
                productId,
                name: product.name,
                quantity,
                price,
                unitCost,
                totalCost,
                subtotal,
                profit
            };
            
            currentSale.products.push(saleProduct);
            updateCurrentSale();
            updateSaleProductsDisplay();
            
            document.getElementById('quantityInput').value = '1';
            document.getElementById('priceInput').value = '';
            
            showNotification(`${product.name} adicionado à venda`, "success");
        }

        function removeProductFromSale(id) {
            currentSale.products = currentSale.products.filter(p => p.id !== id);
            updateCurrentSale();
            updateSaleProductsDisplay();
        }

        function updateCurrentSale() {
            currentSale.total = currentSale.products.reduce((sum, p) => sum + p.subtotal, 0);
            currentSale.cost = currentSale.products.reduce((sum, p) => sum + p.totalCost, 0);
            
            // Aplicar desconto
            let discountAmount = 0;
            if (currentSale.discount.type === 'percent') {
                discountAmount = (currentSale.total * currentSale.discount.value) / 100;
            } else if (currentSale.discount.type === 'fixed') {
                discountAmount = currentSale.discount.value;
            }
            
            const totalAfterDiscount = Math.max(0, currentSale.total - discountAmount);
            currentSale.grossProfit = totalAfterDiscount - currentSale.cost;
            
            document.getElementById('subtotalValue').textContent = `R$ ${currentSale.total.toFixed(2)}`;
            document.getElementById('discountValue').textContent = `R$ ${discountAmount.toFixed(2)}`;
            document.getElementById('totalCostValue').textContent = `R$ ${currentSale.cost.toFixed(2)}`;
            document.getElementById('grossProfitValue').textContent = `R$ ${currentSale.grossProfit.toFixed(2)}`;
            
            // Atualizar total da venda nos controles
            document.getElementById('totalSaleAmount').value = `R$ ${totalAfterDiscount.toFixed(2)}`;
            
            const summary = document.getElementById('saleTotalSummary');
            summary.style.display = currentSale.products.length > 0 ? 'block' : 'none';
            
            document.getElementById('registerSaleBtn').disabled = currentSale.products.length === 0;
            document.getElementById('productsCount').textContent = `${currentSale.products.length} produtos`;
            
            updatePaymentSummary();
            calculateChange();
            
        }

        function updateSaleProductsDisplay() {
            const container = document.getElementById('saleProductsList');
            
            if (currentSale.products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Nenhum produto adicionado à venda</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            currentSale.products.forEach(product => {
                const item = document.createElement('div');
                item.className = 'sale-product-item';
                item.innerHTML = `
                    <div class="sale-product-info">
                        <div class="sale-product-name">${product.name}</div>
                        <div class="sale-product-details">
                            ${product.quantity} × R$ ${product.price.toFixed(2)} = R$ ${product.subtotal.toFixed(2)}
                            <br>
                            <small>Custo: R$ ${product.unitCost.toFixed(2)} × ${product.quantity} = R$ ${product.totalCost.toFixed(2)}</small>
                        </div>
                    </div>
                    <div>
                        <span class="sale-product-total">R$ ${product.subtotal.toFixed(2)}</span>
                        <button onclick="removeProductFromSale(${product.id})" class="remove-product-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function setDiscount(type, value) {
            currentSale.discount = { type, value };
            updateCurrentSale();
            
            // Atualizar UI
            document.querySelectorAll('.discount-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            const options = document.querySelectorAll('.discount-option');
            if (type === 'percent') {
                options[value === 10 ? 0 : 1].classList.add('active');
            } else if (type === 'fixed') {
                options[value === 5 ? 2 : 3].classList.add('active');
            }
            
            document.getElementById('customDiscount').value = type === 'percent' ? `${value}%` : `R$ ${value.toFixed(2)}`;
            
            showNotification(`Desconto aplicado: ${type === 'percent' ? value + '%' : 'R$ ' + value.toFixed(2)}`, "info");
        }

        // ============ PAGAMENTO MISTO ============
        function addMixedPaymentMethod() {
            if (appState.paymentMethods.length === 0) {
                showNotification("Adicione formas de pagamento primeiro", "warning");
                return;
            }
            
            const id = nextPaymentId++;
            const defaultMethod = appState.paymentMethods[0];
            
            mixedPaymentMethods.push({
                id,
                methodId: defaultMethod.id,
                methodName: defaultMethod.name,
                methodType: defaultMethod.type,
                methodFee: defaultMethod.fee,
                amount: 0,
                isAutoCalculated: true
            });
            
            updateMixedPaymentDisplay();
        }

        function removeMixedPaymentMethod(id) {
            mixedPaymentMethods = mixedPaymentMethods.filter(item => item.id !== id);
            updateMixedPaymentDisplay();
        }

        function updateMixedPaymentMethod(id, methodId) {
            const item = mixedPaymentMethods.find(item => item.id === id);
            if (item) {
                const method = appState.paymentMethods.find(m => m.id === parseInt(methodId));
                if (method) {
                    item.methodId = method.id;
                    item.methodName = method.name;
                    item.methodType = method.type;
                    item.methodFee = method.fee;
                    updatePaymentSummary();
                }
            }
        }

        function updateMixedPaymentAmount(id, amount) {
            const item = mixedPaymentMethods.find(item => item.id === id);
            if (item) {
                item.amount = parseFloat(amount) || 0;
                item.isAutoCalculated = false;
                updatePaymentSummary();
            }
        }

        function updateMixedPaymentDisplay() {
            const container = document.getElementById('mixedPaymentContainer');
            container.innerHTML = '';
            
            if (mixedPaymentMethods.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-credit-card"></i>
                        <p>Adicione formas de pagamento</p>
                    </div>
                `;
                return;
            }
            
            mixedPaymentMethods.forEach(item => {
                const div = document.createElement('div');
                div.className = 'mixed-payment-item';
                const method = appState.paymentMethods.find(m => m.id === item.methodId);
                const icon = method?.icon || 'fa-credit-card';
                
                div.innerHTML = `
                    <div class="mixed-payment-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas ${icon}" style="color: var(--primary);"></i>
                            <select class="mixed-payment-select" onchange="updateMixedPaymentMethod(${item.id}, this.value)">
                                ${appState.paymentMethods.map(m => 
                                    `<option value="${m.id}">${m.name} ${m.fee > 0 ? `(${m.fee}%)` : ''}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <button onclick="removeMixedPaymentMethod(${item.id})" class="remove-payment-btn">
                            <i class="fas fa-times"></i> Remover
                        </button>
                    </div>
                    <div class="mixed-payment-amount">
                        <span>R$</span>
                        <input type="number" 
                               min="0" 
                               step="0.01" 
                               value="${item.amount.toFixed(2)}" 
                               onchange="updateMixedPaymentAmount(${item.id}, this.value)"
                               oninput="updateMixedPaymentAmount(${item.id}, this.value)"
                               placeholder="0.00">
                    </div>
                `;
                
                div.querySelector('.mixed-payment-select').value = item.methodId;
                container.appendChild(div);
            });
            
            updatePaymentSummary();
        }

        function updatePaymentSummary() {
            const totalSaleValue = Math.max(0, currentSale.total - (currentSale.discount.value || 0));
            let totalPaidValue = mixedPaymentMethods.reduce((sum, item) => sum + item.amount, 0);
            
            // Adicionar pagamento em dinheiro do controle
            const cashPaid = parseFloat(document.getElementById('cashPaidAmount').value) || 0;
            totalPaidValue += cashPaid;
            
            const remaining = totalSaleValue - totalPaidValue;
            
            document.getElementById('totalPaid').textContent = totalPaidValue.toFixed(2);
            
            const remainingElement = document.getElementById('remainingAmount');
            remainingElement.className = 'remaining-amount ';
            
            if (remaining > 0.01) {
                remainingElement.classList.add('remaining-positive');
                remainingElement.innerHTML = `Falta: R$ <span>${remaining.toFixed(2)}</span>`;
            } else if (remaining < -0.01) {
                remainingElement.classList.add('remaining-negative');
                remainingElement.innerHTML = `Troco: R$ <span>${Math.abs(remaining).toFixed(2)}</span>`;
            } else {
                remainingElement.classList.add('remaining-zero');
                remainingElement.innerHTML = `<i class="fas fa-check"></i> Valor quitado!`;
            }
        }

        function calculateChange() {
            const totalSaleValue = Math.max(0, currentSale.total - (currentSale.discount.value || 0));
            const cashPaid = parseFloat(document.getElementById('cashPaidAmount').value) || 0;
            const otherPayments = mixedPaymentMethods.reduce((sum, item) => sum + item.amount, 0);
            const remainingFromCash = totalSaleValue - otherPayments;
            
            let change = 0;
            if (cashPaid > 0 && remainingFromCash > 0) {
                change = cashPaid - remainingFromCash;
            }
            
            document.getElementById('changeAmount').value = `R$ ${Math.max(0, change).toFixed(2)}`;
            updatePaymentSummary();
        }

        function autoDistributePayment() {
            const totalSaleValue = Math.max(0, currentSale.total - (currentSale.discount.value || 0));
            
            if (mixedPaymentMethods.length === 0) {
                showNotification("Adicione formas de pagamento primeiro", "warning");
                return;
            }
            
            // Distribuir igualmente entre as formas de pagamento
            const amountPerMethod = totalSaleValue / mixedPaymentMethods.length;
            
            mixedPaymentMethods.forEach(item => {
                item.amount = amountPerMethod;
                item.isAutoCalculated = true;
            });
            
            updateMixedPaymentDisplay();
            showNotification(`Pagamento distribuído igualmente entre ${mixedPaymentMethods.length} formas`, "info");
        }

        // FUNÇÃO PRINCIPAL DE REGISTRAR VENDA - ATUALIZADA
        function registerSale() {
            if (currentSale.products.length === 0) {
                showNotification("Adicione produtos à venda", "danger");
                return;
            }
            
            const totalPaid = mixedPaymentMethods.reduce((sum, item) => sum + item.amount, 0) + 
                            (parseFloat(document.getElementById('cashPaidAmount').value) || 0);
            const totalSaleValue = Math.max(0, currentSale.total - (currentSale.discount.value || 0));
            const remaining = totalSaleValue - totalPaid;
            
            if (remaining > 0.01) {
                showNotification(`Falta R$ ${remaining.toFixed(2)} para completar o pagamento`, "warning");
                return;
            }
            
            const saleDate = new Date().toISOString();
            
            // Registrar cada produto como venda separada
            currentSale.products.forEach(saleProduct => {
                const product = appState.products.find(p => p.id === saleProduct.productId);
                if (product) {
                    product.stock -= saleProduct.quantity;
                    
                    if (product.stock <= product.minStock && appState.settings.stockNotifications) {
                        showNotification(`Estoque baixo: ${product.name} (${product.stock} unidades)`, "warning");
                    }
                }
                
                // Determinar método de pagamento principal
                let mainPaymentMethod = "Misto";
                if (mixedPaymentMethods.length > 0) {
                    const mainMethod = mixedPaymentMethods.reduce((prev, current) => 
                        (prev.amount > current.amount) ? prev : current
                    );
                    mainPaymentMethod = mainMethod.methodName;
                }
                
                const sale = {
                    id: Date.now() + Math.random(),
                    productId: saleProduct.productId,
                    productName: saleProduct.name,
                    quantity: saleProduct.quantity,
                    price: saleProduct.price,
                    total: saleProduct.subtotal,
                    unitCost: saleProduct.unitCost,
                    totalCost: saleProduct.totalCost,
                    profit: saleProduct.profit,
                    discount: currentSale.discount.value || 0,
                    discountType: currentSale.discount.type || null,
                    paymentMethod: mainPaymentMethod,
                    paymentDetails: mixedPaymentMethods.map(p => ({
                        method: p.methodName,
                        amount: p.amount
                    })),
                    cashPaid: parseFloat(document.getElementById('cashPaidAmount').value) || 0,
                    change: parseFloat(document.getElementById('changeAmount').value.replace('R$ ', '')) || 0,
                    date: saleDate,
                    isMixedPayment: true
                };
                
                appState.sales.push(sale);
            });
            
            // Atualizar formas de pagamento
            mixedPaymentMethods.forEach(item => {
                if (item.amount > 0) {
                    const method = appState.paymentMethods.find(p => p.id === item.methodId);
                    if (method) {
                        method.total += item.amount;
                    }
                }
            });
            
            // Atualizar pagamento em dinheiro
            const cashPaid = parseFloat(document.getElementById('cashPaidAmount').value) || 0;
            if (cashPaid > 0) {
                const cashMethod = appState.paymentMethods.find(p => p.type === 'cash');
                if (cashMethod) {
                    cashMethod.total += cashPaid;
                }
            }
            
            saveAppData();
            
            // Efeitos
            if (appState.settings.animations) {
                playSaleAnimation();
            }
            
            if (appState.settings.saleSounds) {
                playSaleSound();
            }
            
            // Atualizar interface
            loadProducts();
            updateDashboard();
            updateGoalDisplay();
            updateRecentSales();
            updateHistory();
            updateFinancialDashboard();
            
            showNotification("Venda registrada com sucesso!", "success");
            
            // LIMPAR TODOS OS CAMPOS APÓS A VENDA - AGORA AUTOMÁTICO
            clearAllFieldsAfterSale();
        }

        function clearCurrentSale() {
            currentSale = {
                products: [],
                total: 0,
                cost: 0,
                grossProfit: 0,
                discount: { type: null, value: 0 }
            };
            
            mixedPaymentMethods = [];
            nextPaymentId = 1;
            
            updateSaleProductsDisplay();
            updateCurrentSale();
            updateMixedPaymentDisplay();
            
            document.getElementById('productSelect').value = '';
            document.getElementById('quantityInput').value = '1';
            document.getElementById('priceInput').value = '';
            document.getElementById('customDiscount').value = '';
            document.getElementById('cashPaidAmount').value = '';
            document.getElementById('changeAmount').value = 'R$ 0,00';
            document.getElementById('totalSaleAmount').value = 'R$ 0,00';
            
            document.querySelectorAll('.discount-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            showNotification("Venda limpa", "info");
        }

        // FUNÇÃO MELHORADA: Limpar todos os campos após venda
        function clearAllFieldsAfterSale() {
            // Limpar produtos da venda
            currentSale = {
                products: [],
                total: 0,
                cost: 0,
                grossProfit: 0,
                discount: { type: null, value: 0 }
            };
            
            // Limpar formas de pagamento misto
            mixedPaymentMethods = [];
            nextPaymentId = 1;
            
            // Limpar todos os campos de entrada
            document.getElementById('productSelect').value = '';
            document.getElementById('quantityInput').value = '1';
            document.getElementById('priceInput').value = '';
            document.getElementById('customDiscount').value = '';
            document.getElementById('cashPaidAmount').value = '';
            document.getElementById('changeAmount').value = 'R$ 0,00';
            document.getElementById('totalSaleAmount').value = 'R$ 0,00';
            
            // Limpar seleção de desconto
            document.querySelectorAll('.discount-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Atualizar displays
            updateSaleProductsDisplay();
            updateCurrentSale();
            updateMixedPaymentDisplay();
            
            // Focar no primeiro campo para próxima venda
            document.getElementById('productSelect').focus();
        }

        // ============ DASHBOARD ============
        function updateDashboard() {
            const filter = appState.settings.currentFilter;
            let filteredSales = appState.sales;
            
            if (filter !== 'all') {
                const now = new Date();
                filteredSales = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    
                    switch(filter) {
                        case 'today':
                            return saleDate.toDateString() === now.toDateString();
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return saleDate >= weekAgo;
                        case 'month':
                            return saleDate.getMonth() === now.getMonth() && 
                                   saleDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            const totalSales = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalProducts = filteredSales.reduce((sum, sale) => sum + sale.quantity, 0);
            
            // Calcular lucro real
            let totalProfit = 0;
            filteredSales.forEach(sale => {
                totalProfit += sale.profit || 0;
            });
            
            // Subtrair custos do período
            const filteredCosts = getFilteredCosts(filter);
            const totalCosts = filteredCosts.reduce((sum, cost) => sum + cost.value, 0);
            
            const netProfit = totalProfit - totalCosts;
            
            document.getElementById('totalSalesValue').textContent = `R$ ${totalSales.toFixed(2)}`;
            document.getElementById('totalProductsSold').textContent = totalProducts.toString();
            document.getElementById('grossRevenue').textContent = `R$ ${totalSales.toFixed(2)}`;
            document.getElementById('netRevenue').textContent = `R$ ${netProfit.toFixed(2)}`;
            
            updateSalesChart(filteredSales);
            updatePaymentMethodsChart();
        }

        function getFilteredCosts(filter) {
            const now = new Date();
            return appState.costs.filter(cost => {
                const costDate = new Date(cost.date);
                
                switch(filter) {
                    case 'today':
                        return costDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return costDate >= weekAgo;
                    case 'month':
                        return costDate.getMonth() === now.getMonth() && 
                               costDate.getFullYear() === now.getFullYear();
                    default:
                        return true;
                }
            });
        }

        // ============ GRÁFICOS ============
        function setupCharts() {
            console.log("Inicializando gráficos...");
            
            // Gráfico de vendas
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                salesChart = new Chart(salesCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Vendas (R$)',
                            data: [],
                            borderColor: appState.businessInfo.themeColor,
                            backgroundColor: `${appState.businessInfo.themeColor}20`,
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: ctx => `R$ ${ctx.raw.toFixed(2)}`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => `R$ ${value}`
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de métodos de pagamento
            const paymentCtx = document.getElementById('paymentMethodsChart');
            if (paymentCtx) {
                paymentMethodsChart = new Chart(paymentCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#FF6B35', '#4ECDC4', '#00C851', '#FF4444', '#FFBB33',
                                '#33B5E5', '#9C27B0', '#795548', '#607D8B'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right' }
                        }
                    }
                });
            }
            
            // Gráfico de progresso de metas
            const goalCtx = document.getElementById('goalProgressChart');
            if (goalCtx) {
                goalProgressChart = new Chart(goalCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Lucro Real',
                            data: [],
                            backgroundColor: appState.businessInfo.themeColor,
                            borderColor: appState.businessInfo.themeColor,
                            borderWidth: 2
                        }, {
                            label: 'Meta',
                            data: [],
                            backgroundColor: '#4ECDC4',
                            borderColor: '#4ECDC4',
                            borderWidth: 2,
                            type: 'line',
                            fill: false,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => `R$ ${value}`
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico do histórico
            const historyCtx = document.getElementById('historyChart');
            if (historyCtx) {
                historyChart = new Chart(historyCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Vendas por Dia',
                            data: [],
                            backgroundColor: appState.businessInfo.themeColor,
                            borderColor: appState.businessInfo.themeColor,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => `R$ ${value}`
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de custos
            const costsCtx = document.getElementById('costsChart');
            if (costsCtx) {
                costsChart = new Chart(costsCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#FF6B35', '#4ECDC4', '#00C851', '#FF4444', '#FFBB33',
                                '#33B5E5', '#9C27B0', '#795548', '#607D8B', '#FF4081'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Gráfico financeiro
            const financialCtx = document.getElementById('financialChart');
            if (financialCtx) {
                financialChart = new Chart(financialCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Faturamento',
                                data: [],
                                backgroundColor: '#4ECDC4',
                                borderColor: '#4ECDC4',
                                borderWidth: 2
                            },
                            {
                                label: 'Custos',
                                data: [],
                                backgroundColor: '#FF4444',
                                borderColor: '#FF4444',
                                borderWidth: 2
                            },
                            {
                                label: 'Lucro',
                                data: [],
                                backgroundColor: '#00C851',
                                borderColor: '#00C851',
                                borderWidth: 2,
                                type: 'line',
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => `R$ ${value}`
                                }
                            }
                        }
                    }
                });
            }
            
            // Gráfico de composição de custos
            const compositionCtx = document.getElementById('costCompositionChart');
            if (compositionCtx) {
                costCompositionChart = new Chart(compositionCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#FF6B35', '#4ECDC4', '#00C851', '#FF4444', '#FFBB33',
                                '#33B5E5', '#9C27B0', '#795548', '#607D8B', '#FF4081'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Gráfico de projeção
            const forecastCtx = document.getElementById('forecastChart');
            if (forecastCtx) {
                forecastChart = new Chart(forecastCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Projeção de Faturamento',
                                data: [],
                                borderColor: '#4ECDC4',
                                backgroundColor: '#4ECDC420',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Projeção de Lucro',
                                data: [],
                                borderColor: '#00C851',
                                backgroundColor: '#00C85120',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: value => `R$ ${value}`
                                }
                            }
                        }
                    }
                });
            }
            
            // Atualizar todos os gráficos
            updateAllCharts();
        }

        function updateAllCharts() {
            if (salesChart) updateSalesChart(appState.sales);
            if (paymentMethodsChart) updatePaymentMethodsChart();
            if (goalProgressChart) updateGoalProgressChart();
            if (historyChart) updateHistoryChart();
            if (costsChart) updateCostsChart();
            if (financialChart) updateFinancialChart();
            if (costCompositionChart) updateCostCompositionChart();
            if (forecastChart) updateForecastChart();
        }

        function updateSalesChart(filteredSales) {
            if (!salesChart) {
                console.error("Gráfico de vendas não inicializado");
                return;
            }
            
            try {
                // Agrupar vendas por dia
                const salesByDay = {};
                const now = new Date();
                let daysToShow = 7;
                
                if (appState.settings.currentFilter === 'month') {
                    daysToShow = 30;
                } else if (appState.settings.currentFilter === 'all') {
                    daysToShow = Math.min(30, filteredSales.length > 0 ? 
                        Math.ceil((now - new Date(filteredSales[filteredSales.length - 1].date)) / (1000 * 60 * 60 * 24)) : 30);
                }
                
                // Criar labels para os últimos dias
                const labels = [];
                for (let i = daysToShow - 1; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(now.getDate() - i);
                    labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                    salesByDay[labels[labels.length - 1]] = 0;
                }
                
                // Somar vendas por dia
                filteredSales.forEach(sale => {
                    const saleDate = new Date(sale.date);
                    const dateKey = saleDate.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                    if (salesByDay[dateKey] !== undefined) {
                        salesByDay[dateKey] += sale.total;
                    }
                });
                
                const data = labels.map(label => salesByDay[label] || 0);
                
                // Atualizar gráfico
                salesChart.data.labels = labels;
                salesChart.data.datasets[0].data = data;
                salesChart.update();
                
            } catch (error) {
                console.error("Erro ao atualizar gráfico de vendas:", error);
            }
        }

        function updatePaymentMethodsChart() {
            if (!paymentMethodsChart) return;
            
            const methods = {};
            appState.sales.forEach(sale => {
                const method = sale.paymentMethod || 'Desconhecido';
                if (!methods[method]) methods[method] = 0;
                methods[method] += sale.total;
            });
            
            const labels = Object.keys(methods);
            const data = Object.values(methods);
            
            if (labels.length === 0) {
                labels.push('Sem dados');
                data.push(1);
            }
            
            paymentMethodsChart.data.labels = labels;
            paymentMethodsChart.data.datasets[0].data = data;
            paymentMethodsChart.update();
        }

        function updateCostsChart() {
            if (!costsChart) return;
            
            const costsByCategory = {};
            appState.costs.forEach(cost => {
                const category = getCostCategoryName(cost.category);
                if (!costsByCategory[category]) costsByCategory[category] = 0;
                costsByCategory[category] += cost.value;
            });
            
            const labels = Object.keys(costsByCategory);
            const data = Object.values(costsByCategory);
            
            if (labels.length === 0) {
                labels.push('Sem custos');
                data.push(1);
            }
            
            costsChart.data.labels = labels;
            costsChart.data.datasets[0].data = data;
            costsChart.update();
        }

        function updateFinancialChart() {
            if (!financialChart) return;
            
            // Agrupar por mês
            const monthlyData = {};
            const now = new Date();
            
            // Últimos 6 meses
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthKey = date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                monthlyData[monthKey] = { revenue: 0, costs: 0, profit: 0 };
            }
            
            // Calcular receita por mês
            appState.sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const monthKey = saleDate.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey].revenue += sale.total;
                    monthlyData[monthKey].profit += sale.profit || 0;
                }
            });
            
            // Calcular custos por mês
            appState.costs.forEach(cost => {
                const costDate = new Date(cost.date);
                const monthKey = costDate.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey].costs += cost.value;
                    monthlyData[monthKey].profit -= cost.value;
                }
            });
            
            const labels = Object.keys(monthlyData);
            const revenueData = Object.values(monthlyData).map(d => d.revenue);
            const costsData = Object.values(monthlyData).map(d => d.costs);
            const profitData = Object.values(monthlyData).map(d => d.profit);
            
            financialChart.data.labels = labels;
            financialChart.data.datasets[0].data = revenueData;
            financialChart.data.datasets[1].data = costsData;
            financialChart.data.datasets[2].data = profitData;
            financialChart.update();
            
            // Salvar dados para uso futuro
            appState.financialData.monthlyData = Object.keys(monthlyData).map(key => ({
                month: key,
                ...monthlyData[key]
            }));
            saveAppData();
        }

        function updateCostCompositionChart() {
            if (!costCompositionChart) return;
            
            const costsByCategory = {};
            let totalCosts = 0;
            
            appState.costs.forEach(cost => {
                const category = getCostCategoryName(cost.category);
                if (!costsByCategory[category]) costsByCategory[category] = 0;
                costsByCategory[category] += cost.value;
                totalCosts += cost.value;
            });
            
            // Filtrar apenas categorias com mais de 5% do total
            const significantCategories = {};
            Object.keys(costsByCategory).forEach(category => {
                const percentage = (costsByCategory[category] / totalCosts) * 100;
                if (percentage >= 5 || totalCosts === 0) {
                    significantCategories[category] = costsByCategory[category];
                }
            });
            
            // Agrupar o restante como "Outros"
            let othersTotal = 0;
            Object.keys(costsByCategory).forEach(category => {
                const percentage = (costsByCategory[category] / totalCosts) * 100;
                if (percentage < 5 && totalCosts > 0) {
                    othersTotal += costsByCategory[category];
                }
            });
            
            if (othersTotal > 0) {
                significantCategories['Outros'] = othersTotal;
            }
            
            const labels = Object.keys(significantCategories);
            const data = Object.values(significantCategories);
            
            if (labels.length === 0) {
                labels.push('Sem custos');
                data.push(1);
            }
            
            costCompositionChart.data.labels = labels;
            costCompositionChart.data.datasets[0].data = data;
            costCompositionChart.update();
        }

        function updateForecastChart() {
            if (!forecastChart) return;
            
            // Calcular média diária dos últimos 30 dias
            const last30Days = getLastNDays(30);
            const dailyAverage = last30Days.reduce((sum, day) => sum + day.profit, 0) / 30;
            
            // Projeção para os próximos 30 dias
            const labels = [];
            const revenueProjection = [];
            const profitProjection = [];
            
            const today = new Date();
            for (let i = 1; i <= 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                
                // Projeção baseada na média com pequena variação aleatória
                const variance = 0.8 + Math.random() * 0.4; // 0.8 a 1.2
                const projectedRevenue = dailyAverage * 1.5 * variance;
                const projectedProfit = dailyAverage * variance;
                
                revenueProjection.push(Math.max(0, projectedRevenue));
                profitProjection.push(Math.max(0, projectedProfit));
            }
            
            forecastChart.data.labels = labels;
            forecastChart.data.datasets[0].data = revenueProjection;
            forecastChart.data.datasets[1].data = profitProjection;
            forecastChart.update();
            
            // Salvar projeções
            appState.financialData.projections = labels.map((label, index) => ({
                date: label,
                revenue: revenueProjection[index],
                profit: profitProjection[index]
            }));
            saveAppData();
        }

        // ============ METAS ============
        function updateGoalDisplay() {
            const todayProfit = calculateTodayProfit();
            document.getElementById('todayProfitValue').textContent = `R$ ${todayProfit.toFixed(2)}`;
            document.getElementById('currentDailyGoal').textContent = `R$ ${goalState.dailyGoal.toFixed(2)}`;
            document.getElementById('dailyGoalValue').textContent = `R$ ${goalState.dailyGoal.toFixed(2)}`;
            
            let progress = 0;
            let remaining = goalState.dailyGoal;
            
            if (goalState.dailyGoal > 0) {
                progress = Math.min((todayProfit / goalState.dailyGoal) * 100, 100);
                remaining = Math.max(goalState.dailyGoal - todayProfit, 0);
            }
            
            document.getElementById('remainingGoalValue').textContent = `R$ ${remaining.toFixed(2)}`;
            document.getElementById('todayProgressText').textContent = `${progress.toFixed(1)}% da meta`;
            document.getElementById('circularProgressText').textContent = `${progress.toFixed(0)}%`;
            
            document.getElementById('todayProgressFill').style.width = `${progress}%`;
            
            const circumference = 2 * Math.PI * 15.9155;
            const offset = circumference - (progress / 100) * circumference;
            document.getElementById('circularProgress').style.strokeDashoffset = offset;
            
            updateGoalRecommendation(todayProfit, progress);
            updateGoalMetrics();
            updateGoalHistory();
            updateGoalProgressChart();
        }

        function calculateTodayProfit() {
            const today = new Date().toISOString().split('T')[0];
            let profit = 0;
            
            appState.sales.forEach(sale => {
                const saleDate = new Date(sale.date).toISOString().split('T')[0];
                if (saleDate === today) {
                    profit += sale.profit || 0;
                }
            });
            
            // Subtrair custos de hoje
            appState.costs.forEach(cost => {
                const costDate = new Date(cost.date).toISOString().split('T')[0];
                if (costDate === today) {
                    profit -= cost.value;
                }
            });
            
            return profit;
        }

        function updateGoalRecommendation(todayProfit, progress) {
            const text = document.getElementById('recommendationText');
            let recommendation = '';
            
            if (goalState.dailyGoal === 0) {
                recommendation = 'Defina sua meta diária para começar!';
            } else if (progress >= 100) {
                recommendation = '🎉 Parabéns! Meta atingida! Considere aumentar sua meta.';
            } else if (progress >= 75) {
                recommendation = 'Ótimo trabalho! Continue assim para atingir a meta!';
            } else if (progress >= 50) {
                recommendation = 'Bom progresso! Metade do caminho percorrido!';
            } else if (progress >= 25) {
                recommendation = 'Você está no caminho certo! Mantenha o foco.';
            } else if (todayProfit > 0) {
                recommendation = 'Começou bem! Aumente o ritmo para atingir a meta.';
            } else {
                recommendation = 'Hora de começar! Venda seu primeiro produto!';
            }
            
            text.textContent = recommendation;
        }

        function updateGoalMetrics() {
            // Média semanal
            const last7Days = getLastNDays(7);
            const weeklyAverage = last7Days.reduce((sum, day) => sum + day.profit, 0) / 7;
            document.getElementById('weeklyAverage').textContent = `R$ ${weeklyAverage.toFixed(2)}`;
            
            // Dias atingidos vs total
            const achievedDays = goalState.goalHistory.filter(day => day.profit >= day.goal && day.goal > 0).length;
            const totalDays = goalState.goalHistory.filter(day => day.goal > 0).length;
            document.getElementById('daysAchieved').textContent = `${achievedDays}/${totalDays}`;
            
            // Taxa de sucesso
            const successRate = totalDays > 0 ? (achievedDays / totalDays) * 100 : 0;
            document.getElementById('successRate').textContent = `${successRate.toFixed(0)}%`;
        }

        function updateGoalHistory() {
            const container = document.getElementById('goalHistoryList');
            container.innerHTML = '';
            
            // Últimos 30 dias
            const last30Days = getLastNDays(30);
            
            last30Days.forEach(day => {
                const goalEntry = goalState.goalHistory.find(g => g.date === day.date);
                const goal = goalEntry ? goalEntry.goal : 0;
                const profit = day.profit;
                const progress = goal > 0 ? (profit / goal) * 100 : 0;
                const status = goal > 0 ? (profit >= goal ? 'Atingida' : 'Não Atingida') : 'Sem Meta';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(day.date).toLocaleDateString('pt-BR')}</td>
                    <td>R$ ${goal.toFixed(2)}</td>
                    <td>R$ ${profit.toFixed(2)}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 60px; height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.min(progress, 100)}%; height: 100%; background: ${progress >= 100 ? 'var(--success)' : 'var(--primary)'};"></div>
                            </div>
                            <span>${progress.toFixed(0)}%</span>
                        </div>
                    </td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; background: ${status === 'Atingida' ? 'var(--success)' : status === 'Não Atingida' ? 'var(--danger)' : 'var(--gray-300)'}; color: white;">
                            ${status}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <button onclick="editGoal('${day.date}')" class="btn-small info">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function updateGoalProgressChart() {
            if (!goalProgressChart) return;
            
            // Últimos 7 dias
            const last7Days = getLastNDays(7).reverse();
            const labels = last7Days.map(day => new Date(day.date).toLocaleDateString('pt-BR', { weekday: 'short' }));
            const profitData = last7Days.map(day => day.profit);
            const goalData = last7Days.map(day => {
                const goalEntry = goalState.goalHistory.find(g => g.date === day.date);
                return goalEntry ? goalEntry.goal : 0;
            });
            
            goalProgressChart.data.labels = labels;
            goalProgressChart.data.datasets[0].data = profitData;
            goalProgressChart.data.datasets[1].data = goalData;
            goalProgressChart.update();
        }

        function getLastNDays(n) {
            const days = [];
            const today = new Date();
            
            for (let i = 0; i < n; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                let profit = 0;
                appState.sales.forEach(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    if (saleDate === dateStr) {
                        profit += sale.profit || 0;
                    }
                });
                
                appState.costs.forEach(cost => {
                    const costDate = new Date(cost.date).toISOString().split('T')[0];
                    if (costDate === dateStr) {
                        profit -= cost.value;
                    }
                });
                
                days.push({ date: dateStr, profit });
            }
            
            return days;
        }

        function setDailyGoal() {
            const input = document.getElementById('newDailyGoal');
            const value = parseFloat(input.value);
            
            if (!value || value <= 0) {
                showNotification("Digite um valor válido", "danger");
                return;
            }
            
            goalState.dailyGoal = value;
            saveGoalData();
            updateGoalDisplay();
            
            input.value = '';
            showNotification(`Meta definida em R$ ${value.toFixed(2)}`, "success");
            
            // Adicionar ao histórico
            const today = new Date().toISOString().split('T')[0];
            const todayProfit = calculateTodayProfit();
            
            const existingIndex = goalState.goalHistory.findIndex(d => d.date === today);
            if (existingIndex !== -1) {
                goalState.goalHistory[existingIndex].goal = value;
                goalState.goalHistory[existingIndex].profit = todayProfit;
            } else {
                goalState.goalHistory.unshift({
                    date: today,
                    profit: todayProfit,
                    goal: value
                });
            }
            
            goalState.goalHistory = goalState.goalHistory.slice(0, 90);
            saveGoalData();
        }

        function showGoalModal() {
            document.getElementById('modalDailyGoal').value = goalState.dailyGoal;
            document.getElementById('goalDescription').value = '';
            document.getElementById('goalPeriod').value = 'daily';
            document.getElementById('goalStartDate').value = new Date().toISOString().split('T')[0];
            
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + 30);
            document.getElementById('goalEndDate').value = endDate.toISOString().split('T')[0];
            
            document.getElementById('goalModal').classList.add('show');
        }

        function hideGoalModal() {
            document.getElementById('goalModal').classList.remove('show');
        }

        function saveDailyGoal() {
            const value = parseFloat(document.getElementById('modalDailyGoal').value);
            const description = document.getElementById('goalDescription').value.trim();
            const period = document.getElementById('goalPeriod').value;
            const startDate = document.getElementById('goalStartDate').value;
            const endDate = document.getElementById('goalEndDate').value;
            
            if (!value || value <= 0) {
                showNotification("Digite um valor válido", "danger");
                return;
            }
            
            goalState.dailyGoal = value;
            
            // Salvar configuração avançada
            const goalConfig = {
                id: Date.now(),
                value,
                description,
                period,
                startDate,
                endDate,
                createdAt: new Date().toISOString(),
                active: true
            };
            
            goalState.configs.unshift(goalConfig);
            saveGoalData();
            hideGoalModal();
            showNotification(`Meta "${description || 'diária'}" salva com sucesso!`, "success");
            updateGoalDisplay();       
            
            
        }

        function exportGoalReport() {
            if (goalState.goalHistory.length === 0) {
                showNotification("Nenhum histórico de metas para exportar", "warning");
                return;
            }
            
            let csv = 'Data,Meta (R$),Lucro (R$),Progresso (%),Status\n';
            
            goalState.goalHistory.forEach(day => {
                const progress = day.goal > 0 ? (day.profit / day.goal) * 100 : 0;
                const status = day.goal > 0 ? (day.profit >= day.goal ? 'Atingida' : 'Não Atingida') : 'Sem Meta';
                csv += `"${new Date(day.date).toLocaleDateString('pt-BR')}",${day.goal},${day.profit},${progress.toFixed(2)},"${status}"\n`;
            });
            
            downloadFile(csv, `relatorio-metas-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showNotification("Relatório de metas exportado com sucesso!", "success");
        }

        // ============ HISTÓRICO COM PAGINAÇÃO ============
        function updateRecentSales() {
            const container = document.getElementById('recentSalesList');
            const today = new Date().toISOString().split('T')[0];
            
            const todaySales = appState.sales.filter(sale => {
                const saleDate = new Date(sale.date).toISOString().split('T')[0];
                return saleDate === today;
            }).slice(0, 10);
            
            document.getElementById('todaySalesCount').textContent = `${todaySales.length} vendas`;
            
            if (todaySales.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>Nenhuma venda hoje</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            todaySales.forEach(sale => {
                const item = document.createElement('div');
                item.className = 'sale-product-item';
                item.innerHTML = `
                    <div>
                        <div style="font-weight: 700;">${sale.productName}</div>
                        <div style="font-size: 14px; color: var(--gray-600);">
                            ${sale.quantity} × R$ ${sale.price.toFixed(2)}
                            | ${new Date(sale.date).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 800; color: var(--success);">R$ ${sale.total.toFixed(2)}</div>
                        <div style="font-size: 13px; color: var(--gray-600);">
                            Lucro: R$ ${sale.profit.toFixed(2)}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateHistory() {
            // Aplicar filtros
            filterHistory();
            
            // Calcular paginação
            const totalPages = Math.ceil(filteredHistory.length / HISTORY_ITEMS_PER_PAGE);
            const startIndex = (historyPage - 1) * HISTORY_ITEMS_PER_PAGE;
            const endIndex = startIndex + HISTORY_ITEMS_PER_PAGE;
            const pageSales = filteredHistory.slice(startIndex, endIndex);
            
            const container = document.getElementById('historyList');
            container.innerHTML = '';
            
            if (pageSales.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <i class="fas fa-history fa-2x" style="color: var(--gray-400); margin-bottom: 16px; display: block;"></i>
                            <p style="color: var(--gray-600);">Nenhuma venda encontrada</p>
                        </td>
                    </tr>
                `;
                
                // Esconder paginação se não houver itens
                document.getElementById('historyPagination').style.display = 'none';
                return;
            }
            
            pageSales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(sale.date).toLocaleDateString('pt-BR')} ${new Date(sale.date).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</td>
                    <td>${sale.productName}</td>
                    <td>${sale.quantity}</td>
                    <td>R$ ${sale.total.toFixed(2)}</td>
                    <td>${sale.paymentMethod}</td>
                    <td>R$ ${sale.profit.toFixed(2)}</td>
                    <td class="actions-cell">
                        <button onclick="editSale('${sale.id}')" class="btn-small info">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="showDeleteItem('sale', '${sale.id}')" class="btn-small danger">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="exportReceipt('${sale.id}')" class="btn-small secondary">
                            <i class="fas fa-receipt"></i>
                        </button>
                    </td>
                `;
                container.appendChild(row);
            });
            
            // Atualizar paginação
            updateHistoryPagination(totalPages);
            updateHistoryChart();
        }

        function filterHistory() {
            const filterDate = document.getElementById('filterDate').value;
            const filterProduct = document.getElementById('filterProduct').value.toLowerCase();
            const filterPayment = document.getElementById('filterPayment').value;
            
            filteredHistory = [...appState.sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filterDate) {
                filteredHistory = filteredHistory.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === filterDate;
                });
            }
            
            if (filterProduct) {
                filteredHistory = filteredHistory.filter(sale => 
                    sale.productName.toLowerCase().includes(filterProduct)
                );
            }
            
            if (filterPayment) {
                filteredHistory = filteredHistory.filter(sale => 
                    sale.paymentMethod === filterPayment
                );
            }
            
            historyPage = 1; // Resetar para primeira página ao filtrar
        }

        function updateHistoryPagination(totalPages) {
            const pagination = document.getElementById('historyPagination');
            const pageInfo = document.getElementById('historyPageInfo');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            pageInfo.textContent = `Página ${historyPage} de ${totalPages}`;
        }

        function changeHistoryPage(direction) {
            const totalPages = Math.ceil(filteredHistory.length / HISTORY_ITEMS_PER_PAGE);
            
            if (direction === 'prev' && historyPage > 1) {
                historyPage--;
            } else if (direction === 'next' && historyPage < totalPages) {
                historyPage++;
            }
            
            updateHistory();
        }

        // NOVA FUNÇÃO: Limpar histórico
        function clearHistory() {
            if (appState.sales.length === 0) {
                showNotification("Não há histórico para limpar", "warning");
                return;
            }
            
            if (confirm("Tem certeza que deseja limpar todo o histórico de vendas? Esta ação não pode ser desfeita.")) {
                appState.sales = [];
                saveAppData();
                updateHistory();
                updateDashboard();
                updateGoalDisplay();
                updateRecentSales();
                updateFinancialDashboard();
                
                showNotification("Histórico limpo com sucesso!", "success");
            }
        }

        function updateHistoryChart() {
            if (!historyChart) return;
            
            // Agrupar por dia
            const salesByDay = {};
            appState.sales.forEach(sale => {
                const date = new Date(sale.date).toLocaleDateString('pt-BR');
                if (!salesByDay[date]) salesByDay[date] = 0;
                salesByDay[date] += sale.total;
            });
            
            // Últimos 7 dias
            const last7Days = getLastNDays(7).reverse();
            const labels = last7Days.map(day => new Date(day.date).toLocaleDateString('pt-BR', { weekday: 'short' }));
            const data = last7Days.map(day => {
                const dateStr = new Date(day.date).toLocaleDateString('pt-BR');
                return salesByDay[dateStr] || 0;
            });
            
            historyChart.data.labels = labels;
            historyChart.data.datasets[0].data = data;
            historyChart.update();
        }

        function exportHistory() {
            if (appState.sales.length === 0) {
                showNotification("Nenhuma venda para exportar", "warning");
                return;
            }
            
            let csv = 'Data,Hora,Produto,Quantidade,Preço Unitário,Total,Forma de Pagamento,Lucro,Desconto\n';
            
            appState.sales.forEach(sale => {
                const date = new Date(sale.date);
                csv += `"${date.toLocaleDateString('pt-BR')}","${date.toLocaleTimeString('pt-BR')}","${sale.productName}",${sale.quantity},${sale.price},${sale.total},"${sale.paymentMethod}",${sale.profit},${sale.discount || 0}\n`;
            });
            
            downloadFile(csv, `vendas-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showNotification("Histórico exportado com sucesso!", "success");
        }

        function exportReceipt(saleId) {
            const sale = appState.sales.find(s => s.id == saleId);
            if (!sale) return;
            
            const receipt = `
                =================================
                       RECIBO DE VENDA
                =================================
                Data: ${new Date(sale.date).toLocaleDateString('pt-BR')}
                Hora: ${new Date(sale.date).toLocaleTimeString('pt-BR')}
                
                Produto: ${sale.productName}
                Quantidade: ${sale.quantity}
                Preço Unitário: R$ ${sale.price.toFixed(2)}
                Total: R$ ${sale.total.toFixed(2)}
                
                Forma de Pagamento: ${sale.paymentMethod}
                Desconto: R$ ${(sale.discount || 0).toFixed(2)}
                Lucro: R$ ${sale.profit.toFixed(2)}
                
                =================================
                      PraiaVendas Pro
                =================================
            `;
            
            downloadFile(receipt, `recibo-${saleId}.txt`, 'text/plain');
            showNotification("Recibo exportado com sucesso!", "success");
        }

        // ============ PAGAMENTOS ============
        function loadPaymentMethods() {
            const container = document.getElementById('paymentMethodsList');
            const filterSelect = document.getElementById('filterPayment');
            
            container.innerHTML = '';
            filterSelect.innerHTML = '<option value="">Todos os pagamentos</option>';
            
            appState.paymentMethods.forEach(method => {
                // Lista principal
                const row = document.createElement('tr');
                const icon = method.icon || 'fa-credit-card';
                row.innerHTML = `
                    <td><i class="fas ${icon}" style="color: var(--primary);"></i></td>
                    <td>${method.name}</td>
                    <td>${getPaymentTypeName(method.type)}</td>
                    <td>${method.fee}%</td>
                    <td>R$ ${method.total.toFixed(2)}</td>
                    <td class="actions-cell">
                        <button onclick="editPaymentMethod(${method.id})" class="btn-small info">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="showDeleteItem('payment', ${method.id})" class="btn-small danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                container.appendChild(row);
                
                // Opção para filtro
                const option = document.createElement('option');
                option.value = method.name;
                option.textContent = method.name;
                filterSelect.appendChild(option);
            });
        }

        function getPaymentTypeName(type) {
            const types = {
                'pix': 'Pix',
                'cash': 'Dinheiro',
                'credit': 'Cartão Crédito',
                'debit': 'Cartão Débito',
                'other': 'Outro'
            };
            return types[type] || type;
        }

        function addPaymentMethod() {
            const name = document.getElementById('paymentMethodName').value.trim();
            const type = document.getElementById('paymentMethodType').value;
            const fee = parseFloat(document.getElementById('paymentMethodFee').value) || 0;
            const icon = document.getElementById('paymentMethodIcon').value.trim() || 'fa-credit-card';
            
            if (!name) {
                showNotification("Digite o nome da forma de pagamento", "danger");
                return;
            }
            
            const editId = document.getElementById('savePaymentMethodBtn').dataset.editId;
            
            if (editId) {
                const index = appState.paymentMethods.findIndex(p => p.id === parseInt(editId));
                if (index !== -1) {
                    appState.paymentMethods[index] = {
                        ...appState.paymentMethods[index],
                        name, type, fee, icon
                    };
                    showNotification(`Forma de pagamento "${name}" atualizada!`, "success");
                }
            } else {
                const newMethod = {
                    id: Date.now(),
                    name,
                    type,
                    fee,
                    icon,
                    total: 0
                };
                
                appState.paymentMethods.push(newMethod);
                showNotification(`Forma de pagamento "${name}" adicionada!`, "success");
            }
            
            saveAppData();
            loadPaymentMethods();
            resetPaymentMethodForm();
        }

        function editPaymentMethod(id) {
            const method = appState.paymentMethods.find(p => p.id === id);
            if (!method) return;
            
            document.getElementById('paymentMethodName').value = method.name;
            document.getElementById('paymentMethodType').value = method.type;
            document.getElementById('paymentMethodFee').value = method.fee;
            document.getElementById('paymentMethodIcon').value = method.icon || '';
            
            const btn = document.getElementById('savePaymentMethodBtn');
            btn.innerHTML = '<i class="fas fa-save"></i> Salvar';
            btn.dataset.editId = id;
            document.getElementById('cancelPaymentEdit').style.display = 'flex';
            
            showNotification(`Editando: ${method.name}`, "info");
        }

        function resetPaymentMethodForm() {
            document.getElementById('paymentMethodName').value = '';
            document.getElementById('paymentMethodType').value = 'pix';
            document.getElementById('paymentMethodFee').value = '';
            document.getElementById('paymentMethodIcon').value = '';
            
            const btn = document.getElementById('savePaymentMethodBtn');
            btn.innerHTML = '<i class="fas fa-plus"></i> Adicionar';
            delete btn.dataset.editId;
            document.getElementById('cancelPaymentEdit').style.display = 'none';
        }

        // ============ CUSTOS ============
        function loadCosts() {
            const container = document.getElementById('costsList');
            container.innerHTML = '';
            
            // Ordenar por data (mais recente primeiro)
            const sortedCosts = [...appState.costs].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedCosts.forEach(cost => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(cost.date).toLocaleDateString('pt-BR')}</td>
                    <td>${cost.description}</td>
                    <td>${getCostCategoryName(cost.category)}</td>
                    <td>R$ ${cost.value.toFixed(2)}</td>
                    <td class="actions-cell">
                        <button onclick="showDeleteItem('cost', ${cost.id})" class="btn-small danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                container.appendChild(row);
            });
            
            updateCostsChart();
            updateCostCompositionChart();
        }

        function getCostCategoryName(category) {
            const names = {
                'transport': 'Transporte',
                'food': 'Alimentação',
                'machine_fee': 'Taxa Maquininha',
                'donation': 'Doação',
                'barter': 'Escambo',
                'gift': 'Brinde',
                'water': 'Água',
                'electricity': 'Luz',
                'gas': 'Gás',
                'salary': 'Salário',
                'employee': 'Funcionário',
                'other': 'Outros'
            };
            return names[category] || category;
        }

        function addCost() {
            const description = document.getElementById('costDescription').value.trim();
            const category = document.getElementById('costCategory').value;
            const value = parseFloat(document.getElementById('costValue').value);
            const date = document.getElementById('costDate').value || new Date().toISOString().split('T')[0];
            
            if (!description) {
                showNotification("Digite a descrição", "danger");
                return;
            }
            
            if (!value || value <= 0) {
                showNotification("Valor inválido", "danger");
                return;
            }
            
            const newCost = {
                id: Date.now(),
                description,
                category,
                value,
                date
            };
            
            appState.costs.push(newCost);
            saveAppData();
            loadCosts();
            updateDashboard();
            updateGoalDisplay();
            updateFinancialDashboard();
            
            document.getElementById('costDescription').value = '';
            document.getElementById('costValue').value = '';
            document.getElementById('costDate').value = '';
            
            showNotification(`Custo "${description}" registrado!`, "success");
        }

        function exportCostReport() {
            if (appState.costs.length === 0) {
                showNotification("Nenhum custo para exportar", "warning");
                return;
            }
            
            let csv = 'Data,Descrição,Categoria,Valor (R$)\n';
            
            appState.costs.forEach(cost => {
                csv += `"${new Date(cost.date).toLocaleDateString('pt-BR')}","${cost.description}","${getCostCategoryName(cost.category)}",${cost.value}\n`;
            });
            
            downloadFile(csv, `custos-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showNotification("Relatório de custos exportado com sucesso!", "success");
        }

        // ============ FINANCEIRO ============
        function updateFinancialDashboard() {
            // Fluxo de caixa (últimos 30 dias)
            const last30Days = getLastNDays(30);
            const cashInflows = last30Days.reduce((sum, day) => sum + day.profit, 0);
            const cashOutflows = appState.costs.reduce((sum, cost) => {
                const costDate = new Date(cost.date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return costDate >= thirtyDaysAgo ? sum + cost.value : sum;
            }, 0);
            const cashFlow = cashInflows - cashOutflows;
            
            document.getElementById('cashFlowValue').textContent = `R$ ${cashFlow.toFixed(2)}`;
            document.getElementById('cashInflows').textContent = `R$ ${cashInflows.toFixed(2)}`;
            document.getElementById('cashOutflows').textContent = `R$ ${cashOutflows.toFixed(2)}`;
            
            // Rentabilidade (últimos 30 dias)
            const totalRevenue = last30Days.reduce((sum, day) => {
                const daySales = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === day.date;
                });
                return sum + daySales.reduce((sum2, sale) => sum2 + sale.total, 0);
            }, 0);
            
            const profitMargin = totalRevenue > 0 ? (cashInflows / totalRevenue) * 100 : 0;
            
            document.getElementById('profitMarginValue').textContent = `${profitMargin.toFixed(1)}%`;
            document.getElementById('revenueAmount').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            document.getElementById('profitAmount').textContent = `R$ ${cashInflows.toFixed(2)}`;
            
            // Média diária
            const dailyAverage = cashInflows / 30;
            const bestDay = Math.max(...last30Days.map(d => d.profit));
            const worstDay = Math.min(...last30Days.map(d => d.profit));
            
            document.getElementById('dailyAverageValue').textContent = `R$ ${dailyAverage.toFixed(2)}`;
            document.getElementById('bestDayValue').textContent = `R$ ${bestDay.toFixed(2)}`;
            document.getElementById('worstDayValue').textContent = `R$ ${worstDay.toFixed(2)}`;
            
            // Produtividade
            const totalSalesCount = last30Days.reduce((sum, day) => {
                const daySales = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === day.date;
                });
                return sum + daySales.length;
            }, 0);
            
            const salesPerDay = totalSalesCount / 30;
            const averageTicket = totalRevenue / totalSalesCount || 0;
            
            document.getElementById('productivityValue').textContent = `${salesPerDay.toFixed(1)}`;
            document.getElementById('salesPerDay').textContent = `${salesPerDay.toFixed(1)}`;
            document.getElementById('averageTicket').textContent = `R$ ${averageTicket.toFixed(2)}`;
            
            // Atualizar gráficos
            updateFinancialChart();
            updateForecastChart();
            
            // Salvar análise
            appState.financialData.analysis = {
                cashFlow,
                profitMargin,
                dailyAverage,
                salesPerDay,
                averageTicket,
                updatedAt: new Date().toISOString()
            };
            saveAppData();
        }

        function showFinancialDetails() {
            const modal = document.getElementById('financialDetailsModal');
            const content = document.getElementById('financialDetailsContent');
            
            let html = `
                <div style="display: grid; gap: 24px;">
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--primary);">Resumo Financeiro</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--gray-600);">Faturamento Total</div>
                                <div style="font-size: 24px; font-weight: 800; color: var(--success);">R$ ${appState.financialData.monthlyData.reduce((sum, m) => sum + m.revenue, 0).toFixed(2)}</div>
                            </div>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--gray-600);">Custos Totais</div>
                                <div style="font-size: 24px; font-weight: 800; color: var(--danger);">R$ ${appState.financialData.monthlyData.reduce((sum, m) => sum + m.costs, 0).toFixed(2)}</div>
                            </div>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; color: var(--gray-600);">Lucro Total</div>
                                <div style="font-size: 24px; font-weight: 800; color: var(--primary);">R$ ${appState.financialData.monthlyData.reduce((sum, m) => sum + m.profit, 0).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--primary);">Análise Mensal</h4>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--gray-100);">
                                        <th style="padding: 12px; text-align: left;">Mês</th>
                                        <th style="padding: 12px; text-align: right;">Faturamento</th>
                                        <th style="padding: 12px; text-align: right;">Custos</th>
                                        <th style="padding: 12px; text-align: right;">Lucro</th>
                                        <th style="padding: 12px; text-align: right;">Margem</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            appState.financialData.monthlyData.forEach(month => {
                const margin = month.revenue > 0 ? (month.profit / month.revenue) * 100 : 0;
                html += `
                    <tr style="border-bottom: 1px solid var(--gray-200);">
                        <td style="padding: 12px;">${month.month}</td>
                        <td style="padding: 12px; text-align: right;">R$ ${month.revenue.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right; color: var(--danger);">R$ ${month.costs.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right; color: ${month.profit >= 0 ? 'var(--success)' : 'var(--danger)'};">R$ ${month.profit.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: right; color: ${margin >= 0 ? 'var(--success)' : 'var(--danger)'};">${margin.toFixed(1)}%</td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 16px; color: var(--primary);">Projeções</h4>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <p style="margin-bottom: 12px;">Baseado no desempenho dos últimos 30 dias, as projeções para os próximos 30 dias são:</p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 16px;">
                                <div>
                                    <div style="font-size: 12px; color: var(--gray-600);">Faturamento Projetado</div>
                                    <div style="font-size: 18px; font-weight: 800; color: var(--success);">R$ ${(appState.financialData.analysis.dailyAverage * 45).toFixed(2)}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: var(--gray-600);">Lucro Projetado</div>
                                    <div style="font-size: 18px; font-weight: 800; color: var(--primary);">R$ ${(appState.financialData.analysis.dailyAverage * 30).toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            modal.classList.add('show');
        }

        function hideFinancialDetails() {
            document.getElementById('financialDetailsModal').classList.remove('show');
        }

        function exportFinancialDetails() {
            let csv = 'Mês,Faturamento (R$),Custos (R$),Lucro (R$),Margem (%)\n';
            
            appState.financialData.monthlyData.forEach(month => {
                const margin = month.revenue > 0 ? (month.profit / month.revenue) * 100 : 0;
                csv += `"${month.month}",${month.revenue},${month.costs},${month.profit},${margin.toFixed(2)}\n`;
            });
            
            downloadFile(csv, `analise-financeira-${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            showNotification("Análise financeira exportada com sucesso!", "success");
        }

        function exportFinancialReport() {
            const report = `
                RELATÓRIO FINANCEIRO - PRAIAVENDAS PRO
                Data: ${new Date().toLocaleDateString('pt-BR')}
                
                =========================================
                RESUMO GERAL
                =========================================
                Fluxo de Caixa (30 dias): R$ ${appState.financialData.analysis.cashFlow?.toFixed(2) || '0.00'}
                Margem de Lucro: ${appState.financialData.analysis.profitMargin?.toFixed(1) || '0.0'}%
                Média Diária: R$ ${appState.financialData.analysis.dailyAverage?.toFixed(2) || '0.00'}
                Vendas por Dia: ${appState.financialData.analysis.salesPerDay?.toFixed(1) || '0.0'}
                Ticket Médio: R$ ${appState.financialData.analysis.averageTicket?.toFixed(2) || '0.00'}
                
                =========================================
                ANÁLISE MENSAL
                =========================================
                ${appState.financialData.monthlyData.map(m => 
                    `${m.month}: Faturamento R$ ${m.revenue.toFixed(2)} | Custos R$ ${m.costs.toFixed(2)} | Lucro R$ ${m.profit.toFixed(2)}`
                ).join('\n')}
                
                =========================================
                PROJEÇÕES (PRÓXIMOS 30 DIAS)
                =========================================
                Faturamento Projetado: R$ ${(appState.financialData.analysis.dailyAverage * 45).toFixed(2)}
                Lucro Projetado: R$ ${(appState.financialData.analysis.dailyAverage * 30).toFixed(2)}
                
                =========================================
                RECOMENDAÇÕES
                =========================================
                1. Mantenha a média diária atual
                2. Reduza custos nas categorias mais significativas
                3. Aumente o ticket médio através de upsell
                4. Monitore regularmente as metas de lucro
            `;
            
            downloadFile(report, `relatorio-financeiro-${new Date().toISOString().split('T')[0]}.txt`, 'text/plain');
            showNotification("Relatório financeiro exportado com sucesso!", "success");
        }

        // ============ CONFIGURAÇÕES ============
        function setupColorCustomizer() {
            const colorPicker = document.getElementById('customColorPicker');
            const hexInput = document.getElementById('hexColorInput');
            const redSlider = document.getElementById('redSlider');
            const greenSlider = document.getElementById('greenSlider');
            const blueSlider = document.getElementById('blueSlider');
            const redValue = document.getElementById('redValue');
            const greenValue = document.getElementById('greenValue');
            const blueValue = document.getElementById('blueValue');
            
            // Cor atual
            const currentColor = appState.businessInfo.themeColor;
            const rgb = hexToRgb(currentColor);
            
            colorPicker.value = currentColor;
            hexInput.value = currentColor;
            redSlider.value = rgb.r;
            greenSlider.value = rgb.g;
            blueSlider.value = rgb.b;
            redValue.textContent = rgb.r;
            greenValue.textContent = rgb.g;
            blueValue.textContent = rgb.b;
            
            // Atualizar quando mudar
            colorPicker.addEventListener('input', (e) => {
                const hex = e.target.value;
                const rgb = hexToRgb(hex);
                hexInput.value = hex;
                redSlider.value = rgb.r;
                greenSlider.value = rgb.g;
                blueSlider.value = rgb.b;
                redValue.textContent = rgb.r;
                greenValue.textContent = rgb.g;
                blueValue.textContent = rgb.b;
                updateThemeColor(hex);
            });
            
            hexInput.addEventListener('change', (e) => {
                const hex = e.target.value.startsWith('#') ? e.target.value : '#' + e.target.value;
                if (/^#[0-9A-F]{6}$/i.test(hex)) {
                    const rgb = hexToRgb(hex);
                    colorPicker.value = hex;
                    redSlider.value = rgb.r;
                    greenSlider.value = rgb.g;
                    blueSlider.value = rgb.b;
                    redValue.textContent = rgb.r;
                    greenValue.textContent = rgb.g;
                    blueValue.textContent = rgb.b;
                    updateThemeColor(hex);
                }
            });
            
            [redSlider, greenSlider, blueSlider].forEach(slider => {
                slider.addEventListener('input', () => {
                    const r = parseInt(redSlider.value);
                    const g = parseInt(greenSlider.value);
                    const b = parseInt(blueSlider.value);
                    const hex = rgbToHex(r, g, b);
                    colorPicker.value = hex;
                    hexInput.value = hex;
                    redValue.textContent = r;
                    greenValue.textContent = g;
                    blueValue.textContent = b;
                    updateThemeColor(hex);
                });
            });
        }

        function updateThemeColor(hex) {
            appState.businessInfo.themeColor = hex;
            updateBusinessInfo();
        }

        function saveBusinessInfo() {
            const name = document.getElementById('businessNameInput').value.trim();
            const slogan = document.getElementById('businessSloganInput').value.trim();
            
            if (!name) {
                showNotification("Digite o nome do negócio", "danger");
                return;
            }
            
            appState.businessInfo.name = name;
            appState.businessInfo.slogan = slogan;
            saveAppData();
            updateBusinessInfo();
            
            showNotification("Informações salvas com sucesso!", "success");
        }

        // ============ UTILITÁRIOS ============
        function showNotification(message, type = "success") {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification notification-${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function playSaleAnimation() {
            const animation = document.getElementById('saleAnimation');
            animation.classList.add('show');
            setTimeout(() => animation.classList.remove('show'), 1000);
        }

        function playSaleSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Silencioso se não suportado
            }
        }

        function showDeleteItem(type, id) {
            itemToDelete = { type, id };
            
            let text = '';
            switch(type) {
                case 'product':
                    const product = appState.products.find(p => p.id === id);
                    text = `Tem certeza que deseja excluir o produto "${product?.name}"?`;
                    break;
                case 'sale':
                    text = "Tem certeza que deseja excluir esta venda permanentemente?";
                    break;
                case 'cost':
                    const cost = appState.costs.find(c => c.id === id);
                    text = `Tem certeza que deseja excluir o custo "${cost?.description}"?`;
                    break;
                case 'payment':
                    const payment = appState.paymentMethods.find(p => p.id === id);
                    text = `Tem certeza que deseja excluir a forma de pagamento "${payment?.name}"?`;
                    break;
            }
            
            document.getElementById('deleteModalText').textContent = text;
            document.getElementById('deleteModal').classList.add('show');
        }

        function hideDeleteModal() {
            document.getElementById('deleteModal').classList.remove('show');
            itemToDelete = null;
        }

        function confirmDelete() {
            if (!itemToDelete) return;
            
            const { type, id } = itemToDelete;
            
            switch(type) {
                case 'product':
                    const productIndex = appState.products.findIndex(p => p.id === id);
                    if (productIndex !== -1) {
                        appState.products.splice(productIndex, 1);
                        loadProducts();
                        showNotification("Produto excluído com sucesso!", "success");
                    }
                    break;
                    
                case 'sale':
                    const saleIndex = appState.sales.findIndex(s => s.id == id);
                    if (saleIndex !== -1) {
                        appState.sales.splice(saleIndex, 1);
                        updateDashboard();
                        updateGoalDisplay();
                        updateRecentSales();
                        updateHistory();
                        updateFinancialDashboard();
                        showNotification("Venda excluída com sucesso!", "success");
                    }
                    break;
                    
                case 'cost':
                    const costIndex = appState.costs.findIndex(c => c.id === id);
                    if (costIndex !== -1) {
                        appState.costs.splice(costIndex, 1);
                        loadCosts();
                        updateDashboard();
                        updateGoalDisplay();
                        updateFinancialDashboard();
                        showNotification("Custo excluído com sucesso!", "success");
                    }
                    break;
                    
                case 'payment':
                    if (appState.paymentMethods.length <= 2) {
                        showNotification("Você precisa ter pelo menos 2 formas de pagamento", "warning");
                        break;
                    }
                    const paymentIndex = appState.paymentMethods.findIndex(p => p.id === id);
                    if (paymentIndex !== -1) {
                        appState.paymentMethods.splice(paymentIndex, 1);
                        loadPaymentMethods();
                        showNotification("Forma de pagamento excluída com sucesso!", "success");
                    }
                    break;
            }
            
            saveAppData();
            hideDeleteModal();
        }

        function backupData() {
            const backup = {
                businessInfo: appState.businessInfo,
                products: appState.products,
                sales: appState.sales,
                paymentMethods: appState.paymentMethods,
                costs: appState.costs,
                settings: appState.settings,
                goalData: goalState,
                financialData: appState.financialData,
                backupDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const data = JSON.stringify(backup, null, 2);
            downloadFile(data, `praiaVendas-backup-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showNotification("Backup criado com sucesso!", "success");
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const backup = JSON.parse(event.target.result);
                        
                        if (confirm("Restaurar backup? Todos os dados atuais serão substituídos.")) {
                            appState.businessInfo = backup.businessInfo || appState.businessInfo;
                            appState.products = backup.products || [];
                            appState.sales = backup.sales || [];
                            appState.paymentMethods = backup.paymentMethods || appState.paymentMethods;
                            appState.costs = backup.costs || [];
                            appState.settings = backup.settings || appState.settings;
                            appState.financialData = backup.financialData || appState.financialData;
                            
                            if (backup.goalData) {
                                goalState = backup.goalData;
                            }
                            
                            saveAppData();
                            saveGoalData();
                            updateBusinessInfo();
                            loadProducts();
                            loadPaymentMethods();
                            loadCosts();
                            updateDashboard();
                            updateGoalDisplay();
                            updateRecentSales();
                            updateHistory();
                            updateFinancialDashboard();
                            
                            showNotification("Backup restaurado com sucesso!", "success");
                        }
                    } catch (err) {
                        showNotification("Erro ao ler backup. Verifique se o arquivo é válido.", "danger");
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function exportAllData() {
            const allData = {
                businessInfo: appState.businessInfo,
                products: appState.products,
                sales: appState.sales,
                paymentMethods: appState.paymentMethods,
                costs: appState.costs,
                settings: appState.settings,
                goalData: goalState,
                financialData: appState.financialData,
                exportDate: new Date().toISOString(),
                recordCounts: {
                    products: appState.products.length,
                    sales: appState.sales.length,
                    costs: appState.costs.length,
                    paymentMethods: appState.paymentMethods.length
                }
            };
            
            const data = JSON.stringify(allData, null, 2);
            downloadFile(data, `dados-completos-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showNotification("Todos os dados exportados com sucesso!", "success");
        }

        function resetData() {
            if (confirm("⚠️ ATENÇÃO: Esta ação irá apagar TODOS os dados do sistema. Esta ação não pode ser desfeita.\n\nTem certeza que deseja continuar?")) {
                if (confirm("⚠️ CONFIRMAÇÃO FINAL: Todos os produtos, vendas, custos e configurações serão permanentemente excluídos.\n\nDigite 'CONFIRMAR' para prosseguir:")) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function checkCookieConsent() {
            if (!localStorage.getItem(DATA_KEYS.COOKIE_CONSENT)) {
                setTimeout(() => {
                    document.getElementById('cookieModal').classList.add('show');
                }, 1000);
            }
        }

        function acceptCookies() {
            localStorage.setItem(DATA_KEYS.COOKIE_CONSENT, 'true');
            document.getElementById('cookieModal').classList.remove('show');
        }

        function importProducts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const content = event.target.result;
                        
                        if (file.name.endsWith('.json')) {
                            const products = JSON.parse(content);
                            if (Array.isArray(products)) {
                                appState.products.push(...products);
                                saveAppData();
                                loadProducts();
                                showNotification(`${products.length} produtos importados com sucesso!`, "success");
                            } else {
                                showNotification("Formato inválido. O arquivo deve conter um array de produtos.", "danger");
                        }
                        } else if (file.name.endsWith('.csv')) {
                            // Implementar importação CSV se necessário
                            showNotification("Importação CSV em desenvolvimento", "info");
                        }
                    } catch (err) {
                        showNotification("Erro ao importar produtos", "danger");
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // ============ HELPERS ============
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 255, g: 107, b: 53 };
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function lightenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (
                0x1000000 +
                (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)
            ).toString(16).slice(1);
        }

        // ============ EVENT LISTENERS ============
        function setupEventListeners() {
            // Login
            document.getElementById('loginBtn').addEventListener('click', () => {
                const username = document.getElementById('usernameInput').value.trim();
                const password = document.getElementById('passwordInput').value;
                
                if (!username || !password) {
                    showNotification("Preencha todos os campos", "danger");
                    return;
                }
                
                if (login(username, password)) {
                    // Sucesso
                } else {
                    document.getElementById('loginError').style.display = 'block';
                }
            });
            
            document.getElementById('togglePassword').addEventListener('click', togglePasswordVisibility);
            
            document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('loginBtn').click();
                }
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const sectionId = tab.dataset.tab;
                    setActiveSection(sectionId);
                });
            });
            
            // Tema
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Ocultar valores
            document.getElementById('hideValuesToggle').addEventListener('click', () => {
                appState.settings.hideValues = !appState.settings.hideValues;
                saveAppData();
                updateUIForHiddenValues();
                showNotification(appState.settings.hideValues ? "Valores ocultados" : "Valores mostrados", "info");
            });
            
            // Filtros
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.settings.currentFilter = btn.dataset.filter;
                    saveAppData();
                    updateDashboard();
                });
            });
            
            // Produtos
            document.getElementById('productSelect').addEventListener('change', function() {
                const productId = parseInt(this.value);
                if (!productId) return;
                
                const product = appState.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('priceInput').value = product.price.toFixed(2);
                }
            });
            
            document.getElementById('addProductToSaleBtn').addEventListener('click', addProductToSale);
            document.getElementById('registerSaleBtn').addEventListener('click', registerSale);
            document.getElementById('registerSaleBtn').addEventListener('click', clearCurrentSale);
            document.getElementById('clearSaleBtn').addEventListener('click', clearCurrentSale);
            document.getElementById('calculateChangeBtn').addEventListener('click', calculateChange);
            
            // Pagamento misto
            document.getElementById('addMixedPaymentBtn').addEventListener('click', addMixedPaymentMethod);
            
            // Formas de pagamento
            document.getElementById('savePaymentMethodBtn').addEventListener('click', addPaymentMethod);
            document.getElementById('cancelPaymentEdit').addEventListener('click', resetPaymentMethodForm);
            
            // Custos
            document.getElementById('addCostBtn').addEventListener('click', addCost);
            
            // Produtos
            document.getElementById('addProductBtn').addEventListener('click', addProduct);
            document.getElementById('cancelEditBtn').addEventListener('click', resetProductForm);
            
            // Configurações
            document.getElementById('saveBusinessInfoBtn').addEventListener('click', saveBusinessInfo);
            
            document.getElementById('photoUpload').addEventListener('click', () => {
                document.getElementById('businessPhotoInput').click();
            });
            
            document.getElementById('businessPhotoInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    showNotification("Selecione uma imagem", "danger");
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    appState.businessInfo.logo = event.target.result;
                    saveAppData();
                    updateBusinessInfo();
                    showNotification("Foto atualizada com sucesso!", "success");
                };
                reader.readAsDataURL(file);
            });
            
            // Cores
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', () => {
                    appState.businessInfo.themeColor = option.dataset.color;
                    saveAppData();
                    updateBusinessInfo();
                    setupColorCustomizer();
                    showNotification("Cor alterada com sucesso!", "success");
                });
            });
            
            // Configurações
            document.getElementById('saleSoundsToggle').addEventListener('change', (e) => {
                appState.settings.saleSounds = e.target.checked;
                saveAppData();
            });
            
            document.getElementById('stockNotificationsToggle').addEventListener('change', (e) => {
                appState.settings.stockNotifications = e.target.checked;
                saveAppData();
            });
            
            document.getElementById('animationsToggle').addEventListener('change', (e) => {
                appState.settings.animations = e.target.checked;
                saveAppData();
            });
            
            document.getElementById('goalNotificationsToggle').addEventListener('change', (e) => {
                goalState.settings.notifications = e.target.checked;
                saveGoalData();
            });
            
            document.getElementById('hideValuesToggle').addEventListener('change', (e) => {
                appState.settings.hideValues = e.target.checked;
                saveAppData();
                updateUIForHiddenValues();
            });
            
            document.getElementById('simpleModeToggle').addEventListener('change', (e) => {
                appState.settings.simpleMode = e.target.checked;
                saveAppData();
                showNotification(appState.settings.simpleMode ? "Modo simplificado ativado" : "Modo completo ativado", "info");
            });
            
            // Backup/Restore
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            
            // Cookies
            document.getElementById('acceptCookies').addEventListener('click', acceptCookies);
            
            // Desconto personalizado
            document.getElementById('customDiscount').addEventListener('change', function() {
                const value = this.value.trim();
                if (!value) return;
                
                if (value.includes('%')) {
                    const percent = parseFloat(value.replace('%', '').replace(',', '.'));
                    if (!isNaN(percent) && percent > 0 && percent <= 100) {
                        setDiscount('percent', percent);
                    }
                } else if (value.includes('R$') || value.includes('$')) {
                    const amount = parseFloat(value.replace('R$', '').replace('$', '').replace(',', '.').trim());
                    if (!isNaN(amount) && amount > 0) {
                        setDiscount('fixed', amount);
                    }
                } else {
                    const num = parseFloat(value.replace(',', '.'));
                    if (!isNaN(num) && num > 0) {
                        if (num <= 100) {
                            setDiscount('percent', num);
                        } else {
                            setDiscount('fixed', num);
                        }
                    }
                }
            });
            
            // Filtros do histórico
            document.getElementById('filterDate').addEventListener('change', updateHistory);
            document.getElementById('filterProduct').addEventListener('input', updateHistory);
            document.getElementById('filterPayment').addEventListener('change', updateHistory);
            
            // Teclas de atalho
            document.addEventListener('keydown', (e) => {
                // Ctrl+S para salvar (quando em foco em inputs)
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    if (document.activeElement.id === 'businessNameInput' || 
                        document.activeElement.id === 'businessSloganInput') {
                        saveBusinessInfo();
                    }
                }
                
                // Esc para fechar modais
                if (e.key === 'Escape') {
                    hideGoalModal();
                    hideDeleteModal();
                    hideFinancialDetails();
                }
            });
        }

        function setActiveSection(sectionId) {
            // Atualizar tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === sectionId);
            });
            
            // Atualizar seções
            document.querySelectorAll('.section').forEach(section => {
                section.classList.toggle('active', section.id === sectionId);
            });
            
            appState.currentSection = sectionId;
            
            // Carregar dados específicos da seção
            switch(sectionId) {
                case 'dashboard':
                    updateDashboard();
                    updateGoalDisplay();
                    break;
                case 'goals':
                    updateGoalDisplay();
                    break;
                case 'sales':
                    loadProducts();
                    updateRecentSales();
                    break;
                case 'history':
                    updateHistory();
                    break;
                case 'payment-methods':
                    loadPaymentMethods();
                    break;
                case 'costs':
                    loadCosts();
                    break;
                case 'finance':
                    updateFinancialDashboard();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'settings':
                    // Atualizar toggles com valores atuais
                    document.getElementById('saleSoundsToggle').checked = appState.settings.saleSounds;
                    document.getElementById('stockNotificationsToggle').checked = appState.settings.stockNotifications;
                    document.getElementById('animationsToggle').checked = appState.settings.animations;
                    document.getElementById('hideValuesToggle').checked = appState.settings.hideValues;
                    document.getElementById('simpleModeToggle').checked = appState.settings.simpleMode;
                    break;
            }
        }

        // ============ INICIALIZAÇÃO ============
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Expor funções globais
        window.addProductToSale = addProductToSale;
        window.removeProductFromSale = removeProductFromSale;
        window.clearCurrentSale = clearCurrentSale;
        window.registerSale = registerSale;
        window.setDiscount = setDiscount;
        window.addMixedPaymentMethod = addMixedPaymentMethod;
        window.removeMixedPaymentMethod = removeMixedPaymentMethod;
        window.updateMixedPaymentMethod = updateMixedPaymentMethod;
        window.updateMixedPaymentAmount = updateMixedPaymentAmount;
        window.autoDistributePayment = autoDistributePayment;
        window.calculateChange = calculateChange;
        window.showGoalModal = showGoalModal;
        window.hideGoalModal = hideGoalModal;
        window.saveDailyGoal = saveDailyGoal;
        window.setDailyGoal = setDailyGoal;
        window.exportGoalReport = exportGoalReport;
        window.editProduct = editProduct;
        window.showDeleteItem = showDeleteItem;
        window.hideDeleteModal = hideDeleteModal;
        window.confirmDelete = confirmDelete;
        window.resetProductForm = resetProductForm;
        window.resetPaymentMethodForm = resetPaymentMethodForm;
        window.editPaymentMethod = editPaymentMethod;
        window.exportHistory = exportHistory;
        window.exportReceipt = exportReceipt;
        window.exportCostReport = exportCostReport;
        window.exportFinancialReport = exportFinancialReport;
        window.exportFinancialDetails = exportFinancialDetails;
        window.showFinancialDetails = showFinancialDetails;
        window.hideFinancialDetails = hideFinancialDetails;
        window.clearHistory = clearHistory;
        window.changeHistoryPage = changeHistoryPage;
        window.editSale = function(id) {
            showNotification("Edição de venda em desenvolvimento", "info");
        };
        window.editGoal = function(date) {
            showNotification("Edição de meta em desenvolvimento", "info");
        };
        window.acceptCookies = acceptCookies;
        window.importProducts = importProducts;
        window.togglePasswordVisibility = togglePasswordVisibility;
        window.showIconSelector = showIconSelector;
        window.selectIcon = selectIcon;
    </script>
</body>
</html>